-- Decompilation Error: _run_step(_unwarp_expressions, node)

-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- Decompilation Error: _glue_flows(node)

-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.

-- Decompilation error in this vicinity:
--- BLOCK #0 1-23, warpins: 1 ---
slot3 = "CoreDatabaseManager"

core.module(slot1, core)

slot3 = "CoreEngineAccess"

core.import(slot1, core)

slot3 = "CoreApp"

core.import(slot1, core)

slot3 = "CoreString"

core.import(slot1, core)

slot0 = DatabaseManager or class()
DatabaseManager = slot0
function DatabaseManager:list_unit_types()

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if self.__unit_types == nil then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-12, warpins: 1 ---
		self.__unit_types = {}
		slot6 = "unit"

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 13-32, warpins: 0 ---
		for _, unit in ipairs(self.list_entries_of_type(slot4, self)) do

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-23, warpins: 1 ---
			slot10 = unit
			local unit_data = CoreEngineAccess._editor_unit_data(unit.id(slot9))
			slot7 = table.insert
			slot9 = self.__unit_types

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 30-30, warpins: 2 ---
			slot7(slot8, slot9)
			--- END OF BLOCK #1 ---

			FLOW; TARGET BLOCK #2



			-- Decompilation error in this vicinity:
			--- BLOCK #2 31-32, warpins: 2 ---
			--- END OF BLOCK #2 ---



		end
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 33-34, warpins: 2 ---
	return self.__unit_types
	--- END OF BLOCK #1 ---



end
function DatabaseManager:list_units_of_type(type)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if self.__units_by_type == nil then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-12, warpins: 1 ---
		self.__units_by_type = {}
		slot7 = "unit"

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 13-48, warpins: 0 ---
		for _, unit in ipairs(self.list_entries_of_type(slot5, self)) do

			-- Decompilation error in this vicinity:
			--- BLOCK #0 13-20, warpins: 1 ---
			slot11 = unit
			local unit_data = CoreEngineAccess._editor_unit_data(unit.id(slot10))

			if unit_data then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 21-25, warpins: 1 ---
				slot10 = unit_data

				if unit_data.type(slot9) then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 26-31, warpins: 1 ---
					slot10 = unit_data
					slot10 = unit_data.type(slot9)
					local key = unit_data.type(slot9).key(slot9)
					--- END OF BLOCK #0 ---



				end
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 32-33, warpins: 3 ---
			if key then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 34-38, warpins: 1 ---
				slot9 = self.__units_by_type

				if not self.__units_by_type[key] then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 39-39, warpins: 1 ---
					slot10 = {}
					--- END OF BLOCK #0 ---



				end

				--- END OF BLOCK #0 ---

				FLOW; TARGET BLOCK #1



				-- Decompilation error in this vicinity:
				--- BLOCK #1 40-46, warpins: 2 ---
				slot9[key] = slot10
				slot12 = unit

				table.insert(slot10, self.__units_by_type[key])
				--- END OF BLOCK #1 ---



			end
			--- END OF BLOCK #1 ---

			FLOW; TARGET BLOCK #2



			-- Decompilation error in this vicinity:
			--- BLOCK #2 47-48, warpins: 3 ---
			--- END OF BLOCK #2 ---



		end
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 49-55, warpins: 2 ---
	slot5 = type

	if not self.__units_by_type[type.key(slot4)] then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 56-56, warpins: 1 ---
		slot2 = {}
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 57-57, warpins: 2 ---
	return slot2
	--- END OF BLOCK #2 ---



end
function DatabaseManager:list_entries_of_type(type, pattern)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot9 = type
	slot7 = pattern

	return self.list_entries_in_index(slot4, self, self._type_index(pattern, self))
	--- END OF BLOCK #0 ---



end
function DatabaseManager:list_entries_in_index(index, pattern)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	slot6 = index
	local entries = self._entries_in_index(slot4, self)

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 15-16, warpins: 2 ---
	return slot4
	--- END OF BLOCK #1 ---



end
function DatabaseManager:recompile(...)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	local files = {}
	slot4 = {
		...
	}

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-17, warpins: 0 ---
	for _, v in pairs(slot3) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-15, warpins: 1 ---
		slot9 = files
		slot13 = v

		table.insert(slot8, self.entry_relative_path(slot11, self))
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 16-17, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 18-53, warpins: 1 ---
	slot5 = {
		target_db_name = "all",
		preprocessor_definitions = "preprocessor_definitions",
		verbose = false,
		platform = string.lower(SystemInfo.platform(slot9).s(slot9)),
		source_root = self.base_path(slot7),
		target_db_root = Application.base_path(slot7) .. "assets",
		source_files = files
	}
	slot10 = SystemInfo
	slot10 = SystemInfo.platform(slot9)
	slot8 = self
	slot8 = Application

	Application.data_compile(slot3, Application)

	slot4 = DB

	DB.reload(slot3)

	slot4 = self

	self.clear_all_cached_indices(slot3)

	return 
	--- END OF BLOCK #2 ---



end
function DatabaseManager:clear_cached_index(index)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if self.__entries then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-6, warpins: 1 ---
		self.__entries[index] = nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 7-12, warpins: 2 ---
	slot5 = "unit"

	if index == self._type_index(slot3, self) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-16, warpins: 1 ---
		self.__unit_types = nil
		self.__units_by_type = nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 17-17, warpins: 2 ---
	return 
	--- END OF BLOCK #2 ---



end
function DatabaseManager:clear_all_cached_indices()

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	self.__entries = nil
	self.__unit_types = nil
	self.__units_by_type = nil

	return 
	--- END OF BLOCK #0 ---



end
function DatabaseManager:root_path()

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-10, warpins: 1 ---
	slot1 = Application.base_path(slot2)
	slot4 = "-assetslocation"

	if not CoreApp.arg_value(Application) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 11-11, warpins: 1 ---
		slot2 = "..\\..\\"
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 12-25, warpins: 2 ---
	local path = slot1 .. slot2
	slot6 = true
	path = Application.nice_path(slot3, Application, path)
	local f = nil

	function f(s)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-9, warpins: 1 ---
		slot5 = ""
		local str, i = string.gsub(slot2, s, "\\[%w_%.%s]+\\%.%.")

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 16-16, warpins: 2 ---
		return slot3
		--- END OF BLOCK #1 ---



	end

	slot5 = path

	return f(Application)
	--- END OF BLOCK #1 ---



end
function DatabaseManager:base_path()

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	slot3 = self

	return self.root_path(slot2) .. "assets\\"
	--- END OF BLOCK #0 ---



end
function DatabaseManager:is_valid_database_path(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-23, warpins: 1 ---
	slot8 = true
	slot4 = Application.nice_path(slot5, Application, path).lower(slot5)
	slot10 = self
	slot9 = true
	slot7 = Application.nice_path(Application.nice_path(slot5, Application, path), Application, self.base_path(true))

	return string.begins(slot3, Application.nice_path(Application.nice_path(slot5, Application, path), Application, self.base_path(true)).lower(Application.nice_path(slot5, Application, path)))
	--- END OF BLOCK #0 ---



end
function DatabaseManager:entry_name(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot7 = path
	slot5 = "([^/]*)$"

	return string.match(slot3, self.entry_path(slot5, self))
	--- END OF BLOCK #0 ---



end
function DatabaseManager:entry_type(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	slot5 = "%."

	if not string.find(slot3, path) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-9, warpins: 1 ---
		return nil
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 10-14, warpins: 2 ---
	slot5 = "([^.]*)$"

	return string.match(slot3, path)
	--- END OF BLOCK #1 ---



end
function DatabaseManager:entry_path(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-19, warpins: 1 ---
	slot8 = ""
	slot5 = "([^.]*)"
	path = string.match(slot3, string.gsub(slot5, path, ".*assets[/\\]"))
	slot6 = "/"
	path = string.gsub(slot3, path, "[/\\]+")

	return path
	--- END OF BLOCK #0 ---



end
function DatabaseManager:entry_path_with_properties(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-22, warpins: 1 ---
	slot6 = ""
	path = string.gsub(slot3, path, ".*assets[/\\]")
	slot6 = ""
	path = string.gsub(slot3, path, "%.%w-$")
	slot6 = "/"
	path = string.gsub(slot3, path, "[/\\]+")

	return path
	--- END OF BLOCK #0 ---



end
function DatabaseManager:entry_relative_path(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-15, warpins: 1 ---
	slot6 = ""
	path = string.gsub(slot3, path, ".*assets[/\\]")
	slot6 = "/"
	path = string.gsub(slot3, path, "[/\\]+")

	return path
	--- END OF BLOCK #0 ---



end
function DatabaseManager:entry_expanded_path(type, entry_path, prop)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	if not prop then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 3-3, warpins: 1 ---
		local properties = ""
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 4-17, warpins: 2 ---
	slot9 = self
	slot9 = "\\"
	local path = string.gsub(slot6, self.base_path(slot8) .. entry_path .. properties .. "." .. type, "/")

	return path
	--- END OF BLOCK #1 ---



end
function DatabaseManager:entry_expanded_directory(entry_path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	slot6 = self
	slot6 = "\\"
	local path = string.gsub(slot3, self.base_path(slot5) .. entry_path, "/")

	return path
	--- END OF BLOCK #0 ---



end
function DatabaseManager:load_node_dialog(parent, file_pattern, start_path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot9 = start_path
	local path = self.open_file_dialog(slot5, self, parent, file_pattern)

	if path then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-12, warpins: 1 ---
		slot8 = path
		local node = self.load_node(slot6, self)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 13-15, warpins: 2 ---
	return node, path
	--- END OF BLOCK #1 ---



end
function DatabaseManager:open_file_dialog(parent, file_pattern, start_path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	if not start_path then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 3-5, warpins: 1 ---
		slot6 = self
		local path = self.base_path(slot5)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-7, warpins: 2 ---
	if not file_pattern then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-8, warpins: 1 ---
		local pattern = "*.*"
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 9-23, warpins: 2 ---
	slot14 = "OPEN,FILE_MUST_EXIST"
	local file_dialog = EWS.FileDialog(slot7, EWS, parent, "Choose file", path, "", pattern)
	slot9 = file_dialog

	if file_dialog.show_modal(EWS) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 24-30, warpins: 1 ---
		slot10 = file_dialog

		return file_dialog.get_path(slot8), file_dialog.get_directory(file_dialog)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 31-31, warpins: 2 ---
	return 
	--- END OF BLOCK #3 ---



end
function DatabaseManager:save_file_dialog(parent, new, file_pattern, start_path, save_outside_project)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-2, warpins: 1 ---
	if not file_pattern then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 3-3, warpins: 1 ---
		local pattern = "*.*"
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 4-5, warpins: 2 ---
	if not start_path then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-8, warpins: 1 ---
		slot9 = self
		local path = self.base_path(slot8)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 9-12, warpins: 2 ---
	local name = ""
	local new_file = ""

	if start_path then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-17, warpins: 1 ---
		slot13 = start_path
		name = self.entry_name(slot11, self)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 18-19, warpins: 2 ---
	if new then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 20-20, warpins: 1 ---
		new_file = "new file "
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 21-38, warpins: 2 ---
	slot18 = "SAVE"
	local save_dialog = EWS.FileDialog(slot11, EWS, parent, "Save " .. new_file .. "as..", path, name, file_pattern)
	slot13 = save_dialog

	if save_dialog.show_modal(EWS) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 39-43, warpins: 1 ---
		slot13 = save_dialog
		local new_path = save_dialog.get_path(slot12)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #4 ---

	FLOW; TARGET BLOCK #5



	-- Decompilation error in this vicinity:
	--- BLOCK #5 67-68, warpins: 3 ---
	return nil, nil
	--- END OF BLOCK #5 ---



end
function DatabaseManager:load_node(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	slot5 = path

	if self.has(slot3, self) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 7-22, warpins: 1 ---
		slot6 = "r"
		local file = SystemFS.open(slot3, SystemFS, path)
		local content = file.read(SystemFS)
		slot6 = file

		file.close(file)

		slot6 = content

		return Node.from_xml(file)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 23-24, warpins: 2 ---
	return nil
	--- END OF BLOCK #1 ---



end
function DatabaseManager:save_node(node, path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-18, warpins: 1 ---
	slot9 = "w"
	local file = assert(SystemFS.open(slot6, SystemFS, path))
	slot6 = file
	slot9 = node

	file.write(SystemFS.open, node.to_xml(path))

	slot6 = file

	file.close(SystemFS.open)

	return 
	--- END OF BLOCK #0 ---



end
function DatabaseManager:delete(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	slot5 = path

	return SystemFS.delete_file(slot3, SystemFS)
	--- END OF BLOCK #0 ---



end
function DatabaseManager:has(path)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	slot5 = path

	return SystemFS.exists(slot3, SystemFS)
	--- END OF BLOCK #0 ---



end
function DatabaseManager:_entries_in_index(index)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	if self.__entries then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-5, warpins: 1 ---
		local result = self.__entries[index]
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-7, warpins: 2 ---
	if result == nil then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-15, warpins: 1 ---
		slot6 = index
		result = self._parse_entries_in_index(slot4, self)

		if not self.__entries then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 16-16, warpins: 1 ---
			slot3 = {}
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 17-19, warpins: 2 ---
		self.__entries = slot3
		self.__entries[index] = result
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 20-20, warpins: 2 ---
	return result
	--- END OF BLOCK #2 ---



end
function DatabaseManager:_type_index(type)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	slot4 = "indices/types/%s"
	slot7 = type

	return string.format(slot3, type.s(slot6))
	--- END OF BLOCK #0 ---



end
function DatabaseManager:_parse_entries_in_index(index)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot6 = index

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 18-19, warpins: 2 ---
	if file == nil then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 20-22, warpins: 1 ---
		return {}
		--- END OF BLOCK #0 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 23-33, warpins: 1 ---
		local contents = file.read(slot4)
		slot6 = file

		file.close(file)

		slot7 = "[\r\n]"

		return string.split(file, contents)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 34-34, warpins: 2 ---
	return 
	--- END OF BLOCK #2 ---



end

return 

--- END OF BLOCK #0 ---

FLOW; TARGET BLOCK #2



-- Decompilation error in this vicinity:
--- BLOCK #1 24-25, warpins: 1 ---
slot0 = class()
--- END OF BLOCK #1 ---

FLOW; TARGET BLOCK #2



-- Decompilation error in this vicinity:
--- BLOCK #2 26-108, warpins: 2 ---
--- END OF BLOCK #2 ---



