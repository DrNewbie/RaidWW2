-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- Decompilation Error: _glue_flows(node)

-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
slot3 = "CoreEnvironmentLayer"

core.module(slot1, core)

slot3 = "CoreStaticLayer"

core.import(slot1, core)

slot3 = "CoreEngineAccess"

core.import(slot1, core)

slot3 = "CoreEws"

core.import(slot1, core)

slot3 = "CoreEditorSave"

core.import(slot1, core)

slot3 = "CoreShapeManager"

core.import(slot1, core)

slot3 = "CoreEnvironmentFeeder"

core.import(slot1, core)

if not EnvironmentLayer then
	slot2 = CoreStaticLayer.StaticLayer
	slot0 = class(slot1)
end

EnvironmentLayer = slot0
EnvironmentLayer.ENABLE_PERMANENT = false
EnvironmentLayer.init = function (self, owner)
	slot8 = "environment_layer"

	EnvironmentLayer.super.init(slot3, self, owner, "environment", {
		"environment"
	})

	self._environment_values = {}
	slot4 = self

	self.reset_environment_values(slot3)

	slot5 = "green"
	self._wind_pen = Draw.pen(slot3, Draw)
	self._wind_speeds = {}
	slot5 = {
		speed = 0,
		description = "Calm",
		beaufort = 0
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 0.3,
		description = "Light air",
		beaufort = 1
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 1.6,
		description = "Light breeze",
		beaufort = 2
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 3.4,
		description = "Gentle breeze",
		beaufort = 3
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 5.5,
		description = "Moderate breeze",
		beaufort = 4
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 8,
		description = "Fresh breeze",
		beaufort = 5
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 10.8,
		description = "Strong breeze",
		beaufort = 6
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 13.9,
		description = "Near Gale",
		beaufort = 7
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 17.2,
		description = "Fresh Gale",
		beaufort = 8
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 20.8,
		description = "Strong Gale",
		beaufort = 9
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 24.5,
		description = "Whole storm",
		beaufort = 10
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 28.5,
		description = "Violent storm",
		beaufort = 11
	}

	table.insert(slot3, self._wind_speeds)

	slot5 = {
		speed = 32.7,
		description = "Hurricane",
		beaufort = 12
	}

	table.insert(slot3, self._wind_speeds)

	self._draw_wind = false
	self._draw_occ_shape = true
	self._wind_speed = 6
	self._wind_speed_variation = 1
	self._environment_area_unit = "core/units/environment_area/environment_area"
	self._effect_unit = "core/units/effect/effect"
	self._cubemap_unit = "core/units/cubemap_gizmo/cubemap_gizmo"
	self._dome_occ_shape_unit = "core/units/dome_occ_shape/dome_occ_shape"
	slot6 = "statics"
	slot3 = managers.slot.get_mask(self._wind_speeds, managers.slot)
	self._position_as_slot_mask = self._position_as_slot_mask + slot3
	slot4 = self._owner
	slot5 = "core/environments/default"

	self._owner.viewport(slot3).set_environment(slot3, self._owner.viewport(slot3))

	return 
end
EnvironmentLayer.get_layer_name = function (self)
	return "Environment"
end
EnvironmentLayer.load = function (self, world_holder, offset)
	slot8 = offset
	local environment = world_holder.create_world(slot4, world_holder, "world", self._save_name)
	slot7 = environment

	if not self.old_load(world_holder, self) then
		self._environment_values = environment.environment_values
		slot7 = self._environment_values.environment

		CoreEws.change_combobox_value(slot5, self._environments_combobox)

		slot7 = self._environment_values.dome_occ_resolution

		self._dome_occ_resolution_ctrlr.set_value(slot5, self._dome_occ_resolution_ctrlr)

		slot7 = environment.wind

		self._load_wind(slot5, self)

		slot7 = environment.effects

		self._load_effects(slot5, self)

		slot6 = self

		self._load_environment_areas(slot5)

		slot7 = environment.dome_occ_shapes

		self._load_dome_occ_shapes(slot5, self)

		slot6 = environment.units

		for _, unit in ipairs(slot5) do
			slot12 = unit

			self.set_up_name_id(slot10, self)

			slot12 = unit

			self._owner.register_unit_id(slot10, self._owner)

			slot12 = unit

			table.insert(slot10, self._created_units)
		end
	end

	slot6 = self

	self.clear_selected_units(slot5)

	return environment
end
EnvironmentLayer._load_wind = function (self, wind)
	slot6 = wind.tilt
	self._wind_rot = Rotation(slot3, wind.angle, 0)
	self._wind_dir_var = wind.angle_var
	self._wind_tilt_var = wind.tilt_var
	self._wind_speed = wind.speed or self._wind_speed
	self._wind_speed_variation = wind.speed_variation or self._wind_speed_variation
	slot5 = self._wind_speed * 10

	self._wind_ctrls.wind_speed.set_value(slot3, self._wind_ctrls.wind_speed)

	slot5 = self._wind_speed_variation * 10

	self._wind_ctrls.wind_speed_variation.set_value(slot3, self._wind_ctrls.wind_speed_variation)

	slot4 = self

	self.update_wind_speed_labels(slot3)

	slot5 = wind.angle

	self._wind_ctrls.wind_direction.set_value(slot3, self._wind_ctrls.wind_direction)

	slot5 = self._wind_dir_var

	self._wind_ctrls.wind_variation.set_value(slot3, self._wind_ctrls.wind_variation)

	slot5 = wind.tilt

	self._wind_ctrls.tilt_angle.set_value(slot3, self._wind_ctrls.tilt_angle)

	slot5 = self._wind_tilt_var

	self._wind_ctrls.tilt_variation.set_value(slot3, self._wind_ctrls.tilt_variation)

	slot4 = self

	self.set_wind(slot3)

	return 
end
EnvironmentLayer._load_effects = function (self, effects)
	slot4 = effects

	for _, effect in ipairs(slot3) do
		slot12 = effect.rotation
		local unit = self.do_spawn_unit(slot8, self, self._effect_unit, effect.position)

		if effect.name_id then
			slot12 = effect.name_id

			self.set_name_id(slot9, self, unit)
		end

		slot12 = effect.name

		self.play_effect(slot9, self, unit)
	end

	return 
end
EnvironmentLayer._load_environment_areas = function (self)
	slot5 = managers.environment_area

	for _, area in ipairs(managers.environment_area.areas(slot4)) do
		slot10 = area.position(slot11)
		slot13 = area
		local unit = EnvironmentLayer.super.do_spawn_unit(slot7, self, self._environment_area_unit, area.rotation(area))
		slot9 = unit
		unit.unit_data(self).environment_area = area
		slot9 = unit
		slot10 = unit
		local new_name_id = unit.unit_data(self).environment_area.set_unit(self, unit.unit_data(self).environment_area)

		if new_name_id then
			slot12 = new_name_id

			self.set_name_id(slot9, self, unit)
		end
	end

	return 
end
EnvironmentLayer._load_dome_occ_shapes = function (self, dome_occ_shapes)
	if not dome_occ_shapes then
		return 
	end

	slot4 = dome_occ_shapes

	for _, dome_occ_shape in ipairs(slot3) do
		slot12 = dome_occ_shape.rotation
		local unit = EnvironmentLayer.super.do_spawn_unit(slot8, self, self._dome_occ_shape_unit, dome_occ_shape.position)
		slot12 = dome_occ_shape
		slot9 = CoreShapeManager.ShapeBox.new(unit, CoreShapeManager.ShapeBox)
		unit.unit_data(self).occ_shape = slot9
		slot10 = unit
		slot11 = unit

		unit.unit_data(slot9).occ_shape.set_unit(slot9, unit.unit_data(slot9).occ_shape)
	end

	return 
end
EnvironmentLayer.old_load = function (self, environment)
	if not environment._values then
		return false
	end

	slot4 = environment._values

	for name, value in pairs(slot3) do
		self._environment_values[name] = value
	end

	slot5 = self._environment_values.environment

	CoreEws.change_combobox_value(slot3, self._environments_combobox)

	if environment._wind then
		local wind_angle = environment._wind.wind_angle
		local wind_tilt = environment._wind.wind_tilt
		slot8 = wind_tilt
		self._wind_rot = Rotation(slot5, wind_angle, 0)
		self._wind_dir_var = environment._wind.wind_dir_var
		self._wind_tilt_var = environment._wind.wind_tilt_var
		self._wind_speed = environment._wind.wind_speed or self._wind_speed
		self._wind_speed_variation = environment._wind.wind_speed_variation or self._wind_speed_variation
		slot7 = self._wind_speed * 10

		self._wind_ctrls.wind_speed.set_value(slot5, self._wind_ctrls.wind_speed)

		slot7 = self._wind_speed_variation * 10

		self._wind_ctrls.wind_speed_variation.set_value(slot5, self._wind_ctrls.wind_speed_variation)

		slot6 = self

		self.update_wind_speed_labels(slot5)

		slot7 = wind_angle

		self._wind_ctrls.wind_direction.set_value(slot5, self._wind_ctrls.wind_direction)

		slot7 = self._wind_dir_var

		self._wind_ctrls.wind_variation.set_value(slot5, self._wind_ctrls.wind_variation)

		slot7 = wind_tilt

		self._wind_ctrls.tilt_angle.set_value(slot5, self._wind_ctrls.tilt_angle)

		slot7 = self._wind_tilt_var

		self._wind_ctrls.tilt_variation.set_value(slot5, self._wind_ctrls.tilt_variation)

		slot6 = self

		self.set_wind(slot5)
	end

	if environment._unit_effects then
		slot4 = environment._unit_effects

		for _, effect in ipairs(slot3) do
			slot12 = effect.rot
			local unit = self.do_spawn_unit(slot8, self, self._effect_unit, effect.pos)
			slot12 = effect.name

			self.play_effect(self, self, unit)
		end
	end

	slot6 = managers.environment_area

	for _, area in ipairs(managers.environment_area.areas(slot5)) do
		slot11 = area.position(slot12)
		slot14 = area
		local unit = EnvironmentLayer.super.do_spawn_unit(slot8, self, self._environment_area_unit, area.rotation(area))
		slot10 = unit
		unit.unit_data(self).environment_area = area
		slot10 = unit
		slot11 = unit
		local new_name_id = unit.unit_data(self).environment_area.set_unit(self, unit.unit_data(self).environment_area)

		if new_name_id then
			slot13 = new_name_id

			self.set_name_id(slot10, self, unit)
		end
	end

	if environment._units then
		slot4 = environment._units

		for _, unit in ipairs(slot3) do
			slot10 = unit

			self.set_up_name_id(slot8, self)

			slot10 = unit

			table.insert(slot8, self._created_units)
		end
	end

	slot4 = self

	self.clear_selected_units(slot3)

	return environment
end
EnvironmentLayer.save = function (self)
	local effects = {}
	local environment_areas = {}
	local environment_paths = {}
	local environment_scenes = {}
	local cubemap_gizmos = {}
	local dome_occ_shapes = {}
	slot9 = self._created_units

	for _, unit in ipairs(slot8) do
		slot15 = self._effect_unit

		if unit.name(slot13) == Idstring(unit) then
			slot14 = unit
			local effect = unit.unit_data(slot13).effect or "none"
			local name_id = unit.unit_data(slot14).name_id
			slot17 = {
				name = effect,
				name_id = name_id,
				position = unit.position(slot19),
				rotation = unit.rotation(slot19)
			}
			slot20 = unit
			slot20 = unit

			table.insert(unit, effects)

			slot18 = effect

			self._save_to_world_package(unit, self, "effects")
		else
			slot15 = self._environment_area_unit

			if unit.name(slot13) == Idstring(unit) then
				local area = unit.unit_data(slot13).environment_area
				local environment_path = area.environment(unit)
				slot16 = environment_areas
				slot19 = area

				table.insert(area, area.save_level_data(slot18))

				slot17 = environment_path

				table.insert(area, environment_paths)

				slot16 = area
			else
				slot15 = self._cubemap_unit

				if unit.name(slot13) == Idstring(unit) then
					slot14 = cubemap_gizmos
					slot17 = unit

					table.insert(slot13, CoreEditorSave.save_data_table(slot16))
				else
					slot15 = self._dome_occ_shape_unit

					if unit.name(slot13) == Idstring(unit) then
						local shape = unit.unit_data(slot13).occ_shape
						slot15 = dome_occ_shapes
						slot18 = shape

						table.insert(unit, shape.save_level_data(slot17))
					end
				end
			end
		end
	end

	local wind = {}
	slot10 = self._wind_rot
	wind.angle = self._wind_rot.yaw(slot9)
	wind.angle_var = self._wind_dir_var
	wind.tilt = self._wind_rot.roll(slot9)
	wind.tilt_var = self._wind_tilt_var
	wind.speed = self._wind_speed
	wind.speed_variation = self._wind_speed_variation
	local data = {
		environment_values = self._environment_values,
		wind = wind,
		effects = effects,
		environment_areas = environment_areas,
		cubemap_gizmos = cubemap_gizmos,
		dome_occ_shapes = dome_occ_shapes
	}
	slot12 = data

	self._add_project_save_data(self._wind_rot, self)

	local t = {
		single_data_block = true,
		entry = self._save_name,
		data = data
	}
	slot13 = t

	managers.editor.add_save_data(self, managers.editor)

	slot13 = self._environment_values.environment

	table.insert(self, environment_paths)

	slot12 = environment_scenes
	slot17 = CoreEnvironmentFeeder.UnderlayPathFeeder.DATA_PATH_KEY

	table.insert(self, managers.viewport.get_environment_value(slot14, managers.viewport, self._environment_values.environment))

	slot12 = environment_paths

	for _, environment_path in ipairs(self) do
		slot19 = environment_path .. ".environment"

		self._save_to_world_package(slot16, self, "script_data")
	end

	slot12 = environment_scenes

	for _, environment_scene in ipairs(slot11) do
		slot19 = environment_scene

		self._save_to_world_package(slot16, self, "scenes")
	end

	return 
end
EnvironmentLayer._save_to_world_package = function (self, category, name)
	if name and name ~= "none" then
		slot6 = {
			category = category,
			name = name
		}

		managers.editor.add_to_world_package(slot4, managers.editor)
	end

	return 
end
EnvironmentLayer.update = function (self, t, dt)
	slot7 = dt

	EnvironmentLayer.super.update(slot4, self, t)

	if self._draw_wind then
		for i = -0.9, 1.2, 0.3 do
			for j = -0.9, 1.2, 0.3 do
				slot13 = self
				slot21 = 0
				slot18 = 1000

				self.draw_wind(slot12, self._owner.screen_to_world(slot15, self._owner, Vector3(slot18, j, i)))
			end
		end
	end

	slot5 = self._created_units

	for _, unit in ipairs(slot4) do
		slot10 = unit

		if unit.unit_data(slot9).current_effect then
			slot10 = World
			slot11 = unit.unit_data(slot12).current_effect
			slot14 = unit

			World.effect_manager(slot9).move(slot9, World.effect_manager(slot9), unit.position(unit))

			slot10 = World
			slot11 = unit.unit_data(unit.position).current_effect
			slot14 = unit

			World.effect_manager(slot9).rotate(slot9, World.effect_manager(slot9), unit.rotation(unit))
		end

		slot11 = self._effect_unit

		if unit.name(slot9) == Idstring(unit) then
			slot14 = 1

			Application.draw(slot9, Application, unit, 0, 0)
		end

		slot11 = self._environment_area_unit

		if unit.name(slot9) == Idstring(unit) then
			local r = 0
			local g = 0.5
			local b = 0.5
			slot13 = self._selected_unit

			if alive(slot12) and unit == self._selected_unit then
				b = 1
				g = 1
				r = 0
			end

			slot17 = b

			Application.draw(slot12, Application, unit, r, g)

			slot13 = unit
			slot18 = b

			unit.unit_data(slot12).environment_area.draw(slot12, unit.unit_data(slot12).environment_area, t, dt, r, g)
		end

		if self._draw_occ_shape then
			slot11 = self._dome_occ_shape_unit

			if unit.name(slot9) == Idstring(unit) then
				local r = 0.5
				local g = 0
				local b = 0.5
				slot13 = self._selected_unit

				if alive(slot12) and unit == self._selected_unit then
					b = 1
					g = 0
					r = 1
				end

				slot17 = b

				Application.draw(slot12, Application, unit, r, g)

				slot13 = unit
				slot18 = b

				unit.unit_data(slot12).occ_shape.draw(slot12, unit.unit_data(slot12).occ_shape, t, dt, r, g)
			end
		end
	end

	return 
end
EnvironmentLayer.draw_wind = function (self, pos)
	slot4 = self._wind_rot.yaw(slot5)
	slot6 = self._wind_rot.roll(self._wind_rot) * -1
	local rot = Rotation(slot3, slot4, self._wind_rot.pitch(self._wind_rot))
	slot9 = rot

	self._wind_pen.arrow(slot4, self._wind_pen, pos, pos + rot.x(self._wind_rot) * 300)

	slot9 = rot
	slot11 = rot

	self._wind_pen.arc(slot4, self._wind_pen, pos, pos + rot.x(0.25) * 100, self._wind_dir_var, rot.z(slot10))

	slot9 = rot
	slot11 = rot

	self._wind_pen.arc(slot4, self._wind_pen, pos, pos + rot.x(self._wind_dir_var) * 100, -self._wind_dir_var, rot.z(32))

	slot9 = rot
	slot11 = rot

	self._wind_pen.arc(slot4, self._wind_pen, pos, pos + rot.x(-self._wind_dir_var) * 100, self._wind_tilt_var, rot.y(32))

	slot9 = rot
	slot11 = rot
	slot10 = 32

	self._wind_pen.arc(slot4, self._wind_pen, pos, pos + rot.x(self._wind_tilt_var) * 100, -self._wind_tilt_var, rot.y(32))

	return 
end
EnvironmentLayer._build_environment_combobox_and_list = function (self)
	slot3 = {
		name = "Default",
		panel = self._env_panel,
		sizer = self._environment_sizer,
		options = managers.database.list_entries_of_type(slot5, managers.database),
		value = self._environment_values.environment,
		value_changed_cb = function (params)
			slot4 = params.ctrlr

			self.change_environment(slot2, self)

			return 
		end
	}
	local ctrlr, combobox_params = CoreEws.combobox_and_list(slot2)
	self._environments_combobox = combobox_params
	slot5 = managers.viewport
	slot10 = "on_environment_list_changed"

	managers.viewport.editor_add_environment_created_callback(function (params)
		slot4 = params.ctrlr

		self.change_environment(slot2, self)

		return 
	end, callback("environment", self, self))

	return 
end
EnvironmentLayer.on_environment_list_changed = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-23, warpins: 1 ---
	slot4 = "environment"
	local list = managers.database.list_entries_of_type(slot2, managers.database)
	local selected_value = self._environments_combobox.ctrlr.get_value(managers.database)
	slot6 = list

	CoreEws.update_combobox_options(self._environments_combobox.ctrlr, self._environments_combobox)

	slot6 = selected_value

	if table.contains(self._environments_combobox.ctrlr, list) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 24-29, warpins: 1 ---
		slot6 = selected_value

		self._environments_combobox.ctrlr.set_value(slot4, self._environments_combobox.ctrlr)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 30-30, warpins: 2 ---
	return 
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.build_panel = function (self, notebook)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-430, warpins: 1 ---
	slot5 = notebook

	EnvironmentLayer.super.build_panel(slot3, self)

	slot5 = "EnvironmentLayer:build_panel"

	cat_print(slot3, "editor")

	slot7 = "TAB_TRAVERSAL"
	self._env_panel = EWS.Panel(slot3, EWS, self._ews_panel, "")
	slot5 = "VERTICAL"
	self._env_sizer = EWS.BoxSizer(slot3, EWS)
	slot5 = self._env_sizer

	self._env_panel.set_sizer(slot3, self._env_panel)

	slot7 = "Cubemaps"
	local cubemap_sizer = EWS.StaticBoxSizer(slot3, EWS, self._env_panel, "HORIZONTAL")
	slot9 = "BU_EXACTFIT,NO_BORDER"
	local create_cube_map = EWS.Button(EWS, EWS, self._env_panel, "Generate all", "")
	slot10 = "EXPAND,TOP,RIGHT"

	cubemap_sizer.add(EWS, cubemap_sizer, create_cube_map, 1, 5)

	slot12 = "create_cube_map"
	slot9 = "all"

	create_cube_map.connect(EWS, create_cube_map, "EVT_COMMAND_BUTTON_CLICKED", callback(5, self, self))

	slot10 = "BU_EXACTFIT,NO_BORDER"
	local create_selected_cube_map = EWS.Button(EWS, EWS, self._env_panel, "Generate selected", "")
	slot11 = "EXPAND,TOP"

	cubemap_sizer.add(EWS, cubemap_sizer, create_selected_cube_map, 1, 5)

	slot13 = "create_cube_map"
	slot10 = "selected"

	create_selected_cube_map.connect(EWS, create_selected_cube_map, "EVT_COMMAND_BUTTON_CLICKED", callback(5, self, self))

	slot11 = "EXPAND"

	self._env_sizer.add(EWS, self._env_sizer, cubemap_sizer, 0, 0)

	slot10 = "Environment"
	self._environment_sizer = EWS.StaticBoxSizer(EWS, EWS, self._env_panel, "VERTICAL")
	slot7 = self

	self._build_environment_combobox_and_list(EWS)

	self._environment_area_ctrls = {}
	slot7 = {
		name = "Area:",
		panel = self._env_panel,
		sizer = self._environment_sizer,
		options = managers.database.list_entries_of_type("VERTICAL", managers.database),
		value = managers.viewport.game_default_environment("VERTICAL"),
		value_changed_cb = function (params)

			-- Decompilation error in this vicinity:
			--- BLOCK #0 1-6, warpins: 1 ---
			slot4 = params.ctrlr

			self.set_environment_area(slot2, self)

			return 
			--- END OF BLOCK #0 ---



		end
	}
	slot11 = "environment"
	slot10 = managers.viewport
	local ctrlr, combobox_params = CoreEws.combobox_and_list(EWS)
	self._environment_area_ctrls.environment_combobox = combobox_params
	slot10 = "HORIZONTAL"
	local transition_prio_sizer = EWS.BoxSizer(function (params)

		-- Decompilation error in this vicinity:
		--- BLOCK #0 1-6, warpins: 1 ---
		slot4 = params.ctrlr

		self.set_environment_area(slot2, self)

		return 
		--- END OF BLOCK #0 ---



	end, EWS)
	slot17 = ""
	slot14 = "ALIGN_CENTER_VERTICAL"

	transition_prio_sizer.add(EWS, transition_prio_sizer, EWS.StaticText(self, EWS, self._env_panel, "Fade Time [sec]: ", ""), 0, 0)

	slot13 = managers.environment_area
	local default_transition_text = string.format(EWS, managers.environment_area.default_transition_time(0))
	slot15 = "TE_CENTRE"
	local transition = EWS.TextCtrl("%.2f", EWS, self._env_panel, default_transition_text, "")
	slot16 = "EXPAND"

	transition_prio_sizer.add(EWS, transition_prio_sizer, transition, 3, 0)

	slot18 = "verify_number"

	transition.connect(EWS, transition, "EVT_CHAR", callback(0, nil, _G))

	slot18 = "set_transition_time"

	transition.connect(EWS, transition, "EVT_COMMAND_TEXT_ENTER", callback(transition, self, self))

	slot18 = "set_transition_time"
	slot15 = nil

	transition.connect(EWS, transition, "EVT_KILL_FOCUS", callback(nil, self, self))
	transition_prio_sizer.add_spacer(EWS, transition_prio_sizer, 10)

	slot19 = ""
	slot16 = "ALIGN_CENTER_VERTICAL"

	transition_prio_sizer.add(EWS, transition_prio_sizer, EWS.StaticText(0, EWS, self._env_panel, "Prio (1=highest): ", ""), 0, 0)

	slot14 = managers.environment_area
	local default_prio_text = tostring(managers.environment_area.default_prio(EWS.StaticText(0, EWS, self._env_panel, "Prio (1=highest): ", "")))
	slot17 = "TE_CENTRE"
	local prio = EWS.TextCtrl(managers.environment_area.default_prio, EWS, self._env_panel, default_prio_text, "")
	slot18 = "EXPAND"

	transition_prio_sizer.add(EWS, transition_prio_sizer, prio, 3, 0)

	slot20 = "verify_number"

	prio.connect(EWS, prio, "EVT_CHAR", callback(0, nil, _G))

	slot20 = "set_prio"

	prio.connect(EWS, prio, "EVT_COMMAND_TEXT_ENTER", callback(prio, self, self))

	slot20 = "set_prio"
	slot17 = nil

	prio.connect(EWS, prio, "EVT_KILL_FOCUS", callback(nil, self, self))

	slot18 = "EXPAND"

	self._environment_sizer.add(EWS, self._environment_sizer, transition_prio_sizer, 0, 0)

	slot17 = ""
	local permanent_cb = EWS.CheckBox(EWS, EWS, self._env_panel, "Permanent")
	slot16 = false

	permanent_cb.set_value(EWS, permanent_cb)

	slot16 = "This is only useful when it's a linear single player game."

	permanent_cb.set_tool_tip(EWS, permanent_cb)

	slot16 = self.ENABLE_PERMANENT

	permanent_cb.set_enabled(EWS, permanent_cb)

	slot19 = "EXPAND"

	self._environment_sizer.add(EWS, self._environment_sizer, permanent_cb, 0, 0)

	slot21 = "set_permanent"
	slot18 = nil

	permanent_cb.connect(EWS, permanent_cb, "EVT_COMMAND_CHECKBOX_CLICKED", callback(0, self, self))

	self._environment_area_ctrls.transition_time = transition
	self._environment_area_ctrls.prio = prio
	self._environment_area_ctrls.permanent_cb = permanent_cb
	slot19 = "EXPAND"

	self._env_sizer.add(EWS, self._env_sizer, self._environment_sizer, 0, 0)

	slot18 = "Dome Occlusion Shape"
	self._dome_occ_sizer = EWS.StaticBoxSizer(EWS, EWS, self._env_panel, "VERTICAL")
	slot18 = ""
	local draw_occ_cb = EWS.CheckBox(EWS, EWS, self._env_panel, "Draw")
	slot17 = self._draw_occ_shape

	draw_occ_cb.set_value(EWS, draw_occ_cb)

	slot20 = "EXPAND"

	self._dome_occ_sizer.add(EWS, self._dome_occ_sizer, draw_occ_cb, 0, 0)

	slot22 = "cb_toogle"
	slot19 = {
		value = "_draw_occ_shape",
		cb = draw_occ_cb
	}

	draw_occ_cb.connect(EWS, draw_occ_cb, "EVT_COMMAND_CHECKBOX_CLICKED", callback(0, self, self))

	slot20 = "BU_EXACTFIT,NO_BORDER"
	local generate_dome_occ = EWS.Button(EWS, EWS, self._env_panel, "Generate", "")
	slot21 = "EXPAND,TOP,RIGHT"

	self._dome_occ_sizer.add(EWS, self._dome_occ_sizer, generate_dome_occ, 1, 5)

	slot23 = "generate_dome_occ"

	generate_dome_occ.connect(EWS, generate_dome_occ, "EVT_COMMAND_BUTTON_CLICKED", callback(5, self, self))

	slot18 = "HORIZONTAL"
	local resolution_sizer = EWS.BoxSizer(EWS, EWS)
	slot25 = ""
	slot22 = "ALIGN_CENTER_VERTICAL"

	resolution_sizer.add(EWS, resolution_sizer, EWS.StaticText("all", EWS, self._env_panel, "Resolution:", 0), 2, 0)

	slot22 = "CB_DROPDOWN,CB_READONLY"
	local resolution = EWS.ComboBox(EWS, EWS, self._env_panel, "", "")
	slot19 = {
		64,
		128,
		256,
		512,
		1024
	}

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 431-436, warpins: 0 ---
	for _, res in pairs(EWS) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 431-434, warpins: 1 ---
		slot25 = res

		resolution.append(slot23, resolution)
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 435-436, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 437-1077, warpins: 1 ---
	slot20 = self._environment_values.dome_occ_resolution

	resolution.set_value(slot18, resolution)

	slot25 = "set_dome_occ_resolution"
	slot22 = resolution

	resolution.connect(slot18, resolution, "EVT_COMMAND_COMBOBOX_SELECTED", callback(slot22, self, self))

	slot23 = "EXPAND"

	resolution_sizer.add(slot18, resolution_sizer, resolution, 3, 0)

	self._dome_occ_resolution_ctrlr = resolution
	slot23 = "EXPAND"

	self._dome_occ_sizer.add(slot18, self._dome_occ_sizer, resolution_sizer, 0, 0)

	slot23 = "EXPAND"

	self._env_sizer.add(slot18, self._env_sizer, self._dome_occ_sizer, 0, 0)

	slot22 = "Wind"
	local wind_sizer = EWS.StaticBoxSizer(slot18, EWS, self._env_panel, "VERTICAL")
	slot23 = ""
	local show_wind_cb = EWS.CheckBox(EWS, EWS, self._env_panel, "Draw Wind")
	slot22 = self._draw_wind

	show_wind_cb.set_value(EWS, show_wind_cb)

	slot25 = "EXPAND"

	wind_sizer.add(EWS, wind_sizer, show_wind_cb, 0, 0)

	slot27 = "cb_toogle"
	slot24 = {
		value = "_draw_wind",
		cb = show_wind_cb
	}

	show_wind_cb.connect(EWS, show_wind_cb, "EVT_COMMAND_CHECKBOX_CLICKED", callback(0, self, self))

	slot24 = "Direction / Variation"
	local direction_sizer = EWS.StaticBoxSizer(EWS, EWS, self._env_panel, "HORIZONTAL")
	slot28 = ""
	local wind_direction = EWS.Slider(EWS, EWS, self._env_panel, 0, 0, 360, "")
	slot29 = "update_wind_direction"

	wind_direction.connect(EWS, wind_direction, "EVT_SCROLL_CHANGED", callback(360, self, self))

	slot29 = "update_wind_direction"
	slot26 = wind_direction

	wind_direction.connect(EWS, wind_direction, "EVT_SCROLL_THUMBTRACK", callback(wind_direction, self, self))

	slot27 = "EXPAND"

	direction_sizer.add(EWS, direction_sizer, wind_direction, 2, 0)

	local wind_variation = EWS.SpinCtrl(EWS, EWS, self._env_panel, 0, "")
	slot26 = 180

	wind_variation.set_range(EWS, wind_variation, 0)

	slot30 = "update_wind_variation"

	wind_variation.connect(EWS, wind_variation, "EVT_SCROLL_THUMBTRACK", callback("", self, self))

	slot30 = "update_wind_variation"
	slot27 = wind_variation

	wind_variation.connect(EWS, wind_variation, "EVT_COMMAND_TEXT_UPDATED", callback(wind_variation, self, self))

	slot28 = "EXPAND"

	direction_sizer.add(EWS, direction_sizer, wind_variation, 1, 0)

	slot28 = "EXPAND"

	wind_sizer.add(EWS, wind_sizer, direction_sizer, 0, 0)

	slot27 = "Tilt / Variation"
	local tilt_sizer = EWS.StaticBoxSizer(EWS, EWS, self._env_panel, "HORIZONTAL")
	slot31 = ""
	local tilt_angle = EWS.Slider(EWS, EWS, self._env_panel, 0, -90, 90, "")
	slot32 = "update_tilt_angle"

	tilt_angle.connect(EWS, tilt_angle, "EVT_SCROLL_CHANGED", callback(90, self, self))

	slot32 = "update_tilt_angle"
	slot29 = tilt_angle

	tilt_angle.connect(EWS, tilt_angle, "EVT_SCROLL_THUMBTRACK", callback(tilt_angle, self, self))

	slot30 = "EXPAND"

	tilt_sizer.add(EWS, tilt_sizer, tilt_angle, 2, 0)

	local tilt_variation = EWS.SpinCtrl(EWS, EWS, self._env_panel, 0, "")
	slot29 = 90

	tilt_variation.set_range(EWS, tilt_variation, -90)

	slot33 = "update_tilt_variation"

	tilt_variation.connect(EWS, tilt_variation, "EVT_SCROLL_THUMBTRACK", callback("", self, self))

	slot33 = "update_tilt_variation"
	slot30 = tilt_variation

	tilt_variation.connect(EWS, tilt_variation, "EVT_COMMAND_TEXT_UPDATED", callback(tilt_variation, self, self))

	slot31 = "EXPAND"

	tilt_sizer.add(EWS, tilt_sizer, tilt_variation, 1, 0)

	slot31 = "EXPAND"

	wind_sizer.add(EWS, wind_sizer, tilt_sizer, 0, 0)

	slot30 = "Speed / Variation"
	local speed_sizer = EWS.StaticBoxSizer(EWS, EWS, self._env_panel, "VERTICAL")
	slot29 = "HORIZONTAL"
	local speed_help_sizer = EWS.BoxSizer(EWS, EWS)
	self._speed_text = EWS.StaticText(EWS, EWS, self._env_panel, self._wind_speed .. " m/s", 0)
	slot35 = self._wind_speed
	slot33 = ""
	self._speed_beaufort = EWS.StaticText(EWS, EWS, self._env_panel, "Beaufort: " .. self.wind_beaufort("", self), 0)
	slot34 = self._wind_speed
	slot33 = ""
	self._speed_description = EWS.StaticText(EWS, EWS, self._env_panel, self.wind_description(0, self), 0)
	slot30 = 9

	self._speed_text.set_font_size(EWS, self._speed_text)

	slot30 = 9

	self._speed_beaufort.set_font_size(EWS, self._speed_beaufort)

	slot30 = 9

	self._speed_description.set_font_size(EWS, self._speed_description)

	slot33 = "EXPAND"

	speed_help_sizer.add(EWS, speed_help_sizer, self._speed_description, 4, 0)

	slot33 = "EXPAND"

	speed_help_sizer.add(EWS, speed_help_sizer, self._speed_beaufort, 3, 0)

	slot33 = "toolbar\\help_16x16.png"
	local wind_speed_help = EWS.BitmapButton(EWS, EWS, self._env_panel, CoreEws.image_path(0), "")
	slot31 = "Wind speed references."

	wind_speed_help.set_tool_tip(EWS, wind_speed_help)

	slot36 = "on_wind_speed_help"
	slot33 = nil

	wind_speed_help.connect(EWS, wind_speed_help, "EVT_COMMAND_BUTTON_CLICKED", callback("NO_BORDER", self, self))

	slot34 = "EXPAND"

	speed_help_sizer.add(EWS, speed_help_sizer, wind_speed_help, 0, 0)

	slot34 = "EXPAND"

	speed_sizer.add(EWS, speed_sizer, speed_help_sizer, 0, 0)

	slot31 = "HORIZONTAL"
	local wind_speed_sizer = EWS.BoxSizer(EWS, EWS)
	slot37 = ""
	local wind_speed = EWS.Slider(EWS, EWS, self._env_panel, self._wind_speed * 10, 0, 408, "")
	slot33 = "Wind speed [m/s]"

	wind_speed.set_tool_tip(EWS, wind_speed)

	slot38 = "update_wind_speed"

	wind_speed.connect(EWS, wind_speed, "EVT_SCROLL_CHANGED", callback(408, self, self))

	slot38 = "update_wind_speed"
	slot35 = wind_speed

	wind_speed.connect(EWS, wind_speed, "EVT_SCROLL_THUMBTRACK", callback(wind_speed, self, self))

	slot36 = "EXPAND,RIGHT"

	wind_speed_sizer.add(EWS, wind_speed_sizer, wind_speed, 10, 5)

	slot36 = "EXPAND,ALIGN_CENTER_VERTICAL"

	wind_speed_sizer.add(EWS, wind_speed_sizer, self._speed_text, 3, 0)

	slot36 = "EXPAND"

	speed_sizer.add(EWS, speed_sizer, wind_speed_sizer, 0, 0)

	slot33 = "HORIZONTAL"
	local wind_speed_variation_sizer = EWS.BoxSizer(EWS, EWS)
	slot39 = ""
	local wind_speed_variation = EWS.Slider(EWS, EWS, self._env_panel, self._wind_speed_variation * 10, 0, 408, "")
	slot35 = "Wind speed variation [m/s]"

	wind_speed_variation.set_tool_tip(EWS, wind_speed_variation)

	slot40 = "update_wind_speed_variation"

	wind_speed_variation.connect(EWS, wind_speed_variation, "EVT_SCROLL_CHANGED", callback(408, self, self))

	slot40 = "update_wind_speed_variation"
	slot37 = wind_speed_variation

	wind_speed_variation.connect(EWS, wind_speed_variation, "EVT_SCROLL_THUMBTRACK", callback(wind_speed_variation, self, self))

	slot38 = "EXPAND,RIGHT"

	wind_speed_variation_sizer.add(EWS, wind_speed_variation_sizer, wind_speed_variation, 10, 5)

	slot38 = ""
	self._speed_variation_text = EWS.StaticText(EWS, EWS, self._env_panel, self._wind_speed_variation .. " m/s", 0)
	slot35 = 9

	self._speed_variation_text.set_font_size(EWS, self._speed_variation_text)

	slot38 = "EXPAND,ALIGN_CENTER_VERTICAL"

	wind_speed_variation_sizer.add(EWS, wind_speed_variation_sizer, self._speed_variation_text, 3, 0)

	slot38 = "EXPAND"

	speed_sizer.add(EWS, speed_sizer, wind_speed_variation_sizer, 0, 0)

	slot38 = "EXPAND"

	wind_sizer.add(EWS, wind_sizer, speed_sizer, 0, 0)

	slot38 = "EXPAND"

	self._env_sizer.add(EWS, self._env_sizer, wind_sizer, 0, 0)

	self._wind_ctrls = {}
	self._wind_ctrls.wind_direction = wind_direction
	self._wind_ctrls.wind_variation = wind_variation
	self._wind_ctrls.tilt_angle = tilt_angle
	self._wind_ctrls.tilt_variation = tilt_variation
	self._wind_ctrls.wind_speed = wind_speed
	self._wind_ctrls.wind_speed_variation = wind_speed_variation
	slot35 = "HORIZONTAL"
	local unit_effect_sizer = EWS.BoxSizer(EWS, EWS)
	slot42 = ""
	slot39 = "EXPAND,ALIGN_CENTER_VERTICAL,TOP"

	unit_effect_sizer.add(EWS, unit_effect_sizer, EWS.StaticText(0, EWS, self._env_panel, "Effect", 0), 1, 5)

	slot39 = "CB_DROPDOWN,CB_READONLY"
	self._unit_effects = EWS.ComboBox(EWS, EWS, self._env_panel, "", "")
	slot35 = self

	self.populate_unit_effects(EWS)

	slot41 = "change_unit_effect"
	slot38 = nil

	self._unit_effects.connect(EWS, self._unit_effects, "EVT_COMMAND_COMBOBOX_SELECTED", callback("", self, self))

	slot39 = "EXPAND"

	unit_effect_sizer.add(EWS, unit_effect_sizer, self._unit_effects, 4, 0)

	slot39 = "world_editor\\reload_unit_effects.png"
	local reload_effects = EWS.BitmapButton(EWS, EWS, self._env_panel, CoreEws.image_path(0), "")
	slot37 = "Repopulate combo box with effects from the database."

	reload_effects.set_tool_tip(EWS, reload_effects)

	slot42 = "populate_unit_effects"
	slot39 = nil

	reload_effects.connect(EWS, reload_effects, "EVT_COMMAND_BUTTON_CLICKED", callback("NO_BORDER", self, self))

	slot40 = "EXPAND,LEFT"

	unit_effect_sizer.add(EWS, unit_effect_sizer, reload_effects, 0, 5)

	slot40 = "EXPAND"

	self._env_sizer.add(EWS, self._env_sizer, unit_effect_sizer, 0, 0)

	slot40 = "EXPAND"

	self._sizer.add(EWS, self._sizer, self._env_panel, 4, 0)

	return self._ews_panel
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.populate_unit_effects = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-18, warpins: 1 ---
	slot3 = self._unit_effects

	self._unit_effects.clear(slot2)
	self._unit_effects.append(slot2, self._unit_effects)

	slot6 = "effect"

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 19-32, warpins: 0 ---
	for _, name in ipairs(managers.database.list_entries_of_type("none", managers.database)) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 19-25, warpins: 1 ---
		slot9 = "scene_"

		if string.match(slot7, name) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 26-30, warpins: 1 ---
			slot9 = name

			self._unit_effects.append(slot7, self._unit_effects)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 31-32, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 33-41, warpins: 1 ---
	slot4 = "none"

	self._unit_effects.set_value(slot2, self._unit_effects)

	slot3 = self

	self.update_unit_settings(slot2)

	return 
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.create_cube_map = function (self, type)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-3, warpins: 1 ---
	local cubes = {}

	if type == "all" then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 4-7, warpins: 1 ---
		slot5 = self._created_units

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 8-31, warpins: 0 ---
		for _, unit in ipairs(slot4) do

			-- Decompilation error in this vicinity:
			--- BLOCK #0 8-15, warpins: 1 ---
			slot11 = self._cubemap_unit

			if unit.name(slot9) == Idstring(unit) then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 16-29, warpins: 1 ---
				slot11 = {
					output_name = "outputcube",
					position = unit.position(slot13),
					name = unit.unit_data(slot13).name_id
				}
				slot14 = unit
				slot14 = unit

				table.insert(slot9, cubes)
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 30-31, warpins: 3 ---
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 32-32, warpins: 1 ---
		--- END OF BLOCK #2 ---



	else

		-- Decompilation error in this vicinity:
		--- BLOCK #0 33-34, warpins: 1 ---
		if type == "selected" then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 35-43, warpins: 1 ---
			slot6 = self._cubemap_unit

			if self._selected_unit.name(slot4) == Idstring(self._selected_unit) then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 44-59, warpins: 1 ---
				slot6 = {
					output_name = "outputcube",
					position = self._selected_unit.position(slot8),
					name = self._selected_unit.unit_data(slot8).name_id
				}
				slot9 = self._selected_unit
				slot9 = self._selected_unit

				table.insert(slot4, cubes)
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 60-76, warpins: 4 ---
	local params = {}
	params.cubes = cubes
	slot6 = managers.database
	params.output_path = managers.database.base_path(slot5) .. "environments\\cubemaps\\"
	slot7 = params

	managers.editor.create_cube_map("environments\\cubemaps\\", managers.editor)

	return 
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.change_environment = function (self, ctrlr)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	slot5 = ctrlr
	self._environment_values.environment = ctrlr.get_value(slot4)

	managers.viewport.set_default_environment(ctrlr.get_value(slot4), managers.viewport, self._environment_values.environment, nil)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.set_environment_area = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	local area = self._selected_unit.unit_data(slot2).environment_area
	slot5 = self._environment_area_ctrls.environment_combobox.value

	area.set_environment(self._selected_unit, area)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.set_permanent = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-14, warpins: 1 ---
	local area = self._selected_unit.unit_data(slot2).environment_area
	slot4 = area
	slot7 = self._environment_area_ctrls.permanent_cb

	area.set_permanent(self._selected_unit, self._environment_area_ctrls.permanent_cb.get_value(slot6))

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.set_transition_time = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-34, warpins: 1 ---
	slot3 = self._selected_unit
	local area = self._selected_unit.unit_data(slot2).environment_area
	slot6 = self._environment_area_ctrls.transition_time
	local value = tonumber(self._environment_area_ctrls.transition_time.get_value(slot5))
	value = math.clamp(self._environment_area_ctrls.transition_time.get_value, value, 0)
	slot5 = self._environment_area_ctrls.transition_time
	slot9 = value

	self._environment_area_ctrls.transition_time.change_value(self._environment_area_ctrls.transition_time.get_value, string.format(100000000, "%.2f"))

	slot6 = value

	area.set_transition_time(self._environment_area_ctrls.transition_time.get_value, area)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.set_prio = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-32, warpins: 1 ---
	slot3 = self._selected_unit
	local area = self._selected_unit.unit_data(slot2).environment_area
	slot6 = self._environment_area_ctrls.prio
	local value = tonumber(self._environment_area_ctrls.prio.get_value(slot5))
	value = math.clamp(self._environment_area_ctrls.prio.get_value, value, 1)
	slot5 = self._environment_area_ctrls.prio
	slot8 = value

	self._environment_area_ctrls.prio.change_value(self._environment_area_ctrls.prio.get_value, tostring(100000000))

	slot6 = value

	area.set_prio(self._environment_area_ctrls.prio.get_value, area)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.generate_dome_occ = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-7, warpins: 1 ---
	local shape = nil
	slot6 = self

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 8-22, warpins: 0 ---
	for _, unit in ipairs(self.created_units(slot5)) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 8-15, warpins: 1 ---
		slot10 = self._dome_occ_shape_unit

		if unit.name(slot8) == Idstring(unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 16-20, warpins: 1 ---
			slot9 = unit
			shape = unit.unit_data(slot8).occ_shape

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 21-21, warpins: 1 ---
			break
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 21-22, warpins: 2 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 23-24, warpins: 2 ---
	if not shape then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 25-31, warpins: 1 ---
		slot5 = "No dome occ unit in level!"

		managers.editor.output_error(slot3, managers.editor)

		return 
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 32-35, warpins: 2 ---
	local res = self._environment_values.dome_occ_resolution or 256
	--- END OF BLOCK #3 ---

	FLOW; TARGET BLOCK #4



	-- Decompilation error in this vicinity:
	--- BLOCK #4 37-44, warpins: 2 ---
	slot7 = res

	managers.editor.init_create_dome_occlusion(slot4, managers.editor, shape)

	return 
	--- END OF BLOCK #4 ---



end
EnvironmentLayer.set_dome_occ_resolution = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-9, warpins: 1 ---
	slot6 = self._dome_occ_resolution_ctrlr
	self._environment_values.dome_occ_resolution = tonumber(self._dome_occ_resolution_ctrlr.get_value(slot5))

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_wind_direction = function (self, wind_direction)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-16, warpins: 1 ---
	local dir = wind_direction.get_value(slot3)
	slot6 = 0
	slot9 = self._wind_rot
	self._wind_rot = Rotation(wind_direction, dir, self._wind_rot.roll(slot8))
	slot5 = self

	self.set_wind(wind_direction)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.set_wind = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-33, warpins: 1 ---
	slot6 = self._wind_rot
	slot6 = 5

	Wind.set_direction(slot2, Wind, self._wind_rot.yaw(slot5), self._wind_dir_var)

	slot6 = self._wind_rot
	slot6 = 5

	Wind.set_tilt(slot2, Wind, self._wind_rot.roll(self._wind_dir_var), self._wind_tilt_var)

	slot6 = 5

	Wind.set_speed_m_s(slot2, Wind, self._wind_speed, self._wind_speed_variation)

	slot4 = true

	Wind.set_enabled(slot2, Wind)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_wind_variation = function (self, wind_variation)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot4 = wind_variation
	self._wind_dir_var = wind_variation.get_value(slot3)
	slot4 = self

	self.set_wind(slot3)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_tilt_angle = function (self, tilt_angle)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-16, warpins: 1 ---
	local dir = tilt_angle.get_value(slot3)
	slot7 = self._wind_rot
	slot7 = dir
	self._wind_rot = Rotation(tilt_angle, self._wind_rot.yaw(slot6), 0)
	slot5 = self

	self.set_wind(tilt_angle)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_tilt_variation = function (self, tilt_variation)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot4 = tilt_variation
	self._wind_tilt_var = tilt_variation.get_value(slot3)
	slot4 = self

	self.set_wind(slot3)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.on_wind_speed_help = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	slot4 = "http://en.wikipedia.org/wiki/Beaufort_scale"

	EWS.launch_url(slot2, EWS)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_wind_speed = function (self, wind_speed)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	slot4 = wind_speed
	self._wind_speed = wind_speed.get_value(slot3) / 10
	slot4 = self

	self.update_wind_speed_labels(slot3)

	slot4 = self

	self.set_wind(slot3)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_wind_speed_variation = function (self, wind_speed_variation)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	slot4 = wind_speed_variation
	self._wind_speed_variation = wind_speed_variation.get_value(slot3) / 10
	slot4 = self

	self.update_wind_speed_labels(slot3)

	slot4 = self

	self.set_wind(slot3)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_wind_speed_labels = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-41, warpins: 1 ---
	slot7 = self._wind_speed
	slot4 = string.format(slot5, "%.3g") .. " m/s"

	self._speed_text.set_value(slot2, self._speed_text)

	slot8 = self._wind_speed
	slot5 = self.wind_beaufort("%.3g", self)
	slot4 = "Beaufort: " .. slot5

	self._speed_beaufort.set_value(slot2, self._speed_beaufort)

	slot3 = self._speed_description
	slot7 = self._wind_speed

	self._speed_description.set_value(slot2, self.wind_description(slot5, self))

	slot7 = self._wind_speed_variation
	slot4 = string.format(slot5, "%.3g") .. " m/s"

	self._speed_variation_text.set_value(slot2, self._speed_variation_text)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.unit_ok = function (self, unit)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot5 = self._effect_unit
	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 36-36, warpins: 2 ---
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.do_spawn_unit = function (self, ...)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-11, warpins: 1 ---
	local unit = EnvironmentLayer.super.do_spawn_unit(slot2, ...)
	slot4 = unit

	if alive(self) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 12-19, warpins: 1 ---
		slot5 = self._environment_area_unit

		if unit.name(slot3) == Idstring(unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 20-25, warpins: 1 ---
			slot4 = unit

			if not unit.unit_data(slot3).environment_area then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 26-53, warpins: 1 ---
				slot6 = {}
				slot3 = managers.environment_area.add_area(unit, managers.environment_area)
				unit.unit_data(slot3).environment_area = slot3
				slot4 = unit
				slot5 = unit

				unit.unit_data(slot3).environment_area.set_unit(slot3, unit.unit_data(slot3).environment_area)

				slot4 = unit
				slot6 = self._environment_sizer
				self._current_shape_panel = unit.unit_data(slot3).environment_area.panel(slot3, unit.unit_data(slot3).environment_area, self._env_panel)
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 54-56, warpins: 2 ---
			slot4 = self

			self.set_environment_area_parameters(slot3)
			--- END OF BLOCK #1 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 57-64, warpins: 2 ---
		slot5 = self._dome_occ_shape_unit

		if unit.name(slot3) == Idstring(unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 65-70, warpins: 1 ---
			slot4 = unit

			if not unit.unit_data(slot3).occ_shape then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 71-98, warpins: 1 ---
				slot6 = {}
				slot3 = CoreShapeManager.ShapeBox.new(unit, CoreShapeManager.ShapeBox)
				unit.unit_data(slot3).occ_shape = slot3
				slot4 = unit
				slot5 = unit

				unit.unit_data(slot3).occ_shape.set_unit(slot3, unit.unit_data(slot3).occ_shape)

				slot4 = unit
				slot6 = self._dome_occ_sizer
				self._current_shape_panel = unit.unit_data(slot3).occ_shape.panel(slot3, unit.unit_data(slot3).occ_shape, self._env_panel)
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 99-101, warpins: 2 ---
			slot4 = self

			self.set_environment_area_parameters(slot3)
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 102-102, warpins: 3 ---
	return unit
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.clone_edited_values = function (self, unit, source)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-15, warpins: 1 ---
	slot7 = source

	EnvironmentLayer.super.clone_edited_values(slot4, self, unit)

	slot6 = self._environment_area_unit

	if unit.name(slot4) == Idstring(unit) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 16-36, warpins: 1 ---
		local area = unit.unit_data(slot4).environment_area
		local source_area = source.unit_data(unit).environment_area
		slot7 = area
		slot10 = source_area

		area.set_environment(source, source_area.environment(slot9))

		slot7 = area
		slot5 = area.set_filter_list
		slot10 = source_area

		if source_area.filter_list(slot9) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 37-42, warpins: 1 ---
			slot12 = source_area
			slot8 = table.list_copy(source_area.filter_list(slot11))
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 43-50, warpins: 2 ---
		slot5(slot6, slot7)

		slot7 = area
		slot5 = area.set_bezier_curve
		slot10 = source_area

		if source_area.bezier_curve(slot9) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 51-56, warpins: 1 ---
			slot12 = source_area
			slot8 = table.list_copy(source_area.bezier_curve(slot11))
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 57-99, warpins: 2 ---
		slot5(slot6, slot7)

		slot7 = area
		slot10 = source_area

		area.set_transition_time(slot6, source_area.transition_time(slot9))

		slot7 = area
		slot10 = source_area

		area.set_prio(slot6, source_area.prio(slot9))

		slot7 = area

		area.set_permanent(slot6, source_area.permanent(slot9))

		slot8 = "width"
		slot12 = "width"

		area.set_property(slot6, area, source_area.property(source_area, source_area))

		slot8 = "depth"
		slot12 = "depth"

		area.set_property(slot6, area, source_area.property(source_area, source_area))

		slot8 = "height"
		slot12 = "height"

		area.set_property(slot6, area, source_area.property(source_area, source_area))
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 100-107, warpins: 2 ---
	slot6 = self._effect_unit

	if unit.name(slot4) == Idstring(unit) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 108-115, warpins: 1 ---
		slot9 = source
		slot7 = source.unit_data(slot8).effect

		self.play_effect(slot4, self, unit)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 116-116, warpins: 2 ---
	return 
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.delete_unit = function (self, unit)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	slot5 = unit

	self.kill_effect(slot3, self)

	slot5 = self._environment_area_unit

	if unit.name(slot3) == Idstring(unit) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-30, warpins: 1 ---
		slot7 = unit
		slot5 = unit.unit_data(slot6).environment_area

		managers.environment_area.remove_area(slot3, managers.environment_area)

		slot4 = unit
		slot4 = unit.unit_data(slot3).environment_area

		if unit.unit_data(slot3).environment_area.panel(slot3) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 31-40, warpins: 1 ---
			slot5 = unit
			slot5 = unit.unit_data(slot4).environment_area

			if self._current_shape_panel == unit.unit_data(slot4).environment_area.panel(slot4) then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 41-42, warpins: 1 ---
				self._current_shape_panel = nil
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 43-56, warpins: 2 ---
			slot4 = unit
			slot4 = unit.unit_data(slot3).environment_area
			slot4 = unit.unit_data(slot3).environment_area.panel(slot3)

			unit.unit_data(slot3).environment_area.panel(slot3).destroy(slot3)

			slot4 = self._env_panel

			self._env_panel.layout(slot3)
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 57-64, warpins: 3 ---
	slot5 = self._dome_occ_shape_unit

	if unit.name(slot3) == Idstring(unit) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 65-73, warpins: 1 ---
		slot4 = unit
		slot4 = unit.unit_data(slot3).occ_shape

		if unit.unit_data(slot3).occ_shape.panel(slot3) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 74-83, warpins: 1 ---
			slot5 = unit
			slot5 = unit.unit_data(slot4).occ_shape

			if self._current_shape_panel == unit.unit_data(slot4).occ_shape.panel(slot4) then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 84-85, warpins: 1 ---
				self._current_shape_panel = nil
				--- END OF BLOCK #0 ---



			end

			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 86-99, warpins: 2 ---
			slot4 = unit
			slot4 = unit.unit_data(slot3).occ_shape
			slot4 = unit.unit_data(slot3).occ_shape.panel(slot3)

			unit.unit_data(slot3).occ_shape.panel(slot3).destroy(slot3)

			slot4 = self._env_panel

			self._env_panel.layout(slot3)
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 100-106, warpins: 3 ---
	slot5 = unit

	EnvironmentLayer.super.delete_unit(slot3, self)

	return 
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.play_effect = function (self, unit, effect)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-12, warpins: 1 ---
	slot5 = unit
	unit.unit_data(slot4).effect = effect
	slot7 = effect

	if DB.has(slot4, DB, "effect") then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 13-45, warpins: 1 ---
		slot5 = Idstring(slot6)
		slot8 = effect

		CoreEngineAccess._editor_load(slot4, effect.id("effect"))

		slot6 = World
		slot7 = {
			effect = Idstring(slot9),
			position = unit.position(slot9),
			rotation = unit.rotation(slot9)
		}
		slot10 = effect
		slot10 = unit
		slot10 = unit
		unit.unit_data(slot4).current_effect = World.effect_manager(unit).spawn(unit, World.effect_manager(unit))
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 46-46, warpins: 2 ---
	return 
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.kill_effect = function (self, unit)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-8, warpins: 1 ---
	slot5 = self._effect_unit

	if unit.name(slot3) == Idstring(unit) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 9-14, warpins: 1 ---
		slot4 = unit

		if unit.unit_data(slot3).current_effect then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 15-30, warpins: 1 ---
			slot4 = World
			slot7 = unit
			slot5 = unit.unit_data(slot6).current_effect

			World.effect_manager(slot3).kill(slot3, World.effect_manager(slot3))

			slot4 = unit
			unit.unit_data(slot3).current_effect = nil
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 31-31, warpins: 3 ---
	return 
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.change_unit_effect = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-13, warpins: 1 ---
	slot4 = self._selected_unit

	self.kill_effect(slot2, self)

	slot4 = self._selected_unit
	slot7 = self._unit_effects

	self.play_effect(slot2, self, self._unit_effects.get_value(slot6))

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.update_unit_settings = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-15, warpins: 1 ---
	slot3 = self

	EnvironmentLayer.super.update_unit_settings(slot2)

	slot4 = false

	self._unit_effects.set_enabled(slot2, self._unit_effects)

	slot3 = self._selected_unit

	if alive(slot2) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 16-24, warpins: 1 ---
		slot4 = self._effect_unit

		if self._selected_unit.name(slot2) == Idstring(self._selected_unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 25-39, warpins: 1 ---
			slot4 = true

			self._unit_effects.set_enabled(slot2, self._unit_effects)

			slot6 = self._selected_unit
			slot4 = self._selected_unit.unit_data(slot5).effect or "none"

			self._unit_effects.set_value(slot2, self._unit_effects)
			--- END OF BLOCK #0 ---

			FLOW; TARGET BLOCK #1



			-- Decompilation error in this vicinity:
			--- BLOCK #1 41-41, warpins: 2 ---
			--- END OF BLOCK #1 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 42-45, warpins: 3 ---
	slot3 = self

	self.set_environment_area_parameters(slot2)

	return 
	--- END OF BLOCK #1 ---



end
EnvironmentLayer.set_environment_area_parameters = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-27, warpins: 1 ---
	slot4 = false

	CoreEws.set_combobox_and_list_enabled(slot2, self._environment_area_ctrls.environment_combobox)

	slot4 = false

	self._environment_area_ctrls.permanent_cb.set_enabled(slot2, self._environment_area_ctrls.permanent_cb)

	slot4 = false

	self._environment_area_ctrls.transition_time.set_enabled(slot2, self._environment_area_ctrls.transition_time)

	slot4 = false

	self._environment_area_ctrls.prio.set_enabled(slot2, self._environment_area_ctrls.prio)

	if self._current_shape_panel then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 28-32, warpins: 1 ---
		slot4 = false

		self._current_shape_panel.set_visible(slot2, self._current_shape_panel)
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 33-37, warpins: 2 ---
	slot3 = self._selected_unit

	if alive(slot2) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 38-46, warpins: 1 ---
		slot4 = self._environment_area_unit

		if self._selected_unit.name(slot2) == Idstring(self._selected_unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 47-53, warpins: 1 ---
			slot3 = self._selected_unit
			local area = self._selected_unit.unit_data(slot2).environment_area

			if area then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 54-91, warpins: 1 ---
				self._current_shape_panel = area.panel(slot3, area, self._env_panel)
				slot5 = true

				self._current_shape_panel.set_visible(slot3, self._current_shape_panel)

				slot5 = true

				CoreEws.set_combobox_and_list_enabled(slot3, self._environment_area_ctrls.environment_combobox)

				slot4 = self._environment_area_ctrls.environment_combobox
				slot7 = area

				CoreEws.change_combobox_value(slot3, area.environment(self._environment_sizer))

				slot5 = self.ENABLE_PERMANENT

				self._environment_area_ctrls.permanent_cb.set_enabled(slot3, self._environment_area_ctrls.permanent_cb)

				slot4 = self._environment_area_ctrls.permanent_cb
				slot2 = self._environment_area_ctrls.permanent_cb.set_value

				if self.ENABLE_PERMANENT then

					-- Decompilation error in this vicinity:
					--- BLOCK #0 92-94, warpins: 1 ---
					slot7 = area
					slot5 = area.permanent(slot6)
					--- END OF BLOCK #0 ---



				end

				--- END OF BLOCK #0 ---

				FLOW; TARGET BLOCK #1



				-- Decompilation error in this vicinity:
				--- BLOCK #1 95-129, warpins: 2 ---
				slot2(slot3, slot4)

				slot5 = true

				self._environment_area_ctrls.transition_time.set_enabled(slot3, self._environment_area_ctrls.transition_time)

				slot4 = self._environment_area_ctrls.transition_time
				slot7 = "%.2f"
				slot10 = area

				self._environment_area_ctrls.transition_time.set_value(slot3, string.format(slot6, area.transition_time(slot9)))

				slot5 = true

				self._environment_area_ctrls.prio.set_enabled(slot3, self._environment_area_ctrls.prio)

				slot4 = self._environment_area_ctrls.prio
				slot9 = area

				self._environment_area_ctrls.prio.set_value(slot3, tostring(area.prio(area.transition_time)))
				--- END OF BLOCK #1 ---



			end
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 130-134, warpins: 4 ---
	slot3 = self._selected_unit

	if alive(slot2) then

		-- Decompilation error in this vicinity:
		--- BLOCK #0 135-143, warpins: 1 ---
		slot4 = self._dome_occ_shape_unit

		if self._selected_unit.name(slot2) == Idstring(self._selected_unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 144-150, warpins: 1 ---
			slot3 = self._selected_unit
			local shape = self._selected_unit.unit_data(slot2).occ_shape

			if shape then

				-- Decompilation error in this vicinity:
				--- BLOCK #0 151-161, warpins: 1 ---
				slot6 = self._dome_occ_sizer
				self._current_shape_panel = shape.panel(slot3, shape, self._env_panel)
				slot5 = true

				self._current_shape_panel.set_visible(slot3, self._current_shape_panel)
				--- END OF BLOCK #0 ---



			end
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---



	end

	--- END OF BLOCK #2 ---

	FLOW; TARGET BLOCK #3



	-- Decompilation error in this vicinity:
	--- BLOCK #3 162-174, warpins: 4 ---
	slot3 = self._env_panel

	self._env_panel.layout(slot2)

	slot3 = self._ews_panel

	self._ews_panel.fit_inside(slot2)

	slot3 = self._ews_panel

	self._ews_panel.refresh(slot2)

	return 
	--- END OF BLOCK #3 ---



end
EnvironmentLayer.wind_description = function (self, speed)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local description = nil
	slot5 = self._wind_speeds

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-12, warpins: 0 ---
	for _, data in ipairs(slot4) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-8, warpins: 1 ---
		if speed < data.speed then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 9-9, warpins: 1 ---
			return description
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 10-10, warpins: 2 ---
		description = data.description
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 11-12, warpins: 2 ---
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 13-13, warpins: 1 ---
	return description
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.wind_beaufort = function (self, speed)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-5, warpins: 1 ---
	local beaufort = nil
	slot5 = self._wind_speeds

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 6-12, warpins: 0 ---
	for _, data in ipairs(slot4) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 6-8, warpins: 1 ---
		if speed < data.speed then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 9-9, warpins: 1 ---
			return beaufort
			--- END OF BLOCK #0 ---



		end

		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 10-10, warpins: 2 ---
		beaufort = data.beaufort
		--- END OF BLOCK #1 ---

		FLOW; TARGET BLOCK #2



		-- Decompilation error in this vicinity:
		--- BLOCK #2 11-12, warpins: 2 ---
		--- END OF BLOCK #2 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 13-13, warpins: 1 ---
	return beaufort
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.reset_environment_values = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-19, warpins: 1 ---
	slot4 = managers.viewport
	self._environment_values.environment = managers.viewport.game_default_environment(slot3)
	slot4 = CoreEnvironmentFeeder.SkyRotationFeeder.DATA_PATH_KEY

	managers.viewport.update_global_environment_value(managers.viewport.game_default_environment(slot3), managers.viewport)

	self._environment_values.dome_occ_resolution = 256

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.clear = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-90, warpins: 1 ---
	slot3 = managers.viewport

	managers.viewport.editor_reset_environment(slot2)

	slot3 = self

	self.reset_environment_values(slot2)
	managers.viewport.set_default_environment(slot2, managers.viewport, self._environment_values.environment, nil)

	slot4 = self._environment_values.environment

	CoreEws.change_combobox_value(slot2, self._environments_combobox)

	slot4 = self._environment_values.dome_occ_resolution

	self._dome_occ_resolution_ctrlr.set_value(slot2, self._dome_occ_resolution_ctrlr)

	slot5 = 0
	self._wind_rot = Rotation(slot2, 0, 0)
	self._wind_dir_var = 0
	self._wind_tilt_var = 0
	self._wind_speed = 6
	self._wind_speed_variation = 1
	slot4 = self._wind_speed * 10

	self._wind_ctrls.wind_speed.set_value(slot2, self._wind_ctrls.wind_speed)

	slot4 = self._wind_speed_variation * 10

	self._wind_ctrls.wind_speed_variation.set_value(slot2, self._wind_ctrls.wind_speed_variation)

	slot3 = self

	self.update_wind_speed_labels(slot2)

	slot4 = 0

	self._wind_ctrls.wind_direction.set_value(slot2, self._wind_ctrls.wind_direction)

	slot4 = 0

	self._wind_ctrls.wind_variation.set_value(slot2, self._wind_ctrls.wind_variation)

	slot4 = 0

	self._wind_ctrls.tilt_angle.set_value(slot2, self._wind_ctrls.tilt_angle)

	slot4 = 0

	self._wind_ctrls.tilt_variation.set_value(slot2, self._wind_ctrls.tilt_variation)

	slot3 = self

	self.set_wind(slot2)

	slot3 = self._created_units

	--- END OF BLOCK #0 ---

	FLOW; TARGET BLOCK #1



	-- Decompilation error in this vicinity:
	--- BLOCK #1 91-113, warpins: 0 ---
	for _, unit in ipairs(slot2) do

		-- Decompilation error in this vicinity:
		--- BLOCK #0 91-102, warpins: 1 ---
		slot9 = unit

		self.kill_effect(slot7, self)

		slot9 = self._environment_area_unit

		if unit.name(slot7) == Idstring(unit) then

			-- Decompilation error in this vicinity:
			--- BLOCK #0 103-111, warpins: 1 ---
			slot11 = unit
			slot9 = unit.unit_data(slot10).environment_area

			managers.environment_area.remove_area(slot7, managers.environment_area)
			--- END OF BLOCK #0 ---



		end
		--- END OF BLOCK #0 ---

		FLOW; TARGET BLOCK #1



		-- Decompilation error in this vicinity:
		--- BLOCK #1 112-113, warpins: 3 ---
		--- END OF BLOCK #1 ---



	end

	--- END OF BLOCK #1 ---

	FLOW; TARGET BLOCK #2



	-- Decompilation error in this vicinity:
	--- BLOCK #2 114-122, warpins: 1 ---
	slot3 = self

	EnvironmentLayer.super.clear(slot2)

	slot3 = self

	self.set_environment_area_parameters(slot2)

	return 
	--- END OF BLOCK #2 ---



end
EnvironmentLayer.add_triggers = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	slot3 = self

	EnvironmentLayer.super.add_triggers(slot2)

	return 
	--- END OF BLOCK #0 ---



end
EnvironmentLayer.clear_triggers = function (self)

	-- Decompilation error in this vicinity:
	--- BLOCK #0 1-6, warpins: 1 ---
	slot3 = self._editor_data.virtual_controller

	self._editor_data.virtual_controller.clear_triggers(slot2)

	return 
	--- END OF BLOCK #0 ---



end

return 
