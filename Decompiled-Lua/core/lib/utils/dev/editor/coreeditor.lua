-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
-- WARNING: Error occurred during decompilation.
--   Code may be incomplete or incorrect.
slot3 = "CoreWorldCameraLayer"

core.import(slot1, core)

slot3 = "CoreBrushLayer"

core.import(slot1, core)

slot3 = "CoreWireLayer"

core.import(slot1, core)

slot3 = "CorePortalLayer"

core.import(slot1, core)

slot3 = "CoreEnvironmentLayer"

core.import(slot1, core)

slot3 = "CoreSoundLayer"

core.import(slot1, core)

slot3 = "CoreStaticsLayer"

core.import(slot1, core)

slot3 = "CoreDynamicsLayer"

core.import(slot1, core)

slot3 = "CoreMissionLayer"

core.import(slot1, core)

slot3 = "CoreAiLayer"

core.import(slot1, core)

slot3 = "CoreLevelSettingsLayer"

core.import(slot1, core)

slot3 = "CoreInstancesLayer"

core.import(slot1, core)

slot3 = "CoreEngineAccess"

core.import(slot1, core)

slot3 = "CoreInput"

core.import(slot1, core)

slot3 = "CoreEditorUtils"

core.import(slot1, core)

slot3 = "CoreEditorSave"

core.import(slot1, core)

slot3 = "CoreUnit"

core.import(slot1, core)

slot2 = "core/lib/utils/dev/editor/ews_classes/CoreEditorEwsClasses"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/UnitByName"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/SelectByName"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/SelectUnitByNameModal"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/SelectGroupByName"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/SelectWorkView"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/MissionElementTimeline"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditUnitDialog"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditLight"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditTriggable"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditSettings"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditVariation"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditEditableGui"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditLadder"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/EditZipLine"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/Continents"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/UnhideByName"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/CreateWorldSettingFile"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/SelectNameModal"

require(slot1)

slot2 = "core/lib/utils/dev/editor/ews_classes/MissionElementListFlow"

require(slot1)

slot2 = "core/lib/utils/dev/SettingsHandling"

require(slot1)

slot2 = "core/lib/units/editor/CoreMissionElement"

require(slot1)

slot2 = "core/lib/units/data/CoreMissionElementData"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreArea"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreAreaTrigger"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreWorldCamera"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreWorldCameraTrigger"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreCounter"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreCounterReset"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreToggle"

require(slot1)

slot2 = "core/lib/units/editor/mission/CorePlayEffect"

require(slot1)

slot2 = "core/lib/units/editor/mission/CorePhysicsPush"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreSpawnUnit"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreActivateScript"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreUnitSequence"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreUnitSequenceTrigger"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreMusic"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreOperator"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreOverlayEffect"

require(slot1)

slot2 = "core/lib/units/editor/mission/CorePlaySound"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreExecuteInOtherMission"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreLogicChance"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreMotionPath"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreRope"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreRandom"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreGlobalEventTriggerUnitElement"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreTimer"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreLogicLink"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreShape"

require(slot1)

slot2 = "core/lib/units/editor/mission/CorePointOrientation"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreInstance"

require(slot1)

slot2 = "core/lib/units/editor/mission/CoreWorldSpawnerElement"

require(slot1)

slot2 = "core/lib/units/editor/CoreDebug"

require(slot1)

CoreEditor = CoreEditor or class()
slot2 = "core/lib/utils/dev/editor/CoreEditorMenubar"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorToolbar"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorConfiguration"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorMarkers"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorLeftToolbars"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorEditGui"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorLowerPanel"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorGroups"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorCubeMap"

require(slot1)

slot2 = "core/lib/utils/dev/editor/CoreEditorDomeOcclusion"

require(slot1)

slot2 = "core/lib/utils/dev/editor/utils/CoreFCCEditorController"

require(slot1)

function CoreEditor:init(game_state_machine, session_state)
	slot5 = game_state_machine

	assert(slot4)

	self._gsm = game_state_machine
	self._session_state = session_state
	slot6 = Idstring(slot7)
	slot11 = "clbk_pkg_manager_unit_loaded"

	PackageManager.set_resource_loaded_clbk(slot4, PackageManager, callback("unit", managers.sequence, managers.sequence))

	slot5 = World
	slot8 = "ref"
	slot6 = false

	World.get_object(slot4, Idstring(callback)).set_visibility(slot4, World.get_object(slot4, Idstring(callback)))

	self._WORKING_ON_CONTINENTS = true
	self._skipped_freeflight_frames = 1
	self._editor_name = "Bringer of Worlds"
	self._max_id = 1
	self._STEP_ID = 1
	self._unit_ids = {}
	self._gui_id = 0
	self._triggers_added = false
	self._enabled = false
	self._confirm_on_new = true
	self._continents = {}
	self._current_continent = nil
	slot6 = {}
	self._world_holder = WorldHolder.new(slot4, WorldHolder)
	slot5 = self

	self._load_packages(slot4)

	slot5 = self

	self._init_viewport(slot4)

	slot5 = self

	self._init_listener(slot4)

	slot5 = self

	self._init_mute(slot4)

	slot5 = self

	self._init_gui(slot4)

	slot5 = self

	self._init_editor_data(slot4)

	slot5 = self

	self._init_groups(slot4)
	CoreEditorUtils.parse_layer_types()

	slot5 = self

	self._init_layer_classes(slot4)

	slot5 = self

	self._init_controller(slot4)

	slot5 = self

	self._clear_values(slot4)

	slot5 = self

	self._init_configuration_values(slot4)

	slot5 = self

	self._init_head_lamp(slot4)

	self._special_units = {}
	self._ews_triggers = {}
	self._dialogs = {}
	self._dialogs_settings = {}
	self._news_version = 0
	self._show_markers = false
	self._show_camera_position = true
	self._show_center = true
	self._draw_occluders = false
	self._draw_bodies_on = false
	self._simulation_debug_areas = false
	self._simulation_world_setting_path = nil
	self._hidden_units = {}
	self._draw_hidden_units = false
	self._layer_replace_dialogs = {}
	self._markers = {}
	self._recent_files_limit = 10
	self._recent_files = {}
	slot5 = self

	self._init_slot_masks(slot4)

	slot5 = self

	self._init_layer_values(slot4)

	slot5 = self

	self._init_edit_setting_values(slot4)

	slot5 = self

	self._replace_unit_categories(slot4)

	slot5 = self

	self._init_paths(slot4)

	slot5 = self

	self._load_editor_settings(slot4)

	slot5 = self

	self._load_configuration(slot4)

	slot5 = self

	self._load_edit_setting_values(slot4)

	slot5 = self

	self._init_mission_difficulties(slot4)

	slot5 = self

	self._init_mission_players(slot4)

	slot5 = self

	self._init_mission_platforms(slot4)

	slot5 = self

	self._init_title_messages(slot4)

	return 
end
function CoreEditor:_load_packages()
	slot4 = "core/packages/editor"

	if not PackageManager.loaded(slot2, PackageManager) then
		slot4 = "core/packages/editor"

		PackageManager.load(slot2, PackageManager)
	end

	return 
end
function CoreEditor:_init_viewport()
	self._camera_fov = 75
	self._camera_near_range = 20
	self._camera_far_range = 250000
	local camera = World.create_camera(slot2)
	slot5 = self._camera_near_range

	camera.set_near_range(World, camera)

	slot5 = self._camera_far_range

	camera.set_far_range(World, camera)

	slot5 = self._camera_fov

	camera.set_fov(World, camera)

	slot4 = camera
	slot9 = 220

	camera.set_position(World, Vector3(slot6, 0, 0))

	slot8 = 1
	self._vp = managers.viewport.new_vp(World, managers.viewport, 0, 0, 1)
	slot5 = camera

	self._vp.set_camera(World, self._vp)

	slot4 = "empty"
	self._default_post_processor_effect = Idstring(World)

	return 
end
function CoreEditor:_init_listener()
	slot8 = self._vp
	slot8 = true
	self._listener_id = managers.listener.add_listener(slot2, managers.listener, "editor", self._vp.camera(slot6), self._vp.camera(self._vp), nil)
	self._activate_listener_id = nil
	slot5 = {
		"editor"
	}

	managers.listener.add_set(slot2, managers.listener, "editor")

	self._listener_always_enabled = false
	slot4 = {
		primary = true,
		active = true,
		object = self.camera(self._vp.camera(self._vp))
	}
	slot7 = self
	self._sound_check_object = managers.sound_environment.add_check_object(slot2, managers.sound_environment)

	return 
end
function CoreEditor:_init_mute()
	slot4 = "editor_mute"
	self._mute_source = SoundDevice.create_source(slot2, SoundDevice)
	self._mute_states = {
		current = false,
		wanted = true
	}

	return 
end
function CoreEditor:_init_gui()
	slot3 = Overlay
	slot3 = Overlay.newgui(slot2)
	self._workspace = Overlay.newgui(slot2).create_screen_workspace(slot2)
	slot3 = self._workspace
	slot6 = TimerManager

	self._workspace.set_timer(slot2, TimerManager.main(slot5))

	slot3 = self._workspace
	slot3 = self._workspace.panel(slot2)
	slot6 = "core/guis/core_editor"
	self._gui = self._workspace.panel(slot2).gui(slot2, Idstring(slot5))
	slot4 = "camera"
	slot4 = {
		text = "",
		name = "select_units_amount",
		font = "core/fonts/nice_editor_font",
		font_size = 20
	}

	self._gui.child(slot2, self._gui).text(slot2, self._gui.child(slot2, self._gui))

	slot3 = self

	self._align_gui(slot2)

	return 
end
function CoreEditor:_align_gui()
	slot6 = "camera"
	slot5 = self._gui.child(slot4, self._gui)

	for i, child in ipairs(self._gui.child(slot4, self._gui).children(slot4)) do
		local y_skip = (4 <= i and 10) or 0
		slot10 = y_skip + 20 * (i - 1)

		child.set_y(slot8, child)

		slot9 = child
		slot15 = 0

		child.set_color(slot8, Color(slot11, 1, 0.8, 0.2 + 0.2 * (i - 1)))
	end

	return 
end
function CoreEditor:_init_editor_data()
	self._editor_data = {
		keyboard_available = true
	}
	slot5 = "editor_layer"
	self._editor_data.virtual_controller = Input.create_virtual_controller(slot3, Input)

	return 
end
function CoreEditor:_init_groups()
	self._using_groups = false
	self._debug_draw_groups = false
	slot3 = CoreEditorGroups
	self._groups = CoreEditorGroups.new(slot2)

	return 
end
function CoreEditor:_init_layer_classes()
	self._layers = {}
	self._current_layer = nil
	self._mission_layer_name = "Mission"
	slot5 = CoreBrushLayer.BrushLayer

	self.add_layer(slot2, self, "Brush")

	slot5 = CoreSoundLayer.SoundLayer

	self.add_layer(slot2, self, "Sound")

	slot5 = CoreMissionLayer.MissionLayer

	self.add_layer(slot2, self, "Mission")

	slot5 = CoreEnvironmentLayer.EnvironmentLayer

	self.add_layer(slot2, self, "Environment")

	slot5 = CoreWorldCameraLayer.WorldCameraLayer

	self.add_layer(slot2, self, "WorldCamera")

	slot5 = CorePortalLayer.PortalLayer

	self.add_layer(slot2, self, "Portals")

	slot5 = CoreWireLayer.WireLayer

	self.add_layer(slot2, self, "Wires")

	slot5 = CoreStaticsLayer.StaticsLayer

	self.add_layer(slot2, self, "Statics")

	slot5 = CoreDynamicsLayer.DynamicsLayer

	self.add_layer(slot2, self, "Dynamics")

	slot5 = CoreLevelSettingsLayer.LevelSettingsLayer

	self.add_layer(slot2, self, "Level Settings")

	slot5 = CoreInstancesLayer.InstancesLayer

	self.add_layer(slot2, self, "Instances")

	self._layer_load_order = {
		"Ai",
		"Heatmap",
		"WorldCamera",
		"Dynamics",
		"Wires",
		"Level Settings",
		"Portals",
		"Brush",
		"Environment",
		"Instances",
		"Statics",
		"Sound",
		"Mission"
	}
	slot3 = self

	self._project_init_layer_classes(slot2)

	return 
end
function CoreEditor:_project_init_layer_classes()
	return 
end
function CoreEditor:_clear_values()
	self._values = {
		world = {}
	}
	self._values.world.workviews = {}

	return 
end
function CoreEditor:_init_configuration_values()
	self._autosave_time = 5
	self._autosave_timer = 0
	self._notes = "Hail to the King!"
	self._invert_move_shift = false
	self._always_global_select_unit = false
	self._use_timestamp = false
	self._reset_camera_on_new = false
	self._use_beta_undo = false
	self._dialogs_stay_on_top = false
	self._save_edit_setting_values = false
	self._save_dialog_states = false
	self._use_edit_light_dialog = false

	return 
end
function CoreEditor:_init_slot_masks()
	slot4 = "surface_move"
	self._surface_move_mask = managers.slot.get_mask(slot2, managers.slot)
	slot6 = 38
	self._portal_units_mask = World.make_slot_mask(slot2, World, 1, 11)
	slot10 = 38
	self._go_through_units_before_simulaton_mask = World.make_slot_mask(slot2, World, 1, 11, 17, 19, 32, 36)
	slot3 = self

	self._project_init_slot_masks(slot2)

	return 
end
function CoreEditor:_project_init_slot_masks()
	return 
end
function CoreEditor:_init_layer_values()
	self._coordinate_systems = {
		"Local",
		"World"
	}
	self._coordinate_system = "Local"
	self._grid_sizes = {
		1,
		25,
		50,
		100,
		400,
		800,
		1000,
		1600,
		2000,
		10000
	}
	self._grid_size = self._grid_sizes[4]
	self._snap_rotations = {
		1,
		2,
		5,
		10,
		15,
		30,
		45,
		60,
		90,
		180
	}
	self._snap_rotation = self._snap_rotations[7]
	self._snap_rotation_axis = "z"
	self._rotation_speed = 35
	self._use_surface_move = false
	self._use_snappoints = false
	self._layer_draw_grid = true
	self._layer_draw_marker = true
	self._grid_altitude = 0

	return 
end
function CoreEditor:_init_edit_setting_values()
	self._edit_setting_values = {}
	slot4 = "_coordinate_system"

	table.insert(slot2, self._edit_setting_values)

	slot4 = "_grid_size"

	table.insert(slot2, self._edit_setting_values)

	slot4 = "_snap_rotation"

	table.insert(slot2, self._edit_setting_values)

	slot4 = "_snap_rotation_axis"

	table.insert(slot2, self._edit_setting_values)

	slot4 = "_rotation_speed"

	table.insert(slot2, self._edit_setting_values)

	slot4 = "_use_surface_move"

	table.insert(slot2, self._edit_setting_values)

	slot4 = "_use_snappoints"

	table.insert(slot2, self._edit_setting_values)

	return 
end
function CoreEditor:_replace_unit_categories()
	self._replace_unit_categories = {
		"none",
		"mission_element"
	}
	slot3 = self

	self._populate_replace_unit_categories_from_layer_types(slot2)

	return 
end
function CoreEditor:_init_paths()
	self._lastdir = "levels\\"
	self._version_path = "lib/utils/dev/editor/xml/version"
	self._configuration_path = "lib/utils/dev/editor/xml/editor_configuration"
	self._edit_setting_values_path = "lib/utils/dev/editor/xml/editor_edit_setting_values"
	self._layout_path = "lib/utils/dev/editor/xml/editor_layout"
	self._editor_settings_path = "lib/utils/dev/editor/xml/editor"
	slot3 = managers.database
	self._group_presets_path = managers.database.base_path(slot2) .. "levels\\groups"
	slot3 = managers.database
	self._editor_temp_path = managers.database.root_path("levels\\groups") .. "assets\\core\\temp\\editor_temp"
	self._simulation_path = self._editor_temp_path .. "\\simulation"
	self._simulation_cube_lights_path = self._simulation_path .. "\\cube_lights"
	slot4 = self._editor_temp_path

	if not SystemFS.exists("\\cube_lights", SystemFS) then
		slot4 = self._editor_temp_path

		SystemFS.make_dir(slot2, SystemFS)
	end

	slot4 = self._simulation_path

	if not SystemFS.exists(slot2, SystemFS) then
		slot4 = self._simulation_path

		SystemFS.make_dir(slot2, SystemFS)
	end

	slot4 = self._simulation_cube_lights_path

	if not SystemFS.exists(slot2, SystemFS) then
		slot4 = self._simulation_cube_lights_path

		SystemFS.make_dir(slot2, SystemFS)
	end

	return 
end
function CoreEditor:_init_mission_difficulties()
	self._mission_difficulties = {
		{
			"easy",
			"Easy"
		},
		{
			"medium",
			"Medium"
		},
		{
			"hard",
			"Hard"
		}
	}
	self._mission_difficulty = "medium"

	return 
end
function CoreEditor:_init_mission_players()
	self._mission_players = {
		1
	}
	self._mission_player = 1

	return 
end
function CoreEditor:_init_mission_platforms()
	self._mission_platforms = {
		"WIN32",
		"PS3"
	}
	self._mission_platform = "WIN32"

	return 
end
function CoreEditor:_init_title_messages()
	self._title_messages = {}
	slot4 = "Ask yourself, is this good for the company? "

	self.add_title_message(slot2, self)

	slot4 = "Hatarakazaru mono, kuu bekarazu. "

	self.add_title_message(slot2, self)

	slot4 = "Those who do not work, should not eat. "

	self.add_title_message(slot2, self)

	slot4 = "Don't waste you time or time will waste you. "

	self.add_title_message(slot2, self)

	slot4 = "Fill your head with rock. "

	self.add_title_message(slot2, self)

	return 
end
function CoreEditor:_init_edit_unit_dialog()
	slot5 = "EditUnitDialog"

	self.show_dialog(slot2, self, "edit_unit")

	slot4 = self

	EditUnitLight.new(slot2, EditUnitLight)

	slot4 = self

	EditUnitTriggable.new(slot2, EditUnitTriggable)

	slot4 = self

	EditUnitVariation.new(slot2, EditUnitVariation)

	slot4 = self

	EditUnitEditableGui.new(slot2, EditUnitEditableGui)

	slot4 = self

	EditUnitSettings.new(slot2, EditUnitSettings)

	slot4 = self

	EditLadder.new(slot2, EditLadder)

	slot4 = self

	EditZipLine.new(slot2, EditZipLine)

	return 
end
function CoreEditor:_populate_replace_unit_categories_from_layer_types()
	for layer_name, types in pairs(CoreEditorUtils.get_layer_types()) do
		slot8 = types

		for _, name in ipairs(slot7) do
			slot14 = name

			table.insert(slot12, self._replace_unit_categories)
		end
	end

	return 
end
function CoreEditor:_init_head_lamp()
	slot4 = "omni|specular"
	self._light = World.create_light(slot2, World)
	slot4 = 20000

	self._light.set_far_range(slot2, self._light)

	slot3 = self._light

	self._light.set_color(slot2, Vector3(slot5, 1, 1))

	slot3 = self._light
	slot6 = LightIntensityDB
	slot9 = "identity"

	self._light.set_multiplier(slot2, LightIntensityDB.lookup(slot5, Idstring(1)))

	slot4 = 1e-08

	self._light.set_falloff_exponent(slot2, self._light)

	slot4 = 0.1

	self._light.set_linear_attenuation_factor(slot2, self._light)

	slot4 = false

	self._light.set_enable(slot2, self._light)

	return 
end
function CoreEditor:add_title_message(msg)
	slot5 = msg

	table.insert(slot3, self._title_messages)

	return 
end
function CoreEditor:add_layer(name, layer_class)
	if self._layers[name] then
		slot6 = "[CoreEditor] Layer referens named " .. name .. " already added. (Probably because Statics and Dynamics have been moved from project to Core. Remove project added layer from project WorldEditor)"

		Application.throw_exception(slot4, Application)
	end

	slot7 = self
	self._layers[name] = layer_class.new(slot5, layer_class)

	return 
end
function CoreEditor:check_news(file, devices)
	slot5 = WorldEditorNews
	self._world_editor_news = WorldEditorNews.new(slot4)
	slot7 = self._version_path

	if DB.has(slot4, DB, "editor_version") then
		slot7 = self._version_path
		local file = DB.open(slot4, DB, "editor_version")
		slot6 = ScriptSerializer
		slot9 = file
		local versions = ScriptSerializer.from_generic_xml(DB, file.read(slot8))
		self._news_version = versions.news
	end

	slot6 = self._world_editor_news

	if self._world_editor_news.version(slot5) <= self._news_version then
		slot6 = false

		self._world_editor_news.set_visible(slot4, self._world_editor_news)
	else
		slot5 = self._world_editor_news
		self._news_version = self._world_editor_news.version(slot4)
		slot8 = managers.database
		local f = SystemFS.open(slot4, SystemFS, managers.database.base_path("w") .. self._version_path .. ".editor_version")
		slot6 = f
		slot10 = {
			news = self._news_version
		}

		f.puts(SystemFS, ScriptSerializer.to_generic_xml(".editor_version", ScriptSerializer))

		slot7 = f

		SystemFS.close(SystemFS, SystemFS)
	end

	return 
end
function CoreEditor:ctrl_bindings()
	return self._ctrl_bindings
end
function CoreEditor:ctrl_layer_bindings()
	return self._ctrl_layer_bindings
end
function CoreEditor:ctrl_menu_bindings()
	return self._ctrl_menu_bindings
end
function CoreEditor:ctrl_binding(name)
	return self._ctrl_bindings[name] or ""
end
function CoreEditor:ctrl_layer_binding(name)
	return self._ctrl_layer_bindings[name] or ""
end
function CoreEditor:ctrl_menu_binding(name)
	return self._ctrl_menu_bindings[name] or ""
end
function CoreEditor:_parse_controller_file(file, devices)
	slot7 = file

	if DB.has(slot4, DB, "controller") then
		slot7 = file
		local controllers = DB.load_node(slot4, DB, "controller")
		slot6 = controllers

		for controller in controllers.children(DB) do
			slot10 = controller

			for button in controller.children(slot9) do
				slot14 = controller

				if controller.name(slot13) == "base" then
					slot15 = button
					slot18 = "device"
					slot18 = "shortkey"
					self._bindings[button.name(slot14)] = {
						device = devices[button.parameter(slot16, button)],
						key = button.parameter(slot16, button)
					}
				else
					slot14 = controller

					if controller.name(slot13) == "layer" then
						slot15 = button
						slot18 = "device"
						slot18 = "shortkey"
						self._layer_bindings[button.name(slot14)] = {
							device = devices[button.parameter(slot16, button)],
							key = button.parameter(slot16, button)
						}
					else
						slot14 = controller

						if controller.name(slot13) == "menu" then
							slot15 = button
							slot18 = "shortkey"
							self._menu_bindings[button.name(slot14)] = {
								key = button.parameter(slot16, button)
							}
						end
					end
				end
			end
		end
	end

	return 
end
function CoreEditor:_init_controller()
	local mouse = Input.mouse(slot2)
	slot4 = Input
	local kb = Input.keyboard(Input)
	local devices = {
		keyboard = kb,
		mouse = mouse
	}
	slot7 = "editor"
	self._ctrl = Input.create_virtual_controller(slot5, Input)
	local ctrl_layer = self._editor_data.virtual_controller
	self._bindings = {}
	self._layer_bindings = {}
	self._menu_bindings = {}
	slot9 = devices

	self._parse_controller_file(Input, self, "core/lib/utils/dev/editor/xml/default_controller")

	slot9 = devices

	self._parse_controller_file(Input, self, "lib/utils/dev/editor/xml/project_controller")

	slot9 = devices

	self._parse_controller_file(Input, self, "lib/utils/dev/editor/xml/custom_controller")

	self._ctrl_bindings = {}
	self._ctrl_layer_bindings = {}
	self._ctrl_menu_bindings = {}
	slot7 = self._bindings

	for name, data in pairs(Input) do
		slot14 = Idstring(slot15)
		slot17 = name

		self._ctrl.connect(slot11, self._ctrl, data.device, Idstring(data.key))

		self._ctrl_bindings[name] = data.key
	end

	slot7 = self._layer_bindings

	for name, data in pairs(slot6) do
		slot14 = Idstring(slot15)
		slot17 = name

		ctrl_layer.connect(slot11, ctrl_layer, data.device, Idstring(data.key))

		self._ctrl_layer_bindings[name] = data.key
	end

	slot7 = self._menu_bindings

	for name, data in pairs(slot6) do
		self._ctrl_menu_bindings[name] = data.key
	end

	self._bindings = nil
	self._layer_bindings = nil
	slot9 = Idstring(slot10)
	slot12 = "lmb"

	ctrl_layer.connect(slot6, ctrl_layer, mouse, Idstring("0"))

	slot9 = Idstring(Idstring)
	slot12 = "rmb"

	ctrl_layer.connect(slot6, ctrl_layer, mouse, Idstring("1"))

	slot9 = Idstring(Idstring)
	slot12 = "mmb"

	ctrl_layer.connect(slot6, ctrl_layer, mouse, Idstring("2"))

	slot9 = Idstring(Idstring)
	slot12 = "emb"

	ctrl_layer.connect(slot6, ctrl_layer, mouse, Idstring("3"))

	slot9 = Idstring(Idstring)
	slot12 = "enter"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("enter"))

	slot9 = Idstring(Idstring)
	slot12 = "back"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("backspace"))

	slot9 = Idstring(Idstring)
	slot12 = "insert"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("insert"))

	slot9 = Idstring(Idstring)
	slot12 = "insert"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("f14"))

	slot9 = Idstring(Idstring)
	slot12 = "increase"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("num +"))

	slot9 = Idstring(Idstring)
	slot12 = "decrease"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("num -"))

	slot9 = Idstring(Idstring)
	slot12 = "home"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("home"))

	slot9 = Idstring(Idstring)
	slot12 = "end"

	ctrl_layer.connect(slot6, ctrl_layer, kb, Idstring("end"))

	slot9 = Idstring(Idstring)
	slot12 = "tab"

	self._ctrl.connect(slot6, self._ctrl, kb, Idstring("tab"))

	slot9 = Idstring(Idstring)
	slot12 = "esc"

	self._ctrl.connect(slot6, self._ctrl, kb, Idstring("esc"))

	slot9 = Idstring(Idstring)
	slot12 = "toggle_mixed_input_mode"

	self._ctrl.connect(slot6, self._ctrl, kb, Idstring("space"))

	slot9 = Idstring(Idstring)
	slot12 = "undo"

	self._ctrl.connect(slot6, self._ctrl, kb, Idstring("z"))

	slot9 = Idstring(Idstring)
	slot12 = "lmb"

	self._ctrl.connect(slot6, self._ctrl, mouse, Idstring("0"))

	slot9 = Idstring(Idstring)
	slot12 = "look"

	self._ctrl.connect(slot6, self._ctrl, mouse, Idstring("mouse"))

	return 
end
function CoreEditor:viewport()
	return self._vp
end
function CoreEditor:_set_vp_active(active)
	slot5 = active

	self._vp.set_active(slot3, self._vp)

	return 
end
function CoreEditor:set_camera(pos, rot)
	slot6 = pos

	self._camera_controller.set_camera_pos(slot4, self._camera_controller)

	slot6 = rot

	self._camera_controller.set_camera_rot(slot4, self._camera_controller)

	return 
end
function CoreEditor:set_camera_roll(roll)
	if not self._camera_controller then
		return 
	end

	slot5 = roll

	self._camera_controller.set_camera_roll(slot3, self._camera_controller)

	return 
end
function CoreEditor:camera()
	slot3 = self._vp

	return self._vp.camera(slot2)
end
function CoreEditor:camera_position()
	slot3 = self._camera_controller

	return self._camera_controller.get_camera_pos(slot2)
end
function CoreEditor:camera_rotation()
	slot3 = self._camera_controller

	return self._camera_controller.get_camera_rot(slot2)
end
function CoreEditor:default_camera_fov()
	return self._camera_fov
end
function CoreEditor:set_default_camera_fov(fov)
	self._camera_fov = fov
	slot5 = self._camera_fov

	self.set_camera_fov(slot3, self)

	return 
end
function CoreEditor:camera_fov()
	slot3 = self
	slot3 = self.camera(slot2)

	return self.camera(slot2).fov(slot2)
end
function CoreEditor:set_camera_fov(fov)
	slot6 = self
	slot6 = self.camera(slot5)

	if math.round(self.camera(slot5).fov(slot5)) ~= fov then
		slot4 = self._vp

		self._vp.pop_ref_fov(slot3)

		slot5 = fov

		self._vp.push_ref_fov(slot3, self._vp)

		slot4 = self
		slot5 = fov

		self.camera(slot3).set_fov(slot3, self.camera(slot3))
	end

	return 
end
function CoreEditor:camera_far_range()
	slot3 = self
	slot3 = self.camera(slot2)

	return self.camera(slot2).far_range(slot2)
end
function CoreEditor:set_camera_near_range(range)
	self._camera_near_range = range
	slot4 = self
	slot5 = self._camera_near_range

	return self.camera(slot3).set_near_range(slot3, self.camera(slot3))
end
function CoreEditor:set_camera_far_range(range)
	self._camera_far_range = range
	slot4 = self
	slot5 = self._camera_far_range

	return self.camera(slot3).set_far_range(slot3, self.camera(slot3))
end
function CoreEditor:groups()
	return self._groups
end
function CoreEditor:create_group(...)
	local group = self._groups.create(slot2, ...)
	slot5 = group

	self.group_created(self._groups, self)

	return 
end
function CoreEditor:remove_group(name, ...)
	slot7 = self._groups
	slot5 = self._groups.groups(slot6)[name]

	self.group_removed(slot3, self)

	slot5 = name

	self._groups.remove(slot3, self._groups, ...)

	return 
end
function CoreEditor:toggle()
	if self._current then
		slot3 = self

		self.close(slot2)
	else
		slot3 = self

		self.open(slot2)
	end

	return 
end
function CoreEditor:open()
	if managers.editor and not self._current then
		slot3 = self

		self.close(slot2)

		self._current = true
		slot3 = Application
		self._screen_borders = Application.screen_resolution(slot2)
		slot3 = self

		self.pickup_tool(slot2)
	end

	slot4 = "none"

	managers.environment_controller.set_volumetric_light_scatter_setting(slot2, managers.environment_controller)

	slot3 = self
	slot3 = self.viewport(slot2)
	slot5 = Idstring(slot6)
	slot8 = "empty"

	self.viewport(slot2).vp(slot2).set_post_processor_effect(slot2, self.viewport(slot2).vp(slot2), "World", Idstring("post_motion_blur"))

	return 
end
function CoreEditor:close()
	if self._current then
		slot3 = self

		self.putdown_tool(slot2)

		self._current = nil
		slot4 = false

		Application.set_pause(slot2, Application)

		slot3 = self._workspace

		self._workspace.hide(slot2)

		slot3 = self._workspace

		self._workspace.disconnect_all_controllers(slot2)

		slot4 = false

		self._set_vp_active(slot2, self)
	end

	return 
end
function CoreEditor:pickup_tool()

	-- Decompilation error in this vicinity:
	slot4 = "CoreEditor:pickup_tool"

	cat_print(slot2, "editor")

	Global.render_debug.draw_enabled = true
	Global.category_print.editor = true

	if not self._ews_editor_frame then
		self._ews_editor_frame = EWS.Panel(slot2, EWS, Global.frame_panel, self._editor_name)
		slot4 = "VERTICAL"
		self._main_sizer = EWS.BoxSizer(slot2, EWS)
		slot4 = self._main_sizer

		self._ews_editor_frame.set_sizer(slot2, self._ews_editor_frame)

		slot4 = "EVT_LEAVE_WINDOW"
		slot9 = "leaving_window"

		Global.application_window.connect(slot2, Global.application_window, callback("TAB_TRAVERSAL", self, self))

		slot4 = "EVT_ENTER_WINDOW"
		slot9 = "entering_window"

		Global.application_window.connect(slot2, Global.application_window, callback("TAB_TRAVERSAL", self, self))

		slot3 = self

		self.build_configuration(slot2)

		slot3 = self

		self.build_left_toolbar(slot2)

		slot6 = self
		slot7 = "EXPAND"

		Global.v_sizer.add(slot2, Global.v_sizer, self.build_lower_panel(callback), 1, 0)

		slot6 = self
		slot7 = "EXPAND"

		self._main_sizer.add(slot2, self._main_sizer, self.build_editor_controls(1), 1, 0)

		slot3 = self

		self.add_notebook_pages(slot2)

		slot3 = self

		self.build_menubar(slot2)

		slot3 = Global.frame
		slot9 = ""

		Global.frame.set_status_bar(slot2, EWS.StatusBar(1, EWS, Global.frame, ""))

		slot3 = self

		self.build_toolbar(slot2)

		slot7 = "EXPAND"

		Global.main_sizer.add(slot2, Global.main_sizer, self._ews_editor_frame, 1, 0)

		slot4 = true

		Global.frame.set_visible(slot2, Global.frame)

		slot3 = Global.frame_panel

		Global.frame_panel.layout(slot2)

		slot3 = Global.frame_panel

		Global.frame_panel.refresh(slot2)

		slot4 = true

		Global.frame_panel.set_visible(slot2, Global.frame_panel)

		slot4 = self._show_markers

		self._marker_panel.set_visible(slot2, self._marker_panel)

		slot3 = self._ews_editor_frame

		self._ews_editor_frame.layout(slot2)

		self._confirm_on_new = false
		slot3 = self

		self.on_new(slot2)

		slot4 = "EVT_SIZE"
		slot9 = "appwin_size_event"

		Global.application_window.connect(slot2, Global.application_window, callback(0, self, self))

		self._resizing_appwin = true
		slot3 = MoveTransformTypeIn
		self._move_transform_type_in = MoveTransformTypeIn.new(slot2)
		slot3 = RotateTransformTypeIn
		self._rotate_transform_type_in = RotateTransformTypeIn.new(slot2)
		slot3 = CameraTransformTypeIn
		self._camera_transform_type_in = CameraTransformTypeIn.new(slot2)
		slot3 = self

		self.load_layout(slot2)

		slot3 = self

		self.check_news(slot2)

		slot3 = self

		self._init_edit_unit_dialog(slot2)
	end

	self._enabled = true
	slot4 = true

	self._set_vp_active(slot2, self)

	slot3 = self
	slot3 = self.viewport(slot2)
	slot7 = "dof_prepare_post_processor"

	self.viewport(slot2).vp(slot2).set_post_processor_effect(slot2, self.viewport(slot2).vp(slot2), "World", Idstring(self._default_post_processor_effect))

	slot4 = "empty"
	slot4 = self
	slot4 = self.viewport(slot3)
	slot8 = "bloom_combine_post_processor"

	self.viewport(slot3).vp(slot3).set_post_processor_effect(slot3, self.viewport(slot3).vp(slot3), "World", Idstring(slot7))

	slot4 = self
	slot4 = self.viewport(slot3)
	slot6 = Idstring(bloom_combine_effect)
	slot9 = "empty"

	self.viewport(slot3).vp(slot3).set_post_processor_effect(slot3, self.viewport(slot3).vp(slot3), "World", Idstring("lens_distortion"))

	slot4 = self
	slot4 = self.viewport(slot3)
	slot6 = Idstring(Idstring)
	slot9 = "empty"

	self.viewport(slot3).vp(slot3).set_post_processor_effect(slot3, self.viewport(slot3).vp(slot3), "World", Idstring("contour_post_processor"))

	slot4 = self
	slot4 = self.viewport(slot3)
	slot6 = Idstring(Idstring)
	slot9 = "empty"

	self.viewport(slot3).vp(slot3).set_post_processor_effect(slot3, self.viewport(slot3).vp(slot3), "World", Idstring("colorblind_correction_post"))

	slot4 = self
	slot4 = self.viewport(slot3)
	slot6 = Idstring(Idstring)
	slot9 = "empty"

	self.viewport(slot3).vp(slot3).set_post_processor_effect(slot3, self.viewport(slot3).vp(slot3), "World", Idstring("lens_flare_post_processor"))

	slot4 = self
	slot4 = self.viewport(slot3)
	slot6 = Idstring(Idstring)
	slot9 = "empty"

	self.viewport(slot3).vp(slot3).set_post_processor_effect(slot3, self.viewport(slot3).vp(slot3), "World", Idstring("lens_flare_apply_post_processor"))

	slot6 = false

	self._workspace.connect_controller(slot3, self._workspace, self._ctrl)

	slot4 = self

	self.add_triggers(slot3)

	slot5 = false

	Application.set_pause(slot3, Application)

	if not self._camera_controller then
		slot7 = self._vp
		self._camera_controller = FFCEditorController.new(slot3, FFCEditorController, self._vp.camera(self._ctrl))
	end

	slot4 = self._workspace

	self._workspace.show(slot3)

	slot5 = false

	self._light.set_enable(slot3, self._light)

	slot5 = true

	self.set_camera_locked(slot3, self)

	slot5 = true

	self.set_in_mixed_input_mode(slot3, self)

	slot5 = true

	self.set_wanted_mute(slot3, self)

	slot5 = true

	self.set_listener_active(slot3, self)

	slot6 = true

	managers.sound_environment.set_check_object_active(slot3, managers.sound_environment, self._sound_check_object)

	slot5 = false

	managers.sequence.set_collisions_enabled(slot3, managers.sequence)

	slot5 = false

	managers.sequence.set_proximity_enabled(slot3, managers.sequence)

	if Global.running_simulation then
		Global.running_simulation = false
		slot4 = self

		self.stop_simulation(false)
	end

	slot4 = self

	self.force_editor_state(slot3)

	return 
end
function CoreEditor:run_simulation_callback(...)
	if self._stopping_simulation then
		return 
	end

	slot3 = self

	self.run_simulation(slot2, ...)

	return 
end
function CoreEditor:run_simulation(with_mission)
	if not Global.running_simulation then
		if self._lastdir then
		end

		local file = self._simulation_path .. "/test_level.world"
		local save_continents = true
		slot9 = save_continents
		local save_success = self.do_save(slot5, self, file, self._simulation_path)

		if not save_success then
			slot8 = "[CoreEditor:run_simulation] Saving failed, run simulation aborted."

			Application.error(slot6, Application)

			return 
		end

		slot8 = {
			file_type = "world",
			file_path = managers.database.entry_path(slot10, managers.database),
			cube_lights_path = managers.database.entry_path(slot10, managers.database) .. "/"
		}
		slot12 = file
		slot12 = self._lastdir
		self._world_holder = WorldHolder.new(slot6, WorldHolder)
	end

	if not Global.running_simulation then
		slot4 = self

		self._interupt_frustum_freeze(slot3)

		self._saved_simulation_values = {}
		self._error_log = {}
		slot5 = false

		self._notebook.set_enabled(slot3, self._notebook)

		Global.render_debug.draw_enabled = false
		Global.running_simulation = true
		Global.running_simulation_with_mission = with_mission
		slot5 = false

		self.set_in_mixed_input_mode(true, self)

		slot4 = self

		self.toggle(true)

		slot4 = managers.editor

		managers.editor.unit_output(true)

		slot4 = managers.editor

		managers.editor.has_editables(true)

		slot4 = self

		self._hide_dialogs(true)

		slot5 = with_mission

		self.project_prestart_up(true, self)
		self._layers.Instances.on_simulation_started(true)

		local mission = self._layers[self._mission_layer_name]
		slot6 = false

		mission.set_enabled(self._layers.Instances, mission)

		slot6 = mission
		self._saved_simulation_values.script = mission.current_script(mission)

		if with_mission then
			slot7 = nil
			slot12 = 255

			managers.editor.output(slot4, managers.editor, "Start simulation with mission script.", Vector3(slot9, 0, 0))

			slot5 = mission

			if mission.simulate_with_current_script(slot4) then
				slot5 = mission
				local script = mission.current_script(slot4)
			end

			local mission_params = {}
			slot8 = self._simulation_path .. "\\mission"
			mission_params.file_path = managers.database.entry_path(slot6, managers.database)
			mission_params.activate_mission = script
			slot8 = mission_params

			managers.mission.parse(slot6, managers.mission)
		else
			slot7 = nil
			slot12 = 255

			managers.editor.output(slot4, managers.editor, "Start simulation without mission script.", Vector3(slot9, 0, 0))
		end

		slot6 = {
			simulation = true
		}

		self._current_layer.deactivate(slot4, self._current_layer)

		slot6 = self._portal_units_mask

		self.set_up_portals(slot4, self)

		slot5 = managers.helper_unit

		managers.helper_unit.clear(slot4)

		slot6 = self._go_through_units_before_simulaton_mask

		self.go_through_all_units(slot4, self)

		slot6 = true

		managers.sequence.set_collisions_enabled(slot4, managers.sequence)

		slot6 = true

		managers.sequence.set_proximity_enabled(slot4, managers.sequence)

		slot5 = self

		self._simulation_disable_continents(slot4)

		slot6 = with_mission

		self.project_run_simulation(slot4, self)

		if self._session_state then
			slot5 = self._session_state
			slot5 = self._session_state.player_slots(slot4)
			slot5 = self._session_state.player_slots(slot4).primary_slot(slot4)

			self._session_state.player_slots(slot4).primary_slot(slot4).request_debug_local_user_binding(slot4)

			slot5 = self._session_state
			slot6 = with_mission

			self._session_state.session_info(slot4).set_run_mission_script(slot4, self._session_state.session_info(slot4))

			slot5 = self._session_state
			slot6 = false

			self._session_state.session_info(slot4).set_should_load_level(slot4, self._session_state.session_info(slot4))

			slot5 = self._session_state

			self._session_state.join_standard_session(slot4)
		end

		slot7 = nil
		slot12 = 255

		managers.editor.output(slot4, managers.editor, "Simulation started successfully.", Vector3(slot9, 0, 0))
	else
		slot4 = self

		self.toggle(slot3)

		slot6 = nil
		slot11 = 255

		managers.editor.output(slot3, managers.editor, "Simulation ended successfully.", Vector3(slot8, 0, 0))
	end

	return 
end
function CoreEditor:_simulation_disable_continents()
	local t = {}

	if self._simulation_world_setting_path then
		slot5 = self._simulation_world_setting_path
		t = self.parse_simulation_world_setting_path(slot3, self)
	end

	slot4 = self._continents

	for name, continent in pairs(slot3) do
		slot10 = t[name]

		continent.set_simulation_state(slot8, continent)
	end

	return 
end
function CoreEditor:project_prestart_up(with_mission)
	return 
end
function CoreEditor:project_run_simulation(with_mission)
	return 
end
function CoreEditor:set_up_portals(mask)
	local portals = self._layers.Portals
	slot7 = portals

	for name, portal in pairs(portals.get_portal_shapes(slot6)) do
		local t = {}
		slot11 = portal.portal

		for _, unit in ipairs(slot10) do
			slot16 = t
			slot19 = unit

			table.insert(slot15, unit.position(slot18))
		end

		local top = portal.top
		local bottom = portal.bottom

		if top == 0 and bottom == 0 then
			top, bottom = nil
		end

		slot16 = top

		managers.portal.add_portal(slot12, managers.portal, t, bottom)
	end

	slot7 = mask
	local units = World.find_units_quick(slot4, World, "all")
	slot6 = units

	for _, unit in ipairs(World) do
		slot12 = "light_streaks"

		if unit.name(slot10) ~= Idstring(unit) then
			slot11 = unit

			if unit.unit_data(slot10) then
				slot11 = unit

				if not unit.unit_data(slot10).only_visible_in_editor then
					slot11 = unit

					if not unit.unit_data(slot10).only_exists_in_editor then
						slot12 = unit

						managers.portal.add_unit(slot10, managers.portal)
					end
				end
			end
		end
	end

	return 
end
function CoreEditor:go_through_all_units(mask)
	slot6 = mask
	local units = World.find_units_quick(slot3, World, "all")
	slot5 = units

	for _, unit in ipairs(World) do
		slot10 = unit

		if unit.unit_data(slot9) then
			slot10 = unit

			if unit.unit_data(slot9).only_visible_in_editor then
				slot11 = false

				unit.set_visible(slot9, unit)
			end

			slot10 = unit

			if unit.unit_data(slot9).only_exists_in_editor then
				slot11 = false

				unit.set_enabled(slot9, unit)
			end

			slot10 = unit

			if unit.unit_data(slot9).helper_type then
				slot10 = unit

				if unit.unit_data(slot9).helper_type ~= "none" then
					slot14 = unit
					slot12 = unit.unit_data(slot13).helper_type

					managers.helper_unit.add_unit(slot9, managers.helper_unit, unit)
				end
			end

			slot11 = unit

			self._project_check_unit(slot9, self)
		end
	end

	return units
end
function CoreEditor:_project_check_unit(...)
	return 
end
function CoreEditor:_hide_dialogs()
	if self._dialogs.edit_unit then
		slot4 = false

		self._dialogs.edit_unit.set_visible(slot2, self._dialogs.edit_unit)
	end

	return 
end
function CoreEditor:force_editor_state()
	slot3 = self._gsm
	slot3 = self._gsm.current_state(slot2)

	self._gsm.current_state(slot2).force_editor_state(slot2)

	return 
end
function CoreEditor:stop_simulation()
	self._stopping_simulation = true
	slot4 = true

	self._notebook.set_enabled(slot2, self._notebook)

	slot5 = nil
	slot10 = 255

	managers.editor.output(slot2, managers.editor, "End simulation.", Vector3(slot7, 0, 0))

	slot3 = managers.mission

	managers.mission.stop_simulation(slot2)

	slot3 = managers.worldcamera

	managers.worldcamera.stop_simulation(slot2)

	slot3 = managers.environment_effects

	managers.environment_effects.kill_all_mission_effects(slot2)

	slot3 = managers.music

	managers.music.stop(slot2)

	slot3 = managers.worldcollection

	managers.worldcollection.on_simulation_ended(slot2)

	slot3 = managers.world_instance

	managers.world_instance.on_simulation_ended(slot2)

	if self._session_state then
		slot3 = self._session_state

		self._session_state.quit_session(slot2)
	end

	slot3 = self

	self.project_clear_units(slot2)

	slot3 = self

	self.project_stop_simulation(slot2)

	slot3 = self

	self.clear_layers_and_units(slot2)

	slot3 = self
	slot7 = self._current_layer

	self.change_layer_name(slot2, self.layer_name(slot5, self))

	if self._unit_list then
		slot3 = self._unit_list

		self._unit_list.reset(slot2)
	end

	if self._dialogs.select_by_name then
		slot3 = self._dialogs.select_by_name

		self._dialogs.select_by_name.reset(slot2)
	end

	slot3 = self

	self.on_enable_all_layers(slot2)

	slot3 = self

	self._show_error_log(slot2)

	return 
end
function CoreEditor:clear_layers_and_units()
	slot3 = self

	self.clear_layers(slot2)

	slot3 = self

	self.project_clear_layers(slot2)

	slot3 = self

	self.clear_units(slot2)

	slot3 = self

	self.project_clear_units(slot2)

	slot3 = self

	self.recreate_layers(slot2)

	slot3 = self

	self.project_recreate_layers(slot2)

	self._clear_and_reset_layer_timer = 10

	return 
end
function CoreEditor:clear_units()
	return 
end
function CoreEditor:project_stop_simulation()
	return 
end
function CoreEditor:project_clear_layers()
	return 
end
function CoreEditor:project_clear_units()
	return 
end
function CoreEditor:project_recreate_layers()
	return 
end
function CoreEditor:_show_error_log()
	if self._error_log and 0 < #self._error_log then
		local errors = "You have " .. #self._error_log .. " new errors:\n\n"
		slot4 = self._error_log

		for _, msg in ipairs(" new errors:\n\n") do
			errors = errors .. "#  " .. msg .. "\n\n"
		end

		slot12 = 0
		slot13 = 0
		slot10 = "DEFAULT_DIALOG_STYLE,RESIZE_BORDER,STAY_ON_TOP,MAXIMIZE_BOX"
		local dialog = EWS.Dialog(slot3, EWS, nil, "You got errors!", "", Vector3(slot9, 400, 200), Vector3(400, 400, 400))
		slot6 = "VERTICAL"
		local dialog_sizer = EWS.BoxSizer(EWS, EWS)
		slot7 = dialog_sizer

		dialog.set_sizer(EWS, dialog)

		slot13 = "TE_MULTILINE,TE_NOHIDESEL,TE_RICH2,TE_DONTWRAP,TE_READONLY"
		slot10 = "EXPAND"

		dialog_sizer.add(EWS, dialog_sizer, EWS.TextCtrl(Vector3(slot9, 400, 200), EWS, dialog, errors, ""), 1, 0)

		slot7 = true

		dialog.set_visible(EWS, dialog)
	end

	return 
end
function CoreEditor:show_text_box(title, text)
	slot13 = 0
	slot14 = 0
	slot11 = "DEFAULT_DIALOG_STYLE,RESIZE_BORDER,STAY_ON_TOP,MAXIMIZE_BOX"
	local dialog = EWS.Dialog(slot4, EWS, nil, title, "", Vector3(slot10, 400, 200), Vector3(400, 400, 400))
	slot7 = "VERTICAL"
	local dialog_sizer = EWS.BoxSizer(EWS, EWS)
	slot8 = dialog_sizer

	dialog.set_sizer(EWS, dialog)

	slot14 = "TE_MULTILINE,TE_NOHIDESEL,TE_RICH2,TE_DONTWRAP,TE_READONLY"
	slot11 = "EXPAND"

	dialog_sizer.add(EWS, dialog_sizer, EWS.TextCtrl(Vector3(slot10, 400, 200), EWS, dialog, text, ""), 1, 0)

	slot8 = true

	dialog.set_visible(EWS, dialog)

	return 
end
function CoreEditor:connect_slave()
	if not self._slave_host_name or self._slave_host_name == "" then
		slot3 = self

		self.on_configuration(slot2)
	else
		slot4 = "Connecting to slave: " .. self._slave_host_name

		self.output(slot2, self)

		slot3 = managers.slave
		slot1 = managers.slave.act_master
		slot4 = self._slave_host_name
		slot5 = 0 < self._slave_port and self._slave_port
		slot6 = 0 < self._slave_lsport and self._slave_lsport

		if not slot1(slot2, slot3, slot4, slot5) then
			slot7 = "ICON_ERROR,OK"
			slot11 = -2

			EWS.message_box(slot2, EWS, Global.frame, "Could not connect to: " .. self._slave_host_name, "Slave System", Vector3(slot9, -1))
		else
			slot4 = self._slave_num_batches

			managers.slave.set_batch_count(slot2, managers.slave)

			slot4 = "Connected!"

			self.output(slot2, self)
		end
	end

	return 
end
function CoreEditor:clear_layers()
	slot3 = self._layers[self._mission_layer_name]

	self._layers[self._mission_layer_name].clear(self._mission_layer_name)

	slot3 = self._layers.Dynamics

	self._layers.Dynamics.clear(self._mission_layer_name)

	slot3 = self._layers.Statics

	self._layers.Statics.clear(self._mission_layer_name)

	slot3 = self._layers.Portals

	self._layers.Portals.clear(self._mission_layer_name)

	slot3 = self._layers.Ai

	self._layers.Ai.clear(self._mission_layer_name)

	slot3 = self._layers.Instances

	self._layers.Instances.clear(self._mission_layer_name)

	return 
end
function CoreEditor:recreate_layers()
	slot4 = self._world_holder
	slot9 = 0

	self._layers.Ai.load(slot2, self._layers.Ai, Vector3(slot6, 0, 0))

	slot4 = self._world_holder
	slot9 = 0

	self._layers.Portals.load(slot2, self._layers.Portals, Vector3(slot6, 0, 0))

	slot4 = self._world_holder
	slot9 = 0

	self._layers.Statics.load(slot2, self._layers.Statics, Vector3(slot6, 0, 0))

	slot4 = self._world_holder
	slot9 = 0

	self._layers.Instances.load(slot2, self._layers.Instances, Vector3(slot6, 0, 0))

	return 
end
function CoreEditor:reset_layers()
	slot4 = self._world_holder
	slot9 = 0

	self._layers.Dynamics.load(slot2, self._layers.Dynamics, Vector3(slot6, 0, 0))

	slot4 = self._world_holder
	slot9 = 0

	self._layers[self._mission_layer_name].load(self._mission_layer_name, self._layers[self._mission_layer_name], Vector3(slot6, 0, 0))

	slot4 = self._world_holder
	slot9 = 0

	self._groups.load(self._mission_layer_name, self._groups, Vector3(slot6, 0, 0))

	slot4 = self._saved_simulation_values.script

	self._layers[self._mission_layer_name].set_script(self._mission_layer_name, self._layers[self._mission_layer_name])

	self._stopping_simulation = false

	return 
end
function CoreEditor:set_show_camera_info(value)
	slot5 = "camera"
	slot5 = value

	self._gui.child(slot3, self._gui).set_visible(slot3, self._gui.child(slot3, self._gui))

	return 
end
function CoreEditor:build_editor_controls()
	slot4 = "VERTICAL"
	local editor_sizer = EWS.BoxSizer(slot2, EWS)
	slot7 = self
	slot8 = "EXPAND"

	editor_sizer.add(EWS, editor_sizer, self.build_marker_panel(slot6), 0, 0)

	slot7 = ""
	local sp = EWS.SplitterWindow(EWS, EWS, self._ews_editor_frame, "")
	slot6 = sp
	self._continents_panel = ContinentPanel.new(EWS, ContinentPanel)
	slot8 = "NB_TOP,NB_MULTILINE"
	self._notebook = EWS.Notebook(EWS, EWS, sp, "_notebook")
	slot12 = "change_layer"

	self._ews_editor_frame.connect(EWS, self._ews_editor_frame, "_notebook", "EVT_COMMAND_NOTEBOOK_PAGE_CHANGED", callback(self._notebook, self, self))

	slot8 = self._continents_panel
	slot8 = 174

	sp.split_horizontally(EWS, sp, self._continents_panel.panel("EVT_COMMAND_NOTEBOOK_PAGE_CHANGED"), self._notebook)

	slot6 = 75

	sp.set_minimum_pane_size(EWS, sp)

	slot9 = "EXPAND"

	editor_sizer.add(EWS, editor_sizer, sp, 1, 0)

	return editor_sizer
end
function CoreEditor:close_editing()
	slot3 = self._edit_buttons

	for _, btn in pairs(slot2) do
		slot10 = false

		self._left_toolbar.set_tool_enabled(slot7, self._left_toolbar, btn)
	end

	slot4 = true

	self._info_frame.set_visible(slot2, self._info_frame)

	slot4 = false

	self._edit_panel.set_visible(slot2, self._edit_panel)

	slot3 = self._edit_panel

	self._edit_panel.layout(slot2)

	slot3 = self._lower_panel

	self._lower_panel.layout(slot2)

	return 
end
function CoreEditor:output_error(text, no_time_stamp)
	slot12 = 0

	self.output(slot4, self, text, no_time_stamp, Vector3("FONTWEIGHT_BOLD", 255, 0))

	slot9 = "OK,ICON_HAND,STAY_ON_TOP"
	slot5 = EWS.MessageDialog(slot4, EWS, Global.frame_panel, text, "You are err0r...")

	EWS.MessageDialog(slot4, EWS, Global.frame_panel, text, "You are err0r...").show_modal(slot4)

	if Global.running_simulation then
		slot6 = text

		table.insert(slot4, self._error_log)
	end

	return 
end
function CoreEditor:output_warning(text, no_time_stamp)
	slot12 = 0

	self.output(slot4, self, text, no_time_stamp, Vector3("FONTWEIGHT_BOLD", 200, 200))

	return 
end
function CoreEditor:output_info(text, no_time_stamp)
	slot12 = 0

	self.output(slot4, self, text, no_time_stamp, Vector3("FONTWEIGHT_BOLD", 0, 200))

	return 
end
function CoreEditor:output(text, no_time_stamp, colour, weight)
	if colour then
		slot8 = colour

		self._outputctrl.set_default_style_colour(slot6, self._outputctrl)
	end

	if weight then
		slot8 = weight

		self._outputctrl.set_default_style_font_weight(slot6, self._outputctrl)
	end

	local timestamp = ""

	if self._use_timestamp and not no_time_stamp then
		slot9 = "%X"
		timestamp = Application.date(slot7, Application) .. ": "
	end

	local new_text = timestamp .. text .. "\n"
	slot10 = new_text

	self._outputctrl.append("\n", self._outputctrl)

	slot9 = self._outputctrl
	slot12 = self._outputctrl

	self._outputctrl.show_position("\n", self._outputctrl.get_last_position(slot11))

	slot9 = self._info_frame

	self._info_frame.refresh("\n")

	slot9 = self._info_frame

	self._info_frame.update("\n")

	slot9 = self._outputctrl
	slot14 = 0

	self._outputctrl.set_default_style_colour("\n", Vector3(slot11, 0, 0))

	slot10 = "FONTWEIGHT_NORMAL"

	self._outputctrl.set_default_style_font_weight("\n", self._outputctrl)

	return 
end
function CoreEditor:toggle_mixed_input_mode()
	slot4 = not self._in_mixed_input_mode

	self.set_in_mixed_input_mode(slot2, self)

	return 
end
function CoreEditor:in_mixed_input_mode()
	return self._in_mixed_input_mode
end
function CoreEditor:set_in_mixed_input_mode(mixed_input)
	self._in_mixed_input_mode = mixed_input

	if not self._in_mixed_input_mode then
		slot4 = Input
		slot4 = Input.mouse(slot3)

		Input.mouse(slot3).acquire(slot3)

		slot4 = Input
		slot5 = false

		Input.mouse(slot3).set_deviceless(slot3, Input.mouse(slot3))

		slot4 = self._workspace

		self._workspace.set_relative_mouse(slot3)

		if self._camera_locked then
			slot5 = false

			self.set_camera_locked(slot3, self)
		end

		self._skipped_freeflight_frames = 0
	else
		slot4 = Input
		slot4 = Input.mouse(slot3)

		Input.mouse(slot3).unacquire(slot3)

		slot4 = Input
		slot5 = true

		Input.mouse(slot3).set_deviceless(slot3, Input.mouse(slot3))

		slot4 = self._workspace

		self._workspace.set_absolute_mouse(slot3)

		slot4 = Global.application_window

		Global.application_window.set_focus(slot3)

		if not self._camera_locked then
			slot5 = true

			self.set_camera_locked(slot3, self)
		end
	end

	return 
end
function CoreEditor:set_camera_locked(locked)
	self._camera_locked = locked
	slot4 = self._workspace

	self._workspace.disconnect_mouse(slot3)

	if self._camera_locked then
		slot4 = self._workspace
		slot7 = Input

		self._workspace.connect_mouse(slot3, Input.mouse(slot6))
	end

	return 
end
function CoreEditor:hidden_units()
	return self._hidden_units
end
function CoreEditor:on_hide_selected()
	if self._current_layer then
		if self._current_layer.on_hide_selected then
			slot3 = self._current_layer

			self._current_layer.on_hide_selected(slot2)
		else
			slot7 = self._current_layer

			for _, unit in ipairs(clone(self._current_layer.selected_units(slot6))) do
				slot10 = false

				self.set_unit_visible(slot7, self, unit)
			end
		end

		slot3 = self._current_layer

		self._current_layer.update_unit_settings(slot2)
	end

	return 
end
function CoreEditor:on_hide_unselected()
	slot3 = self._layers

	for _, layer in pairs(slot2) do
		slot10 = layer

		for _, unit in ipairs(layer.created_units(slot9)) do
			slot15 = layer

			if not table.contains(slot12, layer.selected_units(unit)) then
				slot15 = false

				self.set_unit_visible(slot12, self, unit)
			end
		end
	end

	return 
end
function CoreEditor:on_unhide_all()
	local to_hide = clone(slot2)
	slot4 = to_hide

	for _, unit in ipairs(self._hidden_units) do
		slot11 = true

		self.set_unit_visible(slot8, self, unit)
	end

	return 
end
function CoreEditor:on_hide_current_layer()
	if self._current_layer then
		slot3 = self._current_layer

		self._current_layer.hide_all(slot2)
	end

	return 
end
function CoreEditor:on_hide_all_layers()
	slot3 = self._layers

	for _, layer in pairs(slot2) do
		if layer ~= self._current_layer then
			slot8 = layer

			layer.hide_all(slot7)
		end
	end

	return 
end
function CoreEditor:set_unit_visible(unit, visible)
	slot5 = unit

	if unit.mission_element(slot4) then
		slot5 = unit
		slot6 = visible

		unit.mission_element(slot4).on_set_visible(slot4, unit.mission_element(slot4))
	end

	slot6 = visible

	unit.set_visible(slot4, unit)

	slot5 = unit

	if not unit.visible(slot4) then
		slot6 = unit

		if not table.contains(slot4, self._hidden_units) then
			slot6 = unit

			self.unselect_unit(slot4, self)

			slot6 = unit

			self.insert_hidden_unit(slot4, self)
		end
	else
		slot6 = unit

		self.delete_hidden_unit(slot4, self)

		if self._dialogs.hide_by_name then
			slot6 = unit

			self._dialogs.hide_by_name.unhid_unit(slot4, self._dialogs.hide_by_name)
		end
	end

	return 
end
function CoreEditor:unselect_unit(unit)
	slot5 = unit
	local layer = self.unit_in_layer(slot3, self)

	if layer then
		slot6 = unit

		layer.remove_select_unit(slot4, layer)

		slot5 = layer

		layer.check_referens_exists(slot4)
	end

	return 
end
function CoreEditor:insert_hidden_unit(unit)
	slot5 = unit

	table.insert(slot3, self._hidden_units)

	if self._dialogs.unhide_by_name then
		slot5 = unit

		self._dialogs.unhide_by_name.hid_unit(slot3, self._dialogs.unhide_by_name)
	end

	if self._dialogs.hide_by_name then
		slot5 = unit

		self._dialogs.hide_by_name.hid_unit(slot3, self._dialogs.hide_by_name)
	end

	return 
end
function CoreEditor:delete_hidden_unit(unit)
	slot5 = unit

	table.delete(slot3, self._hidden_units)

	if self._dialogs.unhide_by_name then
		slot5 = unit

		self._dialogs.unhide_by_name.unhid_unit(slot3, self._dialogs.unhide_by_name)
	end

	return 
end
function CoreEditor:deleted_unit(unit)
	slot5 = unit

	self.delete_hidden_unit(slot3, self)

	if self._unit_list then
		slot5 = unit

		self._unit_list.deleted_unit(slot3, self._unit_list)
	end

	if self._dialogs.select_by_name then
		slot5 = unit

		self._dialogs.select_by_name.deleted_unit(slot3, self._dialogs.select_by_name)
	end

	if self._dialogs.global_select_unit then
		slot5 = unit

		self._dialogs.global_select_unit.deleted_unit(slot3, self._dialogs.global_select_unit)
	end

	if self._dialogs.hide_by_name then
		slot5 = unit

		self._dialogs.hide_by_name.deleted_unit(slot3, self._dialogs.hide_by_name)
	end

	slot4 = self._layer_replace_dialogs

	for name, dialog in pairs(slot3) do
		slot9 = dialog

		if dialog.visible(slot8) then
			slot10 = unit

			dialog.deleted_unit(slot8, dialog)
		end
	end

	slot4 = unit

	if unit.unit_data(slot3).editor_groups then
		slot6 = unit
		local groups = clone(slot3)
		slot5 = groups

		for _, group in ipairs(unit.unit_data(slot5).editor_groups) do
			slot11 = unit

			group.remove_unit(slot9, group)
		end
	end

	return 
end
function CoreEditor:spawned_unit(unit)
	if self._unit_list then
		slot5 = unit

		self._unit_list.spawned_unit(slot3, self._unit_list)
	end

	if self._dialogs.select_by_name then
		slot5 = unit

		self._dialogs.select_by_name.spawned_unit(slot3, self._dialogs.select_by_name)
	end

	if self._dialogs.global_select_unit then
		slot5 = unit

		self._dialogs.global_select_unit.spawned_unit(slot3, self._dialogs.global_select_unit)
	end

	if self._dialogs.hide_by_name then
		slot5 = unit

		self._dialogs.hide_by_name.spawned_unit(slot3, self._dialogs.hide_by_name)
	end

	slot4 = self._layer_replace_dialogs

	for name, dialog in pairs(slot3) do
		slot9 = dialog

		if dialog.visible(slot8) then
			slot10 = unit

			dialog.spawned_unit(slot8, dialog)
		end
	end

	slot5 = unit

	self.on_selected_unit(slot3, self)

	return 
end
function CoreEditor:unit_name_changed(unit)
	if self._unit_list then
		slot5 = unit

		self._unit_list.unit_name_changed(slot3, self._unit_list)
	end

	if self._dialogs.select_by_name then
		slot5 = unit

		self._dialogs.select_by_name.unit_name_changed(slot3, self._dialogs.select_by_name)
	end

	if self._dialogs.unhide_by_name then
		slot5 = unit

		self._dialogs.unhide_by_name.unit_name_changed(slot3, self._dialogs.unhide_by_name)
	end

	if self._dialogs.hide_by_name then
		slot5 = unit

		self._dialogs.hide_by_name.unit_name_changed(slot3, self._dialogs.hide_by_name)
	end

	return 
end
function CoreEditor:on_selected_unit(unit)
	if self._unit_list then
		slot5 = unit

		self._unit_list.selected_unit(slot3, self._unit_list)
	end

	slot2 = ipairs
	slot4 = self._selected_unit_callbacks or {}

	for _, callback_func in slot2(slot3) do
		slot9 = unit

		callback_func(slot8)
	end

	return 
end
function CoreEditor:on_reference_unit(unit)
	if self._move_transform_type_in then
		slot5 = unit

		self._move_transform_type_in.set_unit(slot3, self._move_transform_type_in)
	end

	if self._rotate_transform_type_in then
		slot5 = unit

		self._rotate_transform_type_in.set_unit(slot3, self._rotate_transform_type_in)
	end

	return 
end
function CoreEditor:group_created(group)
	if self._dialogs.select_group_by_name then
		slot5 = group

		self._dialogs.select_group_by_name.group_created(slot3, self._dialogs.select_group_by_name)
	end

	return 
end
function CoreEditor:group_removed(group)
	if self._dialogs.select_group_by_name then
		slot5 = group

		self._dialogs.select_group_by_name.group_removed(slot3, self._dialogs.select_group_by_name)
	end

	return 
end
function CoreEditor:group_selected(group)
	if self._dialogs.select_group_by_name then
		slot5 = group

		self._dialogs.select_group_by_name.group_selected(slot3, self._dialogs.select_group_by_name)
	end

	return 
end
function CoreEditor:set_selected_units_position(pos)
	if self._current_layer then
		slot5 = pos

		self._current_layer.set_unit_positions(slot3, self._current_layer)
	end

	return 
end
function CoreEditor:set_selected_units_rotation(rot)
	if self._current_layer then
		slot5 = rot

		self._current_layer.set_unit_rotations(slot3, self._current_layer)
	end

	return 
end
function CoreEditor:selected_units(units)
	if self._dialogs.select_by_name then
		slot5 = units

		self._dialogs.select_by_name.selected_units(slot3, self._dialogs.select_by_name)
	end

	return 
end
function CoreEditor:show_layer_replace_dialog(layer)
	slot5 = layer
	local layer_name = self.layer_name(slot3, self)

	if self._layer_replace_dialogs[layer_name] then
		slot6 = true

		self._layer_replace_dialogs[layer_name].set_visible(slot4, self._layer_replace_dialogs[layer_name])
	else
		slot7 = layer
		self._layer_replace_dialogs[layer_name] = LayerReplaceUnit.new(slot5, LayerReplaceUnit)
	end

	return 
end
function CoreEditor:layer_name(layer)
	slot4 = self._layers

	for name, l in pairs(slot3) do
		if l == layer then
			return name
		end
	end

	return 
end
function CoreEditor:current_layer_name()
	slot4 = self._current_layer

	return self.layer_name(slot2, self)
end
function CoreEditor:current_layer()
	return self._current_layer
end
function CoreEditor:freeze_gui_lists()
	if self._unit_list then
		slot3 = self._unit_list

		self._unit_list.freeze(slot2)
	end

	if self._dialogs.select_by_name then
		slot3 = self._dialogs.select_by_name

		self._dialogs.select_by_name.freeze(slot2)
	end

	return 
end
function CoreEditor:thaw_gui_lists()
	if self._unit_list then
		slot3 = self._unit_list

		self._unit_list.thaw(slot2)
	end

	if self._dialogs.select_by_name then
		slot3 = self._dialogs.select_by_name

		self._dialogs.select_by_name.thaw(slot2)
	end

	return 
end
function CoreEditor:reset_dialog(name)
	if self._dialogs[name] then
		slot4 = self._dialogs[name]

		self._dialogs[name].reset(slot3)
	end

	return 
end
function CoreEditor:_reset_dialogs()
	slot3 = self._dialogs

	for name, dialog in pairs(slot2) do
		slot8 = dialog

		dialog.reset(slot7)
	end

	return 
end
function CoreEditor:_recreate_dialogs()
	slot3 = self._dialogs

	for name, dialog in pairs(slot2) do
		slot8 = dialog

		dialog.recreate(slot7)
	end

	return 
end
function CoreEditor:get_real_name(name)
	local fs = " %*"
	slot6 = fs

	if string.find(slot4, name) then
		slot6 = fs
		local e = string.find(slot4, name)
		slot8 = e - 1
		name = string.sub(name, name, 1)
	end

	return name
end
function CoreEditor:add_selected_unit_callback(callback_func)
	self._selected_unit_callbacks = self._selected_unit_callbacks or {}
	slot5 = callback_func

	table.insert(slot3, self._selected_unit_callbacks)

	return callback_func
end
function CoreEditor:remove_selected_unit_callback(callback_func)
	if self._selected_unit_callbacks then
		slot5 = callback_func

		table.delete(slot3, self._selected_unit_callbacks)
	end

	return 
end
function CoreEditor:set_open_file_and_dir(path, dir)
	self._openfile = path
	self._opendir = dir

	return 
end
function CoreEditor:update_load_progress(num, title)
	if self._load_progress then
		slot7 = title

		self._load_progress.update_bar(slot4, self._load_progress, num)
	end

	return 
end
function CoreEditor:recent_file(path)
	slot4 = self._recent_files

	for _, file in ipairs(slot3) do
		if file.path == path then
			return file
		end
	end

	return 
end
function CoreEditor:save_editor_settings(path, dir)
	self._lastfile = path
	self._lastdir = dir
	self._title = self._editor_name .. " - " .. self._lastfile
	slot6 = self._title

	Global.frame.set_title(" - ", Global.frame)

	slot5 = self._recent_files

	for i, file in ipairs(" - ") do
		slot13 = self._recent_files_callback

		Global.frame.disconnect(slot9, Global.frame, file.path, "EVT_COMMAND_MENU_SELECTED")
	end

	slot5 = self._recent_files
	slot9 = self._lastfile

	table.delete(slot4, self.recent_file(slot7, self))

	slot7 = {
		path = self._lastfile,
		dir = self._lastdir
	}

	table.insert(slot4, self._recent_files, 1)

	self._recent_files[self._recent_files_limit + 1] = nil
	slot5 = self._rf_menu

	self._rf_menu.clear(self._recent_files_limit + 1)

	slot5 = self._recent_files

	for i, file in ipairs(self._recent_files_limit + 1) do
		slot13 = ""

		self._rf_menu.append_item(slot9, self._rf_menu, file.path, i .. " " .. file.path)

		slot14 = i

		Global.frame.connect(slot9, Global.frame, file.path, "EVT_COMMAND_MENU_SELECTED", self._recent_files_callback)
	end

	slot8 = managers.database
	local f = SystemFS.open(slot4, SystemFS, managers.database.base_path("w") .. self._editor_settings_path .. ".xml")
	slot7 = "<editor>"

	f.puts(SystemFS, f)

	local t = "\t"
	slot8 = t .. "<last_dir value=\"" .. dir .. "\\\"/>"

	f.puts(f, f)

	slot7 = self._recent_files

	for i, file in ipairs(f) do
		slot13 = t .. "<recent_file index=\"" .. i .. "\" path=\"" .. file.path .. "\" dir=\"" .. file.dir .. "\"/>"

		f.puts(slot11, f)
	end

	slot8 = "</editor>"

	f.puts(slot6, f)

	slot8 = f

	SystemFS.close(slot6, SystemFS)

	return 
end
function CoreEditor:_load_editor_settings()
	slot5 = self._editor_settings_path

	if DB.has(slot2, DB, "xml") then
		slot5 = self._editor_settings_path
		local node = DB.load_node(slot2, DB, "xml")
		slot4 = node

		for setting in node.children(DB) do
			slot8 = setting

			if setting.name(slot7) == "last_dir" then
				slot9 = "value"
				self._lastdir = setting.parameter(slot7, setting)
			else
				slot8 = setting

				if setting.name(slot7) == "recent_file" then
					slot9 = "index"

					if setting.has_parameter(slot7, setting) then
						slot11 = "index"
						local index = tonumber(setting.parameter(slot9, setting))
						slot11 = {
							path = setting.parameter(slot13, setting),
							dir = setting.parameter(slot13, setting)
						}
						slot15 = "path"
						slot15 = "dir"

						table.insert(setting.parameter, self._recent_files, index)
					end
				end
			end
		end
	end

	return 
end
function CoreEditor:save_layout()
	local params = {
		save_dialog_states = self._save_dialog_states,
		dialogs = self._dialogs,
		dialogs_settings = self._dialogs_settings
	}
	slot4 = managers.database
	params.file = managers.database.base_path(slot3) .. self._layout_path .. ".editor_layout"
	slot4 = params

	CoreEditorSave.save_layout(self._layout_path)

	return 
end
function CoreEditor:load_layout()
	slot5 = self._layout_path

	if DB.has(slot2, DB, "editor_layout") then
		local params = {
			dialogs_settings = self._dialogs_settings
		}
		slot6 = self._layout_path
		params.file = DB.open(slot3, DB, "editor_layout")
		slot4 = params

		CoreEditorSave.load_layout(slot3)
	end

	return 
end
function CoreEditor:show_dialog(name, class_name)
	if not self._dialogs[name] then
		local settings = self._dialogs_settings[name]
		slot8 = settings
		self._dialogs[name] = _G[class_name].new(slot6, _G[class_name])
	else
		slot6 = true

		self._dialogs[name].set_visible(slot4, self._dialogs[name])
	end

	return 
end
function CoreEditor:hide_dialog(name)
	if self._dialogs[name] then
		slot5 = false

		self._dialogs[name].set_visible(slot3, self._dialogs[name])
	end

	return 
end
function CoreEditor:save_configuration()
	slot6 = managers.database
	local f = SystemFS.open(slot2, SystemFS, managers.database.base_path("w") .. self._configuration_path .. ".xml")
	slot5 = "<editor_configuration>"

	f.puts(SystemFS, f)

	local t = "\t"
	slot5 = self._config

	for value, ctrlr in pairs(f) do
		slot17 = self[value]
		slot19 = self[value]
		slot11 = t .. "<" .. value .. " value=\"" .. tostring(slot16) .. "\" type=\"" .. type_name(slot18) .. "\"/>"

		f.puts(slot9, f)
	end

	slot6 = "</editor_configuration>"

	f.puts(slot4, f)

	slot6 = f

	SystemFS.close(slot4, SystemFS)

	return 
end
function CoreEditor:_load_configuration()
	slot5 = self._configuration_path

	if DB.has(slot2, DB, "xml") then
		slot5 = self._configuration_path
		local node = DB.load_node(slot2, DB, "xml")
		slot4 = node

		for setting in node.children(DB) do
			slot12 = "type"
			slot9 = setting.parameter(slot10, setting)
			slot13 = "value"
			self[setting.name(slot7)] = string_to_value(setting, setting.parameter(setting, setting))
		end
	end

	return 
end
function CoreEditor:save_edit_setting_values()
	if not self._save_edit_setting_values then
		slot6 = managers.database
		slot4 = managers.database.base_path(slot5) .. self._edit_setting_values_path .. ".xml"

		if SystemFS.exists(slot2, SystemFS) then
			slot6 = managers.database
			slot4 = managers.database.base_path(slot5) .. self._edit_setting_values_path .. ".xml"

			SystemFS.delete_file(slot2, SystemFS)
		end

		return 
	end

	slot6 = managers.database
	local f = SystemFS.open(slot2, SystemFS, managers.database.base_path("w") .. self._edit_setting_values_path .. ".xml")
	slot5 = "<edit_setting_values>"

	f.puts(SystemFS, f)

	local t = "\t"
	slot5 = self._edit_setting_values

	for _, value in ipairs(f) do
		slot17 = self[value]
		slot19 = self[value]
		slot11 = t .. "<" .. value .. " value=\"" .. tostring(slot16) .. "\" type=\"" .. type_name(slot18) .. "\"/>"

		f.puts(slot9, f)
	end

	slot6 = "</edit_setting_values>"

	f.puts(slot4, f)

	slot6 = f

	SystemFS.close(slot4, SystemFS)

	return 
end
function CoreEditor:_load_edit_setting_values()
	slot5 = self._edit_setting_values_path

	if not DB.has(slot2, DB, "xml") then
		return 
	end

	slot5 = self._edit_setting_values_path
	local node = DB.load_node(slot2, DB, "xml")
	slot4 = node

	for setting in node.children(DB) do
		slot12 = "type"
		slot9 = setting.parameter(slot10, setting)
		slot13 = "value"
		self[setting.name(slot7)] = string_to_value(setting, setting.parameter(setting, setting))
	end

	return 
end
function CoreEditor:select_unit_name(name)
	slot6 = name
	local ud = CoreEngineAccess._editor_unit_data(name.id(slot5))
	slot5 = self._layers

	for layer_name, layer in pairs(name.id) do
		slot12 = layer

		for _, u_type in ipairs(layer.unit_types(slot11)) do
			slot15 = ud
			slot15 = ud.type(slot14)

			if ud.type(slot14).s(slot14) == u_type then
				slot16 = self._notebook

				for i = 0, self._notebook.get_page_count(slot15) - 1, 1 do
					slot20 = i

					if self._notebook.get_page_text(slot18, self._notebook) == layer_name then
						slot20 = i

						self._notebook.set_page(slot18, self._notebook)

						slot19 = layer
						local units_notebook = layer.units_notebook(slot18)

						if units_notebook then
							slot20 = self
							slot23 = ud
							slot23 = ud.type(slot22)
							local nb_type = self.category_name(slot19, ud.type(slot22).s(slot22))
							slot22 = units_notebook

							for j = 0, units_notebook.get_page_count(ud.type(slot22).s) - 1, 1 do
								slot26 = j

								if units_notebook.get_page_text(slot24, units_notebook) == nb_type then
									slot26 = j

									units_notebook.set_page(slot24, units_notebook)
								end
							end

							slot22 = nb_type
							local units_page = layer.notebook_unit_list(slot20, layer)

							units_page.filter.set_value(layer, units_page.filter)

							local units_list = units_page.units
							slot24 = units_list

							for k = 0, units_list.item_count("") - 1, 1 do
								slot31 = k
								slot28 = name

								if layer.get_real_name(slot26, units_list.get_item_data(slot29, units_list)) == name.s(layer) then
									slot29 = true

									units_list.set_item_selected(slot26, units_list, k)

									slot28 = k

									units_list.ensure_visible(slot26, units_list)

									slot28 = name

									return "Found " .. name.s(units_list) .. " in layer " .. layer_name .. " with category " .. nb_type
								end
							end
						end

						slot21 = name

						return "Found " .. name.s(slot20) .. " in layer " .. layer_name .. ". No category."
					end
				end
			end
		end
	end

	slot5 = name
	slot7 = ud
	slot7 = ud.type(slot6)

	return name.s(slot4) .. " type " .. ud.type(slot6).s(slot6) .. " is in no layer."
end
function CoreEditor:select_unit(unit)
	slot4 = unit

	if unit.unit_data(slot3).instance then
		slot5 = "Instances"

		self.change_layer_notebook(slot3, self)

		slot5 = unit

		self._current_layer.set_select_unit(slot3, self._current_layer)

		return 
	end

	slot6 = unit
	slot6 = unit.name(slot5)
	local ud = CoreEngineAccess._editor_unit_data(unit.name(slot5).id(slot5))
	slot5 = self._layers

	for layer_name, layer in pairs(unit.name(slot5).id) do
		slot12 = layer

		for _, u_type in ipairs(layer.unit_types(slot11)) do
			slot15 = ud
			slot15 = ud.type(slot14)

			if ud.type(slot14).s(slot14) == u_type then
				slot16 = self._notebook

				for i = 0, self._notebook.get_page_count(slot15) - 1, 1 do
					slot20 = i

					if self._notebook.get_page_text(slot18, self._notebook) == layer_name then
						slot20 = i

						self._notebook.set_page(slot18, self._notebook)

						slot20 = unit

						self._current_layer.set_select_unit(slot18, self._current_layer)
					end
				end
			end
		end
	end

	return 
end
function CoreEditor:select_unit_by_unit_id(unit_id)
	slot4 = self._layers

	for layer_name, layer in pairs(slot3) do
		slot9 = layer

		if layer.created_units_pairs(slot8)[unit_id] then
			slot12 = layer
			slot10 = layer.created_units_pairs(slot11)[unit_id]

			self.select_unit(slot8, self)

			return 
		end
	end

	slot5 = "No unit found with id " .. unit_id

	self.output_warning(slot3, self)

	return 
end
function CoreEditor:show_replace_unit()
	if not self._replace_dialog then
		slot5 = self._replace_unit_categories
		self._replace_dialog = ReplaceUnit.new(slot2, ReplaceUnit, "Replace Units")
	else
		slot3 = self._replace_dialog

		self._replace_dialog.show_modal(slot2)
	end

	slot3 = self._replace_dialog

	return self._replace_dialog.result(slot2)
end
function CoreEditor:show_replace_massunit()
	if not self._replace_massunit_dialog then
		slot5 = {
			"brush"
		}
		self._replace_massunit_dialog = ReplaceUnit.new(slot2, ReplaceUnit, "Replace Massunits")
	else
		slot3 = self._replace_massunit_dialog

		self._replace_massunit_dialog.show_modal(slot2)
	end

	slot3 = self._replace_massunit_dialog

	return self._replace_massunit_dialog.result(slot2)
end
function CoreEditor:reload_units(unit_names, small_compile, skip_replace_units)
	if #unit_names <= 0 then
		return 
	end

	local reload_data = nil

	if not skip_replace_units then
		slot8 = unit_names
		reload_data = self._current_layer.prepare_replace(slot6, self._current_layer)
	end

	if small_compile == true then
		local files = {}
		slot8 = unit_names

		for _, unit_name in ipairs(slot7) do
			slot13 = unit_name

			CoreUnit.editor_load_unit(slot12)

			slot15 = ""
			local unit_data = PackageManager.unit_data(slot12, PackageManager, unit_name)
			slot14 = unit_data
			local sequence_file = unit_data.sequence_manager_filename(PackageManager)

			if sequence_file then
				slot18 = sequence_file
				slot16 = sequence_file.s(slot17) .. ".sequence_manager"

				table.insert(slot14, files)
			end

			slot15 = unit_data
			local material_config_file = unit_data.material_config(slot14)

			if material_config_file then
				slot19 = material_config_file
				slot17 = material_config_file.s(slot18) .. ".material_config"

				table.insert(slot15, files)
			end

			slot16 = files
			slot22 = unit_name
			slot20 = unit_name.s(slot21) .. ".unit"

			table.insert(slot15, managers.database.entry_relative_path(slot18, managers.database))

			slot16 = files
			slot22 = unit_name
			slot20 = unit_name.s(".unit") .. ".object"

			table.insert(slot15, managers.database.entry_relative_path(slot18, managers.database))

			slot16 = files
			slot22 = unit_name
			slot20 = unit_name.s(".object") .. ".model"

			table.insert(slot15, managers.database.entry_relative_path(slot18, managers.database))
		end

		slot9 = {
			target_db_name = "all",
			send_idstrings = false,
			preprocessor_definitions = "preprocessor_definitions",
			verbose = false,
			platform = string.lower(SystemInfo.platform(slot13).s(slot13)),
			source_root = managers.database.base_path(slot11),
			target_db_root = Application.base_path(slot11) .. "assets",
			source_files = files
		}
		slot14 = SystemInfo
		slot14 = SystemInfo.platform(slot13)
		slot12 = managers.database
		slot12 = Application

		Application.data_compile(slot7, Application)

		slot8 = DB

		DB.reload(slot7)

		slot8 = managers.database

		managers.database.clear_all_cached_indices(slot7)
	else
		slot7 = managers.database

		managers.database.recompile(slot6)
	end

	slot7 = unit_names

	for _, unit_name in ipairs(slot6) do
		slot14 = true

		managers.sequence.reload(slot11, managers.sequence, unit_name)

		slot12 = Idstring(unit_name)

		CoreEngineAccess._editor_reload(slot11, unit_name.id("unit"))

		slot14 = unit_name
		local material_config = CoreEngineAccess._editor_unit_data(unit_name.id(unit_name.id)).material_config(slot11)
		slot13 = Application
		slot16 = material_config

		Application.reload_material_config(CoreEngineAccess._editor_unit_data(unit_name.id(unit_name.id)), material_config.id(unit_name))
	end

	if not skip_replace_units then
		slot9 = reload_data

		self._current_layer.recreate_units(slot6, self._current_layer, nil)
	end

	return 
end
function CoreEditor:entering_window(user_data, event_object)
	if Global.running_simulation then
		slot6 = false

		self.set_in_mixed_input_mode(slot4, self)

		return 
	end

	if self._wants_to_leave_window then
		self._wants_to_leave_window = false

		return 
	end

	self._in_window = true
	slot5 = self

	self.add_triggers(slot4)

	self._editor_data.keyboard_available = true

	return 
end
function CoreEditor:leaving_window(user_data, event_object)
	if Global.running_simulation then
		return 
	end

	slot5 = self

	self.leave_window(slot4)

	return 
end
function CoreEditor:leave_window()
	self._wants_to_leave_window = false
	self._in_window = false
	slot3 = self

	self.clear_triggers(slot2)

	self._editor_data.keyboard_available = false

	return 
end
function CoreEditor:menu_toolbar_toggle(data, event)
	slot6 = self[data.menu]
	slot9 = event
	self[data.value] = self[data.menu].is_checked(slot5, event.get_id(slot8))

	if data.toolbar then
		local toolbar = self[data.toolbar]
		slot9 = event

		toolbar.set_tool_state(slot5, toolbar, event.get_id(self[data.value]))
	end

	return 
end
function CoreEditor:toolbar_toggle(data, event)
	local toolbar = self[data.toolbar] or self._toolbar
	slot7 = toolbar
	slot10 = event
	self[data.value] = toolbar.tool_state(slot6, event.get_id(slot9))

	if self[data.menu] then
		slot9 = event

		self[data.menu].set_checked(slot5, self[data.menu], event.get_id(self[data.value]))
	end

	return 
end
function CoreEditor:toolbar_toggle_trg(data)
	local toolbar = self[data.toolbar] or self._toolbar
	slot10 = data.id
	slot7 = not toolbar.tool_state(slot8, toolbar)

	toolbar.set_tool_state(slot4, toolbar, data.id)

	slot7 = data.id
	self[data.value] = toolbar.tool_state(toolbar, toolbar)

	if self[data.menu] then
		slot7 = self[data.value]

		self[data.menu].set_checked(slot4, self[data.menu], data.id)
	end

	return 
end
function CoreEditor:coordinate_system()
	return self._coordinate_system
end
function CoreEditor:is_coordinate_system(coor)
	return self._coordinate_system == coor
end
function CoreEditor:use_surface_move()
	return self._use_surface_move
end
function CoreEditor:use_snappoints()
	return self._use_snappoints
end
function CoreEditor:grid_size()
	return (ctrl() and 1) or self._grid_size
end
function CoreEditor:snap_rotation()
	return (ctrl() and 1) or self._snap_rotation
end
function CoreEditor:snap_rotation_axis()
	return self._snap_rotation_axis
end
function CoreEditor:rotation_speed()
	return self._rotation_speed
end
function CoreEditor:layer_draw_grid()
	return self._layer_draw_grid
end
function CoreEditor:layer_draw_marker()
	return self._layer_draw_marker
end
function CoreEditor:grid_altitude()
	return self._grid_altitude
end
function CoreEditor:set_grid_altitude(altitude)
	self._grid_altitude = altitude

	return 
end
function CoreEditor:using_move_widget()
	return self._use_move_widget
end
function CoreEditor:using_rotate_widget()
	return self._use_rotate_widget
end
function CoreEditor:using_groups()
	return self._using_groups
end
function CoreEditor:debug_draw_groups()
	return self._debug_draw_groups
end
function CoreEditor:simulation_debug_areas()
	return self._simulation_debug_areas
end
function CoreEditor:appwin_size_event(data, event)
	self._resizing_appwin = true
	slot5 = event

	event.skip(slot4)

	return 
end
function CoreEditor:resize_appwin_done()
	slot3 = Global.frame

	if Global.frame.is_iconized(slot2) then
		return 
	end

	if self._appwin_fixed_resolution then
		slot4 = Global.application_window

		if self._appwin_fixed_resolution ~= Global.application_window.get_size(slot3) then
			slot4 = self._appwin_fixed_resolution

			Global.application_window.set_size(slot2, Global.application_window)
		end

		return 
	end

	local size = Global.application_window.get_size(slot2)
	slot5 = size

	self._update_screen_values(Global.application_window, self)

	return 
end
function CoreEditor:_update_screen_values(size)
	slot10 = false

	Application.set_mode(slot3, Application, size.x, size.y, false, -1, true)

	slot5 = size.x / size.y

	managers.viewport.set_aspect_ratio2(slot3, managers.viewport)

	slot4 = Application
	self._screen_borders = Application.screen_resolution(slot3)

	if self._orthographic then
		slot4 = self._camera_controller

		self._camera_controller.set_orthographic_screen(slot3)
	end

	if managers.viewport then
		slot4 = managers.viewport

		managers.viewport.resolution_changed(slot3)
	end

	return 
end
function CoreEditor:_set_appwin_fixed_resolution(size)
	self._appwin_fixed_resolution = size

	if not size then
		slot4 = Global.frame_panel

		Global.frame_panel.layout(slot3)

		return 
	end

	slot5 = size

	Global.application_window.set_size(slot3, Global.application_window)

	slot5 = size

	self._update_screen_values(slot3, self)

	return 
end
function CoreEditor:add_notebook_pages()
	local ordered = {
		"Statics",
		"Mission",
		"Ai",
		"Brush"
	}
	slot4 = ordered

	for _, name in ipairs(slot3) do
		local layer = self._layers[name]
		slot11 = self._notebook
		local panel, start_page = layer.build_panel(slot9, layer)

		if panel then
			slot15 = start_page

			self._notebook.add_page(slot11, self._notebook, panel, name)
		end
	end

	slot4 = self._layers

	for name, layer in pairs(slot3) do
		slot10 = name

		if not table.contains(slot8, ordered) then
			slot10 = self._notebook
			local panel, start_page = layer.build_panel(slot8, layer)

			if panel then
				slot14 = start_page

				self._notebook.add_page(slot10, self._notebook, panel, name)
			end
		end
	end

	return 
end
function CoreEditor:putdown_tool()
	slot4 = "CoreEditor:putdown_tool"

	cat_print(slot2, "editor")

	self._enabled = false
	slot3 = self

	self.clear_triggers(slot2)

	slot4 = false

	self._light.set_enable(slot2, self._light)

	slot4 = false

	self.set_wanted_mute(slot2, self)

	slot4 = false

	self.set_listener_active(slot2, self)

	slot5 = false

	managers.sound_environment.set_check_object_active(slot2, managers.sound_environment, self._sound_check_object)

	slot3 = self
	slot3 = self.viewport(slot2)
	slot5 = Idstring(slot6)
	slot8 = "default"

	self.viewport(slot2).vp(slot2).set_post_processor_effect(slot2, self.viewport(slot2).vp(slot2), "World", Idstring("dof_prepare_post_processor"))

	slot3 = self
	slot3 = self.viewport(slot2)
	slot5 = Idstring(Idstring)
	slot8 = "bloom_DOF_combine"

	self.viewport(slot2).vp(slot2).set_post_processor_effect(slot2, self.viewport(slot2).vp(slot2), "World", Idstring("bloom_combine_post_processor"))

	return 
end
function CoreEditor:set_listener_enabled(enabled)
	if not self._listener_always_enabled then
	end

	slot6 = enabled

	managers.listener.set_listener_enabled(slot3, managers.listener, self._listener_id)

	return 
end
function CoreEditor:set_listener_always_enabled(enabled)
	self._listener_always_enabled = enabled

	return 
end
function CoreEditor:listener_always_enabled()
	return self._listener_always_enabled
end
function CoreEditor:sound_check_object_active(active)
	slot6 = active

	managers.sound_environment.set_check_object_active(slot3, managers.sound_environment, self._sound_check_object)

	return 
end
function CoreEditor:set_listener_active(active)
	if active then
		if not self._listener_activation_id then
			slot6 = "editor"
			self._listener_activation_id = managers.listener.activate_set(slot3, managers.listener, "main")
		end
	elseif self._listener_activation_id then
		slot5 = self._listener_activation_id

		managers.listener.deactivate_set(slot3, managers.listener)

		self._listener_activation_id = nil
	end

	return 
end
function CoreEditor:set_wanted_mute(mute)
	self._mute_states.wanted = mute

	return 
end
function CoreEditor:left_mouse_btn()
	if self._trigger_add_unit then
		slot4 = {
			sample = true,
			mask = managers.slot.get_mask(slot6, managers.slot)
		}
		slot8 = "all"
		local ray = self.unit_by_raycast(slot2, self)

		if ray and ray.unit then
			slot4 = ray.unit

			self._trigger_add_unit(slot3)
		end
	end

	return 
end
function CoreEditor:set_trigger_add_unit(cb)
	self._trigger_add_unit = cb

	return 
end
function CoreEditor:conditions()
	return self._trigger_add_unit and true
end
function CoreEditor:add_triggers()
	if not self._triggers_added and self._in_window then
		slot4 = Idstring(slot5)
		slot9 = "undo"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("undo", self, self))

		slot4 = Idstring(callback)
		slot9 = "toggle_mixed_input_mode"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("toggle_mixed_input_mode", self, self))

		slot4 = Idstring(callback)
		slot9 = "move_speed_up"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("move_speed_up", self, self))

		slot4 = Idstring(callback)
		slot9 = "move_speed_down"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("move_speed_down", self, self))

		slot4 = Idstring(callback)
		slot9 = "left_mouse_btn"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("lmb", self, self))

		slot4 = Idstring(callback)
		slot9 = "close_editing"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("esc", self, self))

		slot4 = Idstring(callback)
		slot9 = "set_ruler_points"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("ruler_points", self, self))

		slot4 = Idstring(callback)
		slot9 = "change_continent_by_unit"

		self._ctrl.add_trigger(slot2, self._ctrl, callback("change_continent_by_unit", self, self))

		slot3 = self._ews_triggers

		for k, cb in pairs(slot2) do
			slot11 = k

			self._ctrl.add_trigger(slot7, self._ctrl, Idstring(cb))
		end

		if self._current_layer then
			slot3 = self._current_layer

			self._current_layer.add_triggers(slot2)
		end

		self._triggers_added = true

		return true
	end

	return false
end
function CoreEditor:clear_triggers()
	if self._triggers_added then
		slot3 = self._ctrl

		self._ctrl.clear_triggers(slot2)

		if self._current_layer then
			slot3 = self._current_layer

			self._current_layer.clear_triggers(slot2)
		end

		self._triggers_added = false
	end

	return 
end
function CoreEditor:layers()
	return self._layers
end
function CoreEditor:layer(name)
	return self._layers[name]
end
function CoreEditor:get_level_path()
	return self._lastdir
end
function CoreEditor:get_open_dir()
	return self._opendir
end
function CoreEditor:lastfile()
	return self._lastfile
end
function CoreEditor:set_world_holder(path)
	slot5 = "FIXME: Either unused or broken."

	Application.error(slot3, Application)

	slot5 = {
		file_type = "world",
		file_path = path
	}
	self._world_holder = WorldHolder.new(slot3, WorldHolder)

	return 
end
function CoreEditor:get_world_holder_path()
	slot4 = "FIXME: Either unused or broken."

	Application.error(slot2, Application)

	slot3 = self._world_holder

	return self._world_holder.get_world_file(slot2)
end
function CoreEditor:undo()
	if self._current_layer and ctrl() then
		slot3 = self._current_layer

		self._current_layer.undo(slot2)
	end

	return 
end
function CoreEditor:list_terminated()
	local units = {}
	slot7 = "all"

	for _, unit in ipairs(World.find_units_quick(slot5, World)) do
		slot9 = unit
		slot9 = unit.type(slot8)

		if unit.type(slot8).s(slot8) == "termination" then
			slot13 = unit
			slot15 = unit
			slot10 = "Unit " .. unit.unit_data(slot12).name_id .. " at " .. unit.position(slot14) .. " is terminated."

			self.output_warning(slot8, self)
		end
	end

	return 
end
function CoreEditor:convert_position(fract_position)
	slot6 = fract_position.z * 100

	return Vector3(slot3, fract_position.x * self._screen_borders.x, fract_position.y * self._screen_borders.y)
end
function CoreEditor:step_id()
	return self._STEP_ID
end
function CoreEditor:get_unit_id(unit)
	slot4 = unit

	if unit.unit_data(slot3).continent then
		slot4 = unit
		slot5 = unit

		return unit.unit_data(slot3).continent.get_unit_id(slot3, unit.unit_data(slot3).continent)
	end

	local i = self._max_id

	while self._unit_ids[i] do
		i = i + 1
	end

	slot5 = unit
	unit.unit_data(slot4).unit_id = i
	slot6 = unit

	self.register_unit_id(slot4, self)

	return i
end
function CoreEditor:register_unit_id(unit)
	slot4 = unit

	if unit.unit_data(slot3).continent then
		slot4 = unit
		slot5 = unit

		unit.unit_data(slot3).continent.register_unit_id(slot3, unit.unit_data(slot3).continent)

		return true
	end

	slot5 = unit

	if self._unit_ids[unit.unit_data(slot4).unit_id] then
		return false
	end

	slot5 = unit
	self._unit_ids[unit.unit_data(slot4).unit_id] = unit

	return true
end
function CoreEditor:remove_unit_id(unit)
	slot4 = unit

	if unit.unit_data(slot3).continent then
		slot4 = unit
		slot5 = unit

		unit.unit_data(slot3).continent.remove_unit_id(slot3, unit.unit_data(slot3).continent)

		return 
	end

	slot5 = unit
	self._unit_ids[unit.unit_data(slot4).unit_id] = nil

	return 
end
function CoreEditor:get_gui_id()
	self._gui_id = self._gui_id + 1

	return self._gui_id
end
function CoreEditor:max_id()
	return self._max_id
end
function CoreEditor:set_value_info_pos(position)
	local res = Application.screen_resolution(slot3)
	slot6 = (1 + position.x) / 2 * res.x
	position = position.with_x(Application, position)
	slot6 = (1 + position.y) / 2 * res.y - 100
	position = position.with_y(Application, position)
	slot6 = "value"
	slot7 = position.y

	self._gui.child(Application, self._gui).set_center(Application, self._gui.child(Application, self._gui), position.x)

	return 
end
function CoreEditor:set_value_info(info)
	slot5 = "value"
	slot5 = info

	self._gui.child(slot3, self._gui).set_text(slot3, self._gui.child(slot3, self._gui))

	return 
end
function CoreEditor:set_value_info_visibility(vis)
	slot5 = "value"
	slot5 = vis

	self._gui.child(slot3, self._gui).set_visible(slot3, self._gui.child(slot3, self._gui))

	return 
end
function CoreEditor:_help_draw_all_units(t, dt)
	slot5 = Ladder.ladders

	for _, unit in ipairs(slot4) do
		slot10 = unit
		slot10 = unit.ladder(slot9)

		unit.ladder(slot9).debug_draw(slot9)
	end

	return 
end
function CoreEditor:draw_occluders(t, dt)
	local brush = Draw.brush(slot4)
	slot6 = self._vp
	local cam_pos = self._vp.camera(Draw).position(Draw)
	slot7 = self._vp
	local cam_far_range = self._vp.camera(self._vp.camera(Draw)).far_range(self._vp.camera(Draw))
	slot8 = self._vp
	slot8 = self._vp.camera(self._vp.camera(self._vp.camera(Draw)))
	local cam_dir = self._vp.camera(self._vp.camera(self._vp.camera(Draw))).rotation(self._vp.camera(self._vp.camera(Draw))).y(self._vp.camera(self._vp.camera(Draw)))
	slot9 = self._layers

	for _, layer in pairs(self._vp.camera(self._vp.camera(self._vp.camera(Draw))).rotation(self._vp.camera(self._vp.camera(Draw)))) do
		local units = layer.created_units(slot13)
		slot15 = units

		for _, unit in ipairs(layer) do
			local unit_pos = unit.position(slot19)
			slot21 = unit_pos - cam_pos

			if unit_pos - cam_pos.length(unit) < cam_far_range then
				slot22 = "oc_*"
				local objects = unit.get_objects(slot20, unit)
				slot22 = objects

				for _, object in ipairs(unit) do
					slot27 = object
					slot27 = object.rotation(slot26)
					local object_dir = object.rotation(slot26).y(slot26)
					local a = 0.05
					local r = 1
					local g = 0
					local b = 0
					slot33 = cam_dir
					local d = object_dir.dot(slot31, object_dir)

					if d < 0 then
						local object_pos = object.position(slot32)
						slot35 = object_pos - cam_pos
						local c = object_dir.dot(object, object_dir)

						if c < 0 then
							b = 0
							g = 1
							r = 0
							a = 0.1
						end
					end

					slot33 = brush
					slot39 = b

					brush.set_color(slot32, Color(slot35, a, r, g))

					slot34 = object

					brush.object(slot32, brush)

					slot37 = b

					Application.draw(slot32, Application, object, r, g)
				end
			end
		end
	end

	return 
end
function CoreEditor:_should_draw_body(body)
	slot4 = body

	if not body.enabled(slot3) then
		return false
	end

	slot4 = body
	slot7 = "editor"

	if body.has_ray_type(slot3, Idstring(slot6)) then
		slot4 = body
		slot7 = "walk"

		if not body.has_ray_type(slot3, Idstring(slot6)) then
			slot4 = body
			slot7 = "mover"

			if not body.has_ray_type(slot3, Idstring(slot6)) then
				return false
			end
		end
	end

	return true
end
function CoreEditor:_body_color(body)

	-- Decompilation error in this vicinity:
	slot4 = body
	slot7 = "editor"
	slot7 = 0.85

	return Color(slot3, 1, 0.5, 0.5)
end
function CoreEditor:_draw_bodies(t, dt)
	slot11 = 1
	local pen = Draw.pen(slot4, Color(slot7, 0.15, 1, 1))
	slot6 = self._current_layer
	local units = self._current_layer.selected_units(Draw)

	if 0 < #units then
		slot13 = 1
		local brush = Draw.brush(slot6, Color(slot9, 0.15, 1, 1))
		slot11 = "core/fonts/nice_editor_font"

		brush.set_font(Draw, brush, Idstring(0.15))

		slot8 = brush
		slot11 = "OverlayVertexColorTextured"

		brush.set_render_template(Draw, Idstring(16))

		slot8 = units

		for _, unit in ipairs(Draw) do
			slot13 = unit

			if alive(slot12) then
				slot13 = unit
				local num = unit.num_bodies(slot12)

				for i = 0, num - 1, 1 do
					slot19 = i
					local body = unit.body(slot17, unit)
					slot20 = body

					if self._should_draw_body(unit, self) then
						slot23 = body

						pen.set(slot18, pen, self._body_color(slot21, self))

						slot20 = body

						pen.body(slot18, pen)

						slot19 = brush
						slot23 = body

						brush.set_color(slot18, self._body_color("no_z", self))

						slot20 = 0
						slot23 = unit
						local offset = Vector3(slot18, 0, unit.bounding_sphere_radius(self))
						slot23 = body
						slot23 = body.oobb(self)
						slot21 = body.oobb(self).center(self)
						slot26 = body
						slot26 = body.name(slot25)

						brush.center_text(0, brush, utf8.from_latin1(body.name(slot25).s(slot25)))
					end
				end
			end
		end

		return 
	end

	slot12 = self
	local bodies = World.find_bodies(slot6, World, "intersect", "sphere", self.camera_position(2500))
	slot8 = bodies

	for _, body in ipairs(World) do
		slot14 = body

		if self._should_draw_body(slot12, self) then
			slot13 = pen
			slot17 = body

			pen.set(slot12, self._body_color(slot15, self))

			slot14 = body

			pen.body(slot12, pen)
		end
	end

	return 
end
function CoreEditor:update(time, rel_time)
	if self._enabled then
		slot7 = rel_time

		self.update_title_bar(slot4, self, time)

		if self._in_window then
			entering_window()
		end

		slot5 = managers.editor._editor_data.virtual_controller

		if #managers.editor._editor_data.virtual_controller.down_list(slot4) == 0 and self._wants_to_leave_window then
			slot5 = self

			self.leave_window(slot4)
		end

		slot5 = managers.editor._editor_data.virtual_controller

		if 0 < #managers.editor._editor_data.virtual_controller.pressed_list(slot4) then
			self._confirm_on_new = true
		end

		if self._clear_and_reset_layer_timer then
			if self._clear_and_reset_layer_timer == 0 then
				self._clear_and_reset_layer_timer = nil
				slot5 = self

				self.reset_layers(slot4)
			else
				self._clear_and_reset_layer_timer = self._clear_and_reset_layer_timer - 1
			end
		end

		if self._resizing_appwin then
			self._resizing_appwin = false
			slot5 = self

			self.resize_appwin_done(slot4)
		end

		slot7 = rel_time

		self._help_draw_all_units(slot4, self, time)

		if self._draw_occluders then
			slot7 = rel_time

			self.draw_occluders(slot4, self, time)
		end

		if self._draw_bodies_on then
			slot7 = rel_time

			self._draw_bodies(slot4, self, time)
		end

		if self._camera_controller then

			-- Decompilation error in this vicinity:
			local camera = self._vp.camera(slot4)
			local cam_pos = camera.position(self._vp)
			local cam_rot = camera.rotation(camera)
			local far_range = camera.far_range(camera)
			slot10 = "camera"
			slot10 = "cam_pos"
			slot9 = self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui))
			slot15 = cam_pos.z

			self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui)).set_text(camera, string.format(slot11, "Cam pos:   \"%.2f %.2f %.2f\" [cm]", cam_pos.x, cam_pos.y))

			slot10 = "camera"
			slot10 = "cam_rot"
			slot9 = self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui))
			slot14 = cam_rot.pitch(cam_rot)
			slot17 = cam_rot

			self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui)).set_text(camera, string.format(slot11, "Cam rot:   \"%.2f %.2f %.2f\"", cam_rot.yaw(cam_pos.y), cam_rot.roll(cam_rot)))

			slot10 = "camera"
			slot10 = "far_range"
			slot9 = self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui))
			slot13 = far_range / 100

			self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui)).set_text(camera, string.format(slot11, "Far range: %.2f [m]"))

			slot10 = "camera"
			slot10 = "select_units_amount"
			slot13 = self._current_layer
			slot10 = "" .. self._current_layer.selected_amount_string("Far range: %.2f [m]")

			self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui)).set_text(camera, self._gui.child(camera, self._gui).child(camera, self._gui.child(camera, self._gui)))

			slot10 = cam_pos

			self._light.set_local_position(camera, self._light)

			if self._camera_locked then
				slot11 = rel_time

				self._camera_controller.update_locked(slot8, self._camera_controller, time)
			end

			if self._draw_hidden_units then
				slot9 = self._hidden_units

				for _, unit in ipairs(slot8) do
					slot18 = 0.75

					Application.draw(slot13, Application, unit, 0, 0)
				end
			end

			slot11 = rel_time

			self._groups.update(slot8, self._groups, time)

			slot9 = self._camera_controller

			if not self._camera_controller.creating_cube_map(slot8) then
				if self._current_layer then
					slot11 = rel_time

					self._current_layer.update(slot8, self._current_layer, time)
				end

				slot9 = self._layers

				for _, layer in pairs(slot8) do
					slot16 = rel_time

					layer.update_always(slot13, layer, time)
				end
			end

			if 0 < self._autosave_time then
				self._autosave_timer = self._autosave_timer + rel_time

				if self._autosave_time * 60 < self._autosave_timer then
					self._autosave_timer = 0
				end
			end

			if not ctrl() and not alt() and not shift() then
				slot9 = self._ctrl
				slot12 = "decrease_view_distance"

				if self._ctrl.down(slot8, Idstring(slot11)) then
					slot12 = camera
					slot10 = camera.far_range(slot11) - 5000 * rel_time

					camera.set_far_range(slot8, camera)
				end

				slot9 = self._ctrl
				slot12 = "increase_view_distance"

				if self._ctrl.down(slot8, Idstring(slot11)) then
					slot12 = camera
					slot10 = camera.far_range(slot11) + 5000 * rel_time

					camera.set_far_range(slot8, camera)
				end
			end

			if shift() then
				slot9 = self._ctrl
				slot12 = "increase_grid_altitude"

				if self._ctrl.pressed(slot8, Idstring(slot11)) then
					slot13 = self
					slot10 = self.grid_altitude(slot11) + self.grid_size(self)

					self.set_grid_altitude(slot8, self)
				end

				slot9 = self._ctrl
				slot12 = "decrease_grid_altitude"

				if self._ctrl.pressed(slot8, Idstring(slot11)) then
					slot13 = self
					slot10 = self.grid_altitude(slot11) - self.grid_size(self)

					self.set_grid_altitude(slot8, self)
				end
			end

			if self._show_center then
				slot11 = 0
				local pos = Vector3(slot8, 0, 0)
				slot13 = 0
				local rot = Rotation.yaw_pitch_roll(0, Rotation, 0, 0)
				slot16 = 1

				Application.draw_sphere(Rotation, Application, pos, 50, 1, 1)

				slot13 = rot

				Application.draw_rotation(Rotation, Application, pos)

				local length = cam_pos - pos.length(Rotation)
				slot14 = pos.z - length / 2
				local from = Vector3(cam_pos - pos, pos.x, pos.y)
				slot15 = pos.z + length / 2
				local to = Vector3(pos.x, pos.x, pos.y)
				slot20 = 1

				Application.draw_cylinder(pos.x, Application, from, to, 50, 1, 1)
			end

			slot11 = rel_time

			self._move_transform_type_in.update(slot8, self._move_transform_type_in, time)

			slot11 = rel_time

			self._rotate_transform_type_in.update(slot8, self._rotate_transform_type_in, time)

			slot11 = rel_time

			self._camera_transform_type_in.update(slot8, self._camera_transform_type_in, time)

			if self._mission_graph then
				slot11 = rel_time

				self._mission_graph.update(slot8, self._mission_graph, time)
			end
		end

		slot5 = self._markers

		for _, marker in pairs(slot4) do
			slot10 = marker

			marker.draw(slot9)
		end

		slot7 = rel_time

		self.update_ruler(slot4, self, time)

		if self._dialogs.edit_unit then
			slot7 = rel_time

			self._dialogs.edit_unit.update(slot4, self._dialogs.edit_unit, time)
		end

		slot7 = rel_time

		self._tick_generate_dome_occlusion(slot4, self, time)
	end

	slot7 = rel_time

	self._update_mute_state(slot4, self, time)

	return 
end
function CoreEditor:_update_mute_state(t, dt)
	if self._mute_states.wanted ~= self._mute_states.current then
		if self._mute_states.wanted then
		end

		self._mute_states.current = self._mute_states.wanted
	end

	return 
end
function CoreEditor:update_ruler(t, dt)
	if not self._ruler_points or #self._ruler_points == 0 then
		return 
	end

	local pos = self._ruler_points[1]
	slot11 = 1

	Application.draw_sphere(slot5, Application, pos, 10, 1, 1)

	slot7 = {
		sample = true,
		ray_type = "body editor",
		mask = managers.slot.get_mask(1, managers.slot)
	}
	slot11 = "all"
	local ray = self.unit_by_raycast(slot5, self)

	if not ray or not ray.position then
		return 
	end

	local len = pos - ray.position.length(slot6)
	slot13 = 1

	Application.draw_sphere(pos - ray.position, Application, ray.position, 10, 1, 1)

	slot13 = 1

	Application.draw_line(pos - ray.position, Application, pos, ray.position, 1, 1)

	slot8 = self
	slot12 = len / 100

	self.set_value_info(pos - ray.position, string.format(ray.position, "Length: %.2fm"))

	slot8 = self
	slot12 = ray.position

	self.set_value_info_pos(pos - ray.position, self.world_to_screen(ray.position, self))

	return 
end
function CoreEditor:current_orientation(offset_move_vec, unit)
	local current_pos, current_rot = nil
	slot8 = 0
	local p1 = self.get_cursor_look_point(slot6, self)
	slot8 = self

	if not self.use_surface_move(self) then
		slot9 = 100
		local p2 = self.get_cursor_look_point(slot7, self)

		if p1.z - p2.z ~= 0 then
			slot10 = self
			local t = (p1.z - self.grid_altitude(slot9)) / (p1.z - p2.z)
			local p = p1 + (p2 - p1) * t + offset_move_vec

			if t < 1000 and -1000 < t then
				slot12 = self
				local x = math.round(slot10) * self.grid_size(p.x / self.grid_size(self))
				local y = math.round(p.x / self.grid_size(self)) * self.grid_size(p.y / self.grid_size(self))
				slot16 = self
				slot14 = self
				local z = math.round(p.y / self.grid_size(self)) * self.grid_size(p.z / self.grid_size(self))
				slot16 = z
				current_pos = Vector3(p.z / self.grid_size(self), x, y)
			end
		end
	else
		local p2 = self.get_cursor_look_point(slot7, self)
		local ray = nil
		slot14 = self._surface_move_mask
		local rays = World.raycast_all(25000, World, p1, p2, nil)

		if rays then
			slot11 = rays

			for _, unit_r in ipairs(slot10) do
				if unit_r.unit ~= unit then
					slot16 = unit_r.unit

					if unit_r.unit.visible(slot15) then
						ray = unit_r

						break
					end
				end
			end
		end

		if ray then
			local p = ray.position + offset_move_vec
			slot13 = self
			local x = math.round(slot11) * self.grid_size(p.x / self.grid_size(self))
			slot16 = self
			local y = math.round(p.x / self.grid_size(self)) * self.grid_size(p.y / self.grid_size(self))
			slot16 = p.z
			current_pos = Vector3(p.y / self.grid_size(self), x, y)
			local n = ray.normal
			slot20 = 1

			Application.draw_line(x, Application, current_pos, current_pos + n * 2000, 0, 0)

			slot15 = unit

			if alive(x) then
				slot15 = unit
				local u_rot = unit.rotation(slot14)
				local z = n
				slot18 = z
				slot21 = u_rot
				local x = u_rot.x(slot16) - z * z.dot(u_rot, u_rot.x(slot20)).normalized(z * z.dot(u_rot, u_rot.x(slot20)))
				slot19 = x
				local y = z.cross(u_rot.x(slot16) - z * z.dot(u_rot, u_rot.x(slot20)), z)
				slot21 = z
				local rot = Rotation(z, x, y)
				slot20 = unit
				slot20 = unit.rotation(x)
				current_rot = rot * unit.rotation(x).inverse(x)
			end
		end
	end

	slot8 = unit

	if alive(slot7) then
		slot8 = self

		if self.use_snappoints(slot7) and current_pos then
			local r = 1100
			local pos = current_pos
			slot15 = 1

			Application.draw_sphere(slot9, Application, pos, r, 1, 0)

			slot15 = r
			local units = unit.find_units(slot9, unit, "intersect", "force_physics", "sphere", pos)
			local closest_snap = nil
			slot12 = units

			for _, unit in ipairs("intersect") do
				slot18 = "snap*"
				local aligns = unit.get_objects(slot16, unit)

				if 0 < #aligns then
					slot18 = aligns
					slot21 = unit

					table.insert(slot17, unit.orientation_object(slot20))
				end

				slot18 = aligns

				for _, o in ipairs(slot17) do
					slot23 = o
					slot23 = o.position(slot22) - pos
					local len = o.position(slot22) - pos.length(slot22)

					if len < r then
					end

					slot28 = o
					slot27 = 400

					Application.draw_rotation_size(slot23, Application, o.position(slot26), o.rotation(o))

					slot27 = o
					slot29 = 1

					Application.draw_sphere(slot23, Application, o.position(o.rotation(o)), 50, 0, 1)
				end

				slot22 = 0

				Application.draw(slot17, Application, unit, 1, 0)
			end

			if closest_snap then
				slot12 = closest_snap
				current_pos = closest_snap.position(slot11)
				slot13 = unit
				slot13 = unit.rotation(closest_snap)
				current_rot = closest_snap.rotation(slot11) * unit.rotation(closest_snap).inverse(closest_snap)
			end
		end
	end

	self._current_pos = current_pos or self._current_pos

	return current_pos, current_rot
end
function CoreEditor:draw_grid(unit)
	slot4 = managers.editor

	if not managers.editor.layer_draw_grid(slot3) then
		return 
	end

	slot6 = 0
	local rot = Rotation(slot3, 0, 0)
	slot5 = unit

	if alive(0) then
		slot6 = "Local"

		if self.is_coordinate_system(slot4, self) then
			slot5 = unit
			rot = unit.rotation(slot4)
		end
	end

	for i = -5, 5, 1 do
		slot11 = self
		slot11 = self
		local from_x = (self._current_pos + rot.x(slot9) * i * self.grid_size(rot)) - rot.y(i * self.grid_size(rot)) * 6 * self.grid_size(rot)
		slot12 = self
		slot12 = self
		local to_x = self._current_pos + rot.x(rot) * i * self.grid_size(rot) + rot.y(i * self.grid_size(rot)) * 6 * self.grid_size(rot)
		slot16 = 0

		Application.draw_line(6 * self.grid_size(rot), Application, from_x, to_x, 0, 0.5)

		slot13 = self
		slot13 = self
		local from_y = (self._current_pos + rot.y(Application) * i * self.grid_size(rot)) - rot.x(i * self.grid_size(rot)) * 6 * self.grid_size(rot)
		slot14 = self
		slot14 = self
		local to_y = self._current_pos + rot.y(rot) * i * self.grid_size(rot) + rot.x(i * self.grid_size(rot)) * 6 * self.grid_size(rot)
		slot18 = 0

		Application.draw_line(6 * self.grid_size(rot), Application, from_y, to_y, 0, 0.5)
	end

	return 
end
function CoreEditor:update_title_bar(time, rel_time)
	self._title_nr = self._title_nr or 0
	self._title_speed = self._title_speed or 30
	self._title_wait_time = self._title_wait_time or 30
	local title = self._title
	self._title_show_time = self._title_speed * 100

	if self._title_show_msg then
		self._title_show_time = self._title_speed
		title = self._title_msg
	end

	if not self._title_down then
		self._title_nr = self._title_nr + self._title_speed * rel_time
		slot7 = title

		if string.len(slot6) <= self._title_nr then
			self._title_down = true
			self._title_show_msg = not self._title_show_msg

			if self._title_show_msg then
				slot11 = self._title_messages
				self._title_msg = self._title_messages[math.ceil(math.rand(table.maxn(slot10)))]
				slot6 = self._title_msg
				self._title_nr = string.len(math.ceil(math.rand(table.maxn(slot10))))
			end
		end
	elseif self._title_down then
		self._title_nr = self._title_nr - self._title_speed * rel_time

		if self._title_nr <= -self._title_show_time then
			self._title_nr = 0
			self._title_down = false
		end
	end

	slot6 = title
	slot12 = 0
	slot15 = title
	title = string.sub(slot5, math.round(math.clamp(slot10, self._title_nr, string.len(slot14))))
	slot7 = title

	Global.frame.set_title(slot5, Global.frame)

	return 
end
function CoreEditor:get_controller()
	return self._ctrl
end
function CoreEditor:move_speed_up()
	slot5 = self._camera_controller
	local change = math.clamp(slot2, self._camera_controller.get_move_speed(slot4) * 0.2, 5)
	slot6 = self._camera_controller
	slot6 = 80000
	local m_speed = math.clamp(self._camera_controller.get_move_speed(slot4) * 0.2, self._camera_controller.get_move_speed(8000) + change, 10)
	slot6 = m_speed

	self._camera_controller.set_move_speed(self._camera_controller.get_move_speed(8000) + change, self._camera_controller)

	return 
end
function CoreEditor:move_speed_down()
	slot5 = self._camera_controller
	local change = math.clamp(slot2, self._camera_controller.get_move_speed(slot4) * 0.2, 5)
	slot6 = self._camera_controller
	slot6 = 80000
	local m_speed = math.clamp(self._camera_controller.get_move_speed(slot4) * 0.2, self._camera_controller.get_move_speed(8000) - change, 10)
	slot6 = m_speed

	self._camera_controller.set_move_speed(self._camera_controller.get_move_speed(8000) - change, self._camera_controller)

	return 
end
function CoreEditor:get_cursor_look_point(dist)
	slot4 = self._vp
	slot10 = dist
	slot5 = self.cursor_pos(slot6) + Vector3(self, 0, 0)

	return self._vp.camera(slot3).screen_to_world(slot3, self._vp.camera(slot3))
end
function CoreEditor:cursor_pos()
	slot3 = self._workspace
	local x, y = self._workspace.mouse_position(slot2)
	slot7 = 0

	return Vector3(slot4, x / self._screen_borders.x * 2 - 1, y / self._screen_borders.y * 2 - 1)
end
function CoreEditor:mouse_pos(pos)
	slot4 = self._workspace
	local x, y = self._workspace.mouse_position(slot3)
	slot8 = 0

	return Vector3(slot5, x, y)
end
function CoreEditor:screen_pos(pos)
	slot6 = 0

	return Vector3(slot3, self._screen_borders.x * (pos.x + 1) / 2, self._screen_borders.y * (pos.y + 1) / 2)
end
function CoreEditor:world_to_screen(pos)
	slot4 = self._vp
	slot5 = pos

	return self._vp.camera(slot3).world_to_screen(slot3, self._vp.camera(slot3))
end
function CoreEditor:screen_to_world(pos, dist)
	slot5 = self._vp
	slot10 = dist
	slot6 = pos + Vector3(slot7, 0, 0)

	return self._vp.camera(slot4).screen_to_world(slot4, self._vp.camera(slot4))
end
function CoreEditor:unit_by_raycast(data)
	slot8 = data.to
	local rays = self._unit_raycasts(slot3, self, data.mask, data.ray_type, data.from)

	if rays then
		slot5 = rays

		for _, ray in ipairs(slot4) do
			if data.sample then
				slot11 = ray.unit

				if self.sample_unit_ok_conditions(slot9, self) then
					return ray
				end
			else
				slot13 = data.skip_instance_check

				if self.select_unit_ok_conditions(slot9, self, ray.unit, nil) then
					return ray
				end
			end
		end
	end

	return nil
end
function CoreEditor:_unit_raycasts(mask, ray_type, from, to)
	if not from then
		slot8 = 0
		local from = self.get_cursor_look_point(slot6, self)
	end

	if not to then
		slot9 = 200000
		local to = self.get_cursor_look_point(slot7, self)
	end

	local rays = nil

	if ray_type then
		slot17 = mask
		rays = World.raycast_all(slot9, World, "ray", from, to, "ray_type", ray_type, "slot_mask")
	else
		slot14 = mask
		rays = World.raycast_all(slot9, World, from, to, nil)
	end

	return rays
end
function CoreEditor:select_unit_by_raycast(mask, ray_type, from, to)
	slot11 = to
	local rays = self._unit_raycasts(slot6, self, mask, ray_type, from)

	if rays then
		slot8 = rays

		for _, ray in ipairs(slot7) do
			slot14 = ray.unit

			if self.select_unit_ok_conditions(slot12, self) then
				return ray
			end
		end
	end

	return nil
end
function CoreEditor:select_unit_ok_conditions(unit, layer, skip_instance_check)
	if not skip_instance_check then
		slot6 = unit

		if unit.unit_data(slot5).instance then
			return false
		end
	end

	slot6 = unit

	if unit.visible(slot5) then
		slot6 = self

		if self.current_continent(slot5) then
			slot6 = unit

			if unit.unit_data(slot5).continent then
				if not layer then
					slot7 = unit
					layer = self.unit_in_layer(slot5, self)
				end

				if layer then
					slot6 = layer

					if layer.uses_continents(slot5) then
						slot7 = unit

						if self.current_continent(slot5) == unit.unit_data(self).continent then
							return true
						end
					end
				end
			end
		else
			return true
		end
	end

	return false
end
function CoreEditor:sample_unit_ok_conditions(unit, layer)
	slot5 = unit

	if unit.visible(slot4) then
		return true
	end

	return false
end
function CoreEditor:click_select_unit(layer)

	-- Decompilation error in this vicinity:
	slot4 = layer
	local is_instance_layer = layer == self._layers.Instances
	slot9 = "editor_all"
	local rays = self._unit_raycasts(slot4, self, managers.slot.get_mask("body editor", managers.slot))
	slot6 = rays

	for _, ray in ipairs(self) do
		local unit = ray.unit
		local is_instance_unit = unit.unit_data(slot11).instance
		slot16 = true

		if self.select_unit_ok_conditions(unit, self, unit, nil) then
			slot13 = self

			if self._global_select(slot12) then
				slot14 = unit

				self.select_unit(slot12, self)

				return 
			end
		end
	end

	slot7 = nil

	layer.set_select_unit(slot5, layer)

	return 
end
function CoreEditor:_global_select()
	if CoreInput.ctrl() or CoreInput.alt() then
		return false
	end

	slot3 = self

	return self.always_global_select_unit(slot2) ~= CoreInput.shift()
end
function CoreEditor:change_layer(notebook)
	local s = notebook.get_page_count(slot3)
	slot5 = notebook
	local c_page = notebook.get_current_page(notebook)

	for i = 0, s - 1, 1 do
		slot11 = i

		if notebook.get_page(slot9, notebook) == c_page then
			slot10 = self
			slot14 = i

			self.change_layer_name(slot9, notebook.get_page_text(slot12, notebook))

			break
		end
	end

	return 
end
function CoreEditor:change_layer_name(name)
	slot4 = self

	self.clear_triggers(slot3)

	if self._current_layer then
		slot4 = self._current_layer

		self._current_layer.deactivate(slot3)
	end

	self._current_layer = self._layers[name]

	if self._current_layer then
		slot5 = "Changed layer to " .. name

		self.output(slot3, self)

		slot4 = self._current_layer

		self._current_layer.activate(slot3)
	end

	slot4 = self

	self.add_triggers(slot3)

	return 
end
function CoreEditor:change_layer_notebook(name)
	slot5 = self._notebook

	for i = 0, self._notebook.get_page_count(slot4) - 1, 1 do
		slot9 = i

		if self._notebook.get_page_text(slot7, self._notebook) == name then
			slot9 = i

			self._notebook.set_page(slot7, self._notebook)
		end
	end

	return 
end
function CoreEditor:copy_incremental(dir, src_dir, rules)
	slot9 = "%Y-%m-%d_%H_%M_%S"
	dir = dir .. "\\" .. Application.date(slot7, Application)
	slot7 = dir

	SystemFS.make_dir("\\", SystemFS)

	slot9 = rules

	self._copy_files("\\", self, src_dir, dir)

	return 
end
function CoreEditor:_copy_files(src, dest, rules)
	rules = rules or {}
	local files = {}
	slot10 = src

	for _, file in ipairs(SystemFS.list(slot8, SystemFS)) do
		slot13 = {
			sub_dir = "",
			file = src .. "/" .. file
		}

		table.insert(slot11, files)
	end

	slot11 = true

	for _, sub_dir in ipairs(SystemFS.list(slot8, SystemFS, src)) do
		slot15 = src .. "/" .. sub_dir

		for _, file in ipairs(SystemFS.list(slot13, SystemFS)) do
			slot18 = {
				file = src .. "/" .. sub_dir .. "/" .. file,
				sub_dir = sub_dir .. "\\"
			}

			table.insert(slot16, files)
		end
	end

	slot7 = files

	for _, file in ipairs(slot6) do
		slot13 = file.file
		local name = managers.database.entry_name(slot11, managers.database)
		slot14 = file.file
		local type = managers.database.entry_type(managers.database, managers.database)

		if not rules.ignore or not rules.ignore[type] then
			local to = dest .. "\\" .. file.sub_dir
			slot16 = to

			if not SystemFS.exists(file.sub_dir, SystemFS) then
				slot16 = to

				SystemFS.make_dir(slot14, SystemFS)
			end

			local to = to .. name .. "." .. type
			slot18 = to
			slot14 = SystemFS.copy_file(".", SystemFS, file.file)
		end
	end

	return 
end
function CoreEditor:autosave()
	if self._lastdir and self._lastfile then
		slot7 = "autosave"

		self.save_incremental(slot2, self, self.create_temp_saves("world", self))
	end

	return 
end
function CoreEditor:save_incremental(dir, f_name)
	slot8 = "%Y-%m-%d_%H_%M_%S"
	dir = dir .. "\\" .. Application.date(slot6, Application)
	slot6 = dir

	SystemFS.make_dir("\\", SystemFS)

	local path = dir .. "\\" .. f_name .. ".world"
	local save_continents = true
	slot10 = save_continents

	self.do_save(".world", self, path, dir)

	return 
end
function CoreEditor:do_save(path, dir, save_continents)
	if not path and not dir then
		slot7 = "No path or dir specified when trying to save"

		Application.error(slot5, Application)

		return 
	end

	slot6 = managers.editor
	local errors = managers.editor.check_duplicate_names_exist(slot5)

	if errors then
		slot8 = "Duplicate names exist in the script, something is fucked up!"

		Application.error(slot6, Application)

		slot9 = errors

		managers.editor.show_text_box(slot6, managers.editor, "ERROR!")

		return 
	end

	slot7 = self
	local wrong_id_found = self._check_unit_ids_outside_continent(slot6)
	self._world_package_table = {}
	self._world_init_package_table = {}
	self._continent_package_table = {}
	self._continent_init_package_table = {}
	self._world_sound_package_table = {}
	self._world_save_table = {}
	self._continent_save_tables = {}
	self._world_save_table.world_data = {
		continents_file = "continents",
		max_id = self._max_id,
		markers = self._markers,
		values = self._values.world
	}
	slot8 = self._values

	for continent, values in pairs() do
		local t = {
			single_data_block = true,
			entry = "values",
			continent = continent,
			data = values
		}
		slot15 = t

		self.add_save_data(slot13, self)
	end

	slot8 = self._layers

	for _, layer in pairs(slot7) do
		local save_params = {
			dir = dir
		}
		slot15 = save_params

		layer.save(slot13, layer)
	end

	slot8 = self._groups

	self._groups.save(slot7)

	slot9 = path
	local f = self._open_file(slot7, self)
	slot9 = f
	slot13 = self._world_save_table

	f.puts(self, ScriptSerializer.to_generic_xml(slot11, ScriptSerializer))

	slot10 = f

	SystemFS.close(self, SystemFS)

	slot10 = dir

	self._add_files_to_package(self, self)

	slot10 = dir

	self._save_continent_files(self, self)

	slot10 = dir

	self._save_continents_file(self, self)

	slot10 = dir

	self._save_mission_file(self, self)

	slot10 = dir

	self._save_cover_ai_data(self, self)

	slot10 = dir

	self._save_packages(self, self)

	slot10 = dir

	self._save_unit_stats(self, self)

	slot10 = dir

	self._save_bundle_info_files(self, self)

	slot10 = dir

	self._recompile(self, self)

	slot10 = "Saved to " .. path

	self.output(self, self)

	slot11 = path

	cat_debug(self, "editor", "Saved to ")

	if wrong_id_found then
		slot10 = "Units with wrong IDs found, please check and finx errors."

		Application.error(slot8, Application)
	end

	return true
end
function CoreEditor:_check_unit_ids_outside_continent()
	print(slot2)

	local found = false
	slot4 = self._continents

	for name, continent in pairs("Checking for unit ids outside continent range...") do
		local base_id = continent._values.base_id
		slot13 = base_id .. "-" .. base_id + 100000

		print(slot9, "Checking continent:", name, "range:")

		slot10 = continent._unit_ids

		for id, unit in pairs(slot9) do
			local id_diff = id - base_id

			if id_diff < 0 or 100000 <= id_diff then
				slot20 = unit

				Application.error(slot15, Application, "Unit with id:", id, "is outside range. Unit:")

				found = true
			end
		end
	end

	return found
end
function CoreEditor:check_duplicate_names_exist()
	local res, found = nil
	slot6 = "[MissionManager:check_duplicate_names_exist]"

	Application.debug(slot4, Application)

	res = "YOUR LEVEL IS NOT SAVED!!!\n\n"
	res = res .. "Contintnet/Script with duplicate names is found:\n\n"
	local count_map = {}
	slot8 = managers.editor
	slot6 = managers.editor.layers(slot7).Mission._created_units

	for _, unit in pairs(Application) do
		slot11 = unit
		slot13 = unit
		local name = unit.unit_data(slot10).continent._name .. "/" .. unit.unit_data(slot12).name_id

		if not count_map[name] then
			count_map[name] = {
				unit = unit,
				count = 1
			}
		else
			count_map[name].count = count_map[name].count + 1
		end
	end

	local cnt = 0
	slot7 = count_map

	for name, unit_data in pairs(slot6) do
		if 1 < unit_data.count then
			cnt = cnt + 1
			res = res .. name .. "\n"
			found = true
		end

		if 100 < cnt then
			res = res .. "More elements with same name exists. Fix this ones, and try to resave to get new list..."

			break
		end
	end

	if found then
		return res
	end

	return 
end
function CoreEditor:_recompile(dir)
	local source_files = self._source_files(slot3, self)
	local t = {
		target_db_name = "all",
		send_idstrings = false,
		preprocessor_definitions = "preprocessor_definitions",
		verbose = false
	}
	slot8 = SystemInfo
	slot8 = SystemInfo.platform(slot7)
	t.platform = string.lower(SystemInfo.platform(slot7).s(slot7))
	slot6 = managers.database
	t.source_root = managers.database.root_path(dir) .. "/assets"
	slot6 = Application
	t.target_db_root = Application.base_path("/assets") .. "assets"
	t.source_files = source_files
	slot7 = t

	Application.data_compile("assets", Application)

	slot6 = DB

	DB.reload("assets")

	slot6 = managers.database

	managers.database.clear_all_cached_indices("assets")

	slot6 = source_files

	for _, file in ipairs("assets") do
		slot15 = file
		slot12 = managers.database.entry_type(slot13, managers.database).id(slot13)
		slot16 = file
		slot15 = managers.database.entry_path(managers.database.entry_type(slot13, managers.database), managers.database)

		PackageManager.reload(slot10, PackageManager, managers.database.entry_path(managers.database.entry_type(slot13, managers.database), managers.database).id(managers.database.entry_type(slot13, managers.database)))
	end

	return 
end
function CoreEditor:_source_files(dir)
	local files = {}
	slot6 = dir
	local entry_path = managers.database.entry_path(slot4, managers.database) .. "/"
	slot9 = dir

	for _, file in ipairs(SystemFS.list(slot7, SystemFS)) do
		slot12 = entry_path .. file

		table.insert(slot10, files)
	end

	slot10 = true

	for _, sub_dir in ipairs(SystemFS.list(slot7, SystemFS, dir)) do
		slot14 = dir .. "/" .. sub_dir

		for _, file in ipairs(SystemFS.list(slot12, SystemFS)) do
			slot17 = entry_path .. sub_dir .. "/" .. file

			table.insert(slot15, files)
		end
	end

	return files
end
function CoreEditor:add_to_world_package(params)
	local name = params.name
	local path = params.path
	local category = params.category
	local continent = params.continent

	if continent then
		slot9 = params

		if not self._check_package_duplicity(slot7, self) then
			local t = (params.init and self._continent_init_package_table) or self._continent_package_table
			slot10 = continent
			t[continent.name(slot8)] = t[continent.name(continent)] or {}
			slot9 = continent
			local package_table = t[continent.name(t[continent.name(continent)] or )]
			package_table[category] = package_table[category] or {}
			slot8 = table.contains
			slot10 = package_table[category]
			slot11 = name or path

			if not slot8(slot9, slot10) then
				slot11 = name or path

				table.insert(slot9, package_table[category])
			end

			return 
		end
	end

	t = (params.init and self._world_init_package_table) or self._world_package_table
	t[category] = t[category] or {}
	slot7 = table.contains
	slot9 = t[category]
	slot10 = name or path

	if not slot7(slot8, slot9) then
		slot10 = name or path

		table.insert(slot8, t[category])
	end

	return 
end
function CoreEditor:add_to_sound_package(params)
	local name = params.name
	local path = params.path
	local category = params.category
	local continent = params.continent
	self._world_sound_package_table[category] = self._world_sound_package_table[category] or {}
	slot6 = table.contains
	slot8 = self._world_sound_package_table[category]
	slot9 = name or path

	if not slot6(slot7, slot8) then
		slot9 = name or path

		table.insert(slot7, self._world_sound_package_table[category])
	end

	return 
end
function CoreEditor:_save_packages(dir)
	slot5 = "Level Settings"
	slot5 = "chunk_name"
	local chunk_name = managers.editor.layer(slot3, managers.editor).get_setting(slot3, managers.editor.layer(slot3, managers.editor))
	local is_not_init_chunk = chunk_name ~= "init"
	local streaming_options = {
		win32 = {
			"texture"
		},
		ps3 = {
			"texture"
		},
		x360 = {
			"texture"
		},
		ps4 = (is_not_init_chunk and {
			"texture"
		}) or {},
		xb1 = (is_not_init_chunk and {
			"texture"
		}) or {}
	}
	slot9 = "w"
	local package = SystemFS.open(slot6, SystemFS, dir .. "\\world.package")
	slot11 = streaming_options

	self._save_package(SystemFS, self, package, self._world_package_table)

	slot10 = "w"
	local init_package = SystemFS.open(SystemFS, SystemFS, dir .. "\\world_init.package")
	slot11 = self._world_init_package_table

	self._save_package(SystemFS, self, init_package)

	slot9 = self._continent_package_table

	for continent, package_table in pairs(SystemFS) do
		slot16 = "w"
		local file = SystemFS.open(slot13, SystemFS, dir .. "\\" .. continent .. "\\" .. continent .. ".package")
		slot18 = streaming_options

		self._save_package(SystemFS, self, file, package_table)
	end

	slot9 = self._continent_init_package_table

	for continent, package_table in pairs(slot8) do
		slot16 = "w"
		local file = SystemFS.open(slot13, SystemFS, dir .. "\\" .. continent .. "\\" .. continent .. "_init.package")
		slot17 = package_table

		self._save_package(SystemFS, self, file)
	end

	slot11 = "w"
	local sound_package = SystemFS.open(slot8, SystemFS, dir .. "\\world_sounds.package")
	slot12 = self._world_sound_package_table

	self._save_package(SystemFS, self, sound_package)

	return 
end
function CoreEditor:_check_package_duplicity(params)
	local name = params.name
	local path = params.path
	local category = params.category
	local continent = params.continent
	local world_package_table = (params.init and self._world_init_package_table) or self._world_package_table
	local continent_package_table = (params.init and self._continent_init_package_table) or self._continent_package_table

	if world_package_table[category] then
		slot11 = name

		if table.contains(slot9, world_package_table[category]) then
			return true
		end
	end

	local found = false
	slot11 = continent_package_table

	for c_name, package in pairs(slot10) do
		slot16 = continent

		if c_name ~= continent.name(slot15) then
			slot16 = package

			for p_category, data in pairs(slot15) do
				if p_category == category then
					slot22 = name

					if table.contains(slot20, data) then
						found = true
						slot22 = name

						table.delete(slot20, data)
					end
				end
			end
		end
	end

	return found
end
function CoreEditor:_save_package(file, package_table, streaming_options)
	slot7 = "<package>"

	file.puts(slot5, file)

	if streaming_options then
		local streaming_element = "\t<streaming"

		local function fill_platform_streaming_params(platform)
			if streaming_options[platform] then
				slot3 = streaming_options[platform]

				if next(slot2) then
					local platform_param = " " .. platform .. "=\""
					slot4 = streaming_options[platform]

					for i, asset_type in ipairs("=\"") do
						if i ~= 1 then
							platform_param = platform_param .. " "
						end

						platform_param = platform_param .. asset_type
					end

					platform_param = platform_param .. "\""
					streaming_element = streaming_element .. platform_param
				end
			end

			return 
		end

		slot8 = "win32"

		fill_platform_streaming_params(slot7)

		slot8 = "ps3"

		fill_platform_streaming_params(slot7)

		slot8 = "x360"

		fill_platform_streaming_params(slot7)

		slot8 = "xb1"

		fill_platform_streaming_params(slot7)

		slot8 = "ps4"

		fill_platform_streaming_params(slot7)

		streaming_element = streaming_element .. "/>"
		slot9 = streaming_element

		file.puts("/>", file)
	end

	slot6 = package_table

	for category, names in pairs(slot5) do
		local entry = nil

		if category == "units" then
			entry = "unit"
		elseif category == "massunits" then
			entry = "massunit"
		elseif category == "physic_effects" then
			entry = "physic_effect"
		elseif category == "fonts" then
			entry = "font"
		elseif category == "effects" then
			entry = "effect"
		elseif category == "scenes" then
			entry = "scene"
		elseif category == "soundbanks" then
			entry = "bnk"
		elseif category == "guis" then
			entry = "gui"
		elseif category == "script_data" then
			entry = ""
		end

		slot13 = "\t<" .. category .. ">"

		file.puts(slot11, file)

		if entry then
			slot12 = names

			for _, name in ipairs(slot11) do
				if category == "script_data" then
					slot18 = name
					entry = managers.database.entry_type(slot16, managers.database)
					slot18 = name
					name = managers.database.entry_path(slot16, managers.database)
				end

				slot18 = "\t\t<" .. entry .. " name=\"" .. name .. "\"/>"

				file.puts(slot16, file)
			end
		end

		slot13 = "\t</" .. category .. ">"

		file.puts(slot11, file)
	end

	slot7 = "</package>"

	file.puts(slot5, file)

	slot7 = file

	SystemFS.close(slot5, SystemFS)

	return 
end
function CoreEditor:_save_shadow_textures(dir)
	local path = dir .. "/shadow_textures.gui"
	slot7 = "w"
	local gui_file = SystemFS.open(slot4, SystemFS, path)
	slot7 = "<gui>"

	gui_file.puts(SystemFS, gui_file)

	slot7 = dir

	print(SystemFS, "dir")

	dir = dir .. "/cube_lights"
	slot7 = dir
	local files = self._source_files("/cube_lights", self)
	slot9 = files

	print(inspect(slot8))

	slot7 = files

	for _, file in ipairs(self) do
		slot13 = file
		local name = managers.database.entry_name(slot11, managers.database)
		slot14 = name
		slot18 = name

		print(managers.database, "is used", self._shadow_texture_is_used(slot16, self))

		slot14 = name

		if self._shadow_texture_is_used(managers.database, self) then
			slot18 = file
			slot14 = "\t<preload texture=\"" .. managers.database.entry_path(slot16, managers.database) .. "\"/>"

			gui_file.puts(slot12, gui_file)
		end

		slot16 = file

		print(managers.database.entry_type(slot14, managers.database))

		slot16 = file

		print(managers.database.entry_name(slot14, managers.database))

		slot16 = file

		print(managers.database.entry_path(slot14, managers.database))
	end

	slot8 = "</gui>"

	gui_file.puts(slot6, gui_file)

	slot8 = gui_file

	SystemFS.close(slot6, SystemFS)

	slot8 = path
	slot12 = path

	print(slot6, "managers.database:entry_relative_path( path )", managers.database.entry_relative_path(slot10, managers.database))

	slot8 = {
		category = "guis",
		path = managers.database.entry_path(slot10, managers.database)
	}
	slot12 = path

	managers.editor.add_to_world_package(slot6, managers.editor)

	return 
end
function CoreEditor:_shadow_texture_is_used(name_id)
	slot4 = self._continents

	for _, continent in pairs(slot3) do
		slot10 = name_id

		if continent._unit_ids[tonumber(slot9)] then
			return true
		end
	end

	return false
end
function CoreEditor:_add_files_to_package(dir)
	local types = {
		"world_setting"
	}
	slot6 = dir
	local files = self._source_files(slot4, self)
	slot6 = files

	for _, file in ipairs(self) do
		slot11 = types

		for _, type in ipairs(slot10) do
			slot17 = file

			if type == managers.database.entry_type(slot15, managers.database) then
				slot17 = {
					category = "script_data",
					name = file
				}

				self.add_to_world_package(slot15, self)
			end
		end
	end

	return 
end
function CoreEditor:_save_continent_files(dir)
	local layer_files = {
		mission_scripts = "mission",
		mission = "mission"
	}
	slot5 = self._continent_save_tables

	for continent, data in pairs(slot4) do
		local files = {
			continent = {},
			mission = {}
		}
		slot11 = data

		for save_name, save_data in pairs(slot10) do
			if layer_files[save_name] then
				files[layer_files[save_name]][save_name] = save_data
			else
				files.continent[save_name] = save_data
			end
		end

		local continent_dir = dir .. "/" .. continent .. "/"
		slot13 = continent_dir

		self._make_dir(continent, self)

		local f = self._open_file(continent, self, continent_dir .. continent .. ".continent", self._continents[continent])
		slot13 = f
		slot17 = files.continent

		f.puts(self, ScriptSerializer.to_generic_xml(true, ScriptSerializer))

		slot14 = f

		SystemFS.close(self, SystemFS)

		slot17 = true
		local f = self._open_file(self, self, continent_dir .. "mission" .. ".continent", self._continents[continent], true)
		slot14 = f
		slot18 = files.mission

		f.puts(self, ScriptSerializer.to_generic_xml(true, ScriptSerializer))

		slot15 = f

		SystemFS.close(self, SystemFS)

		slot15 = {
			path = continent_dir .. continent .. ".mission",
			dir = continent_dir,
			name = continent,
			continent = self._continents[continent]
		}

		self._save_continent_mission_file(self, self)
	end

	return 
end
function CoreEditor:_save_continent_mission_file(params)
	local file = self._open_file(slot3, self, params.path, params.continent)
	slot5 = file
	slot8 = ScriptSerializer
	slot12 = params

	file.puts(self, ScriptSerializer.to_generic_xml(true, self._layers[self._mission_layer_name].save_mission(self._mission_layer_name, self._layers[self._mission_layer_name])))

	slot6 = file

	SystemFS.close(self, SystemFS)

	return 
end
function CoreEditor:_save_continents_file(dir)
	local continents = {}
	slot5 = self._continents

	for name, continent in pairs(slot4) do
		slot10 = continent
		continents[name] = continent.values(slot9)
	end

	slot6 = dir .. "\\continents.continents"
	local file = self._open_file(slot4, self)
	slot6 = file
	slot10 = continents

	file.puts(self, ScriptSerializer.to_generic_xml(slot8, ScriptSerializer))

	slot7 = file

	SystemFS.close(self, SystemFS)

	return 
end
function CoreEditor:_save_mission_file(dir)
	local t = {}
	slot5 = self._continents

	for name, continent in pairs(slot4) do
		t[name] = {
			file = name .. "/" .. name
		}
	end

	slot6 = dir .. "\\mission.mission"
	local mission = self._open_file(slot4, self)
	slot6 = mission
	slot10 = t

	mission.puts(self, ScriptSerializer.to_generic_xml(slot8, ScriptSerializer))

	slot7 = mission

	SystemFS.close(self, SystemFS)

	return 
end
function CoreEditor:_save_nav_manager_data(dir)
	slot5 = dir .. "\\nav_manager_data.nav_data"
	local nav_data = self._open_file(slot3, self)
	local t = managers.navigation.get_save_data(self)
	slot7 = t

	nav_data.puts(managers.navigation, nav_data)

	slot7 = nav_data

	SystemFS.close(managers.navigation, SystemFS)

	return 
end
function CoreEditor:_save_cover_ai_data(dir)
	slot9 = "cover"
	local all_cover_units = World.find_units_quick(slot3, World, managers.slot.get_mask(slot7, managers.slot))
	local covers = {
		positions = {},
		rotations = {}
	}
	slot6 = all_cover_units

	for i, unit in pairs("all") do
		local pos = Vector3()
		slot13 = pos

		unit.m_position(slot11, unit)
		mvector3.set_static(slot11, pos, math.round(math.round(pos.x)), math.round(pos.y))

		slot13 = pos

		table.insert(slot11, covers.positions)

		local rot = unit.rotation(slot11)
		slot13 = covers.rotations
		slot18 = rot

		table.insert(unit, math.round(rot.yaw(pos.z)))
	end

	slot7 = dir .. "\\cover_data.cover_data"
	local cover_ai_data = self._open_file(slot5, self)
	slot7 = cover_ai_data
	slot11 = covers

	cover_ai_data.puts(self, ScriptSerializer.to_generic_xml(slot9, ScriptSerializer))

	slot8 = cover_ai_data

	SystemFS.close(self, SystemFS)

	return 
end
function CoreEditor:_open_file(path, continent, init, skip_package)
	if not skip_package then
		slot8 = {
			category = "script_data",
			path = managers.database.entry_relative_path(slot10, managers.database),
			continent = continent,
			init = init
		}
		slot12 = path

		managers.editor.add_to_world_package(slot6, managers.editor)
	end

	slot9 = "w"

	return SystemFS.open(slot6, SystemFS, path)
end
function CoreEditor:_make_dir(dir)
	slot5 = dir

	if not SystemFS.exists(slot3, SystemFS) then
		slot5 = dir

		SystemFS.make_dir(slot3, SystemFS)
	end

	return 
end
function CoreEditor:add_save_data(values)
	if values.continent then
		self._continent_save_tables[values.continent] = self._continent_save_tables[values.continent] or {}
		self._continent_save_tables[values.continent][values.entry] = self._continent_save_tables[values.continent][values.entry] or {}

		if values.single_data_block then
			self._continent_save_tables[values.continent][values.entry] = values.data
		else
			slot5 = values.data

			table.insert(slot3, self._continent_save_tables[values.continent][values.entry])
		end
	else
		self._world_save_table[values.entry] = self._world_save_table[values.entry] or {}

		if values.single_data_block then
			self._world_save_table[values.entry] = values.data
		else
			slot5 = values.data

			table.insert(slot3, self._world_save_table[values.entry])
		end
	end

	return 
end
function CoreEditor:_save_unit_stats(dir)
	local unit_stats = SystemFS.open(slot3, SystemFS, dir .. "\\unit_stats.unit_stats")
	slot5 = self
	local data, total = self.get_unit_stats(SystemFS)
	slot8 = "Name,Amount,Geometry Memory,Models,Bodies,Slot,Mass,Textures,Materials,Vertices/Triangles,Instanced,Author,Unit Filename,Object filename,Diesel Filename,Material Filename,Last Exported From"

	unit_stats.puts("w", unit_stats)

	slot7 = data

	for name, t in pairs("w") do
		slot35 = t.instanced
		slot13 = name .. "," .. t.amount .. "," .. t.memory .. "," .. t.models .. "," .. t.nr_bodies .. "," .. t.slot .. "," .. t.mass .. "," .. t.nr_textures .. "," .. t.nr_materials .. "," .. t.vertices_per_tris .. "," .. tostring(slot34) .. "," .. t.author .. "," .. t.unit_filename .. "," .. t.model_filename .. "," .. t.diesel_filename .. "," .. t.material_filename .. "," .. t.last_exported_from

		unit_stats.puts(slot11, unit_stats)
	end

	slot8 = ""

	unit_stats.puts(slot6, unit_stats)

	slot8 = "Total," .. total.amount .. "," .. total.geometry_memory

	unit_stats.puts(slot6, unit_stats)

	slot8 = unit_stats

	SystemFS.close(slot6, SystemFS)

	return 
end
function CoreEditor:_save_bundle_info_files(dir)
	slot6 = "w"
	local file = SystemFS.open(slot3, SystemFS, dir .. "\\cube_lights.bundle_info")
	slot6 = dir
	local world_path = managers.database.entry_relative_path(SystemFS, managers.database)
	slot7 = dir .. "\\cube_lights"
	local cubelights_path = managers.database.entry_relative_path(managers.database, managers.database)
	local instances_paths = self._get_instances_paths(managers.database)
	slot9 = "<bundle_info>"

	file.puts(self, file)

	slot9 = "\t<!-- Level Packages -->"

	file.puts(self, file)

	slot9 = "\t<include_package folder=\"" .. world_path .. "\"/>"

	file.puts(self, file)

	slot9 = "\n\t<!-- Instances -->"

	file.puts(self, file)

	slot8 = instances_paths

	for instance_path, _ in pairs(self) do
		slot14 = "\t<include_package folder=\"" .. instance_path .. "\"/>"

		file.puts(slot12, file)

		slot14 = "\t<include_bundle_info folder=\"" .. instance_path .. "\"/>"

		file.puts(slot12, file)
	end

	slot9 = "\n\t<!-- Cube Lights -->"

	file.puts(slot7, file)

	slot9 = "\t<include folder=\"" .. cubelights_path .. "\"/>"

	file.puts(slot7, file)

	slot9 = "</bundle_info>"

	file.puts(slot7, file)

	slot9 = file

	SystemFS.close(slot7, SystemFS)

	return 
end
function CoreEditor:_get_instances_paths()
	local all_instance_paths = {}
	slot6 = managers.world_instance

	for _, instance_data in ipairs(managers.world_instance.instance_data(slot5)) do
		all_instance_paths[instance_data.folder] = true
	end

	return all_instance_paths
end
function CoreEditor:get_unit_stats_from_layers()
	local units = {}
	slot4 = self._layers

	for name, layer in pairs(slot3) do
		if name ~= "Mission" and name ~= "Ai" and name ~= "Environment" and name ~= "Portals" and name ~= "Sound" then
			slot11 = layer

			for _, unit in ipairs(layer.created_units(slot10)) do
				slot15 = unit

				if not self._unit_only_in_editor(slot13, self) then
					slot15 = unit

					table.insert(slot13, units)
				end
			end
		end
	end

	slot5 = units

	return self.get_unit_stats(slot3, self)
end
function CoreEditor:get_unit_stats(units)
	if not units then
		slot5 = "all"
		units = World.find_units_quick(slot3, World)
	end

	local data = {}
	local total = {
		amount = 0,
		geometry_memory = 0
	}
	slot6 = units

	for _, u in ipairs(slot5) do
		total.amount = total.amount + 1
		slot11 = u
		slot11 = u.name(slot10)

		if data[u.name(slot10).s(slot10)] then
			slot11 = u
			slot12 = u
			slot12 = u.name(u.name(slot10))
			data[u.name(slot10).s(slot10)].amount = data[u.name(u.name(slot10)).s(u.name(slot10))].amount + 1
		else
			slot12 = u
			local t = self.get_unit_stat(slot10, self)
			t.amount = 1
			slot12 = u
			slot12 = u.name(self)
			data[u.name(self).s(self)] = t
			total.geometry_memory = total.geometry_memory + t.memory
		end
	end

	return data, total
end
function CoreEditor:get_unit_stat(u)
	local t = {}
	slot5 = u
	t.memory = u.geometry_memory_use(slot4)
	slot5 = u
	t.models = u.nr_models(slot4)
	slot5 = u
	slot5 = u.author(slot4)
	t.author = u.author(slot4).s(slot4)
	slot5 = u
	t.nr_bodies = u.num_bodies(slot4)
	slot5 = u
	t.slot = u.slot(slot4)
	slot5 = "%.4f"
	slot8 = u
	t.mass = string.format(slot4, u.mass(slot7))
	slot5 = u
	t.nr_textures = #u.used_texture_names(slot4)
	slot5 = u
	slot8 = "material"
	t.nr_materials = #u.get_objects_by_type(slot4, Idstring(slot7))
	slot6 = u
	t.vertices_per_tris = self.vertices_per_tris(slot4, self)
	slot6 = u
	t.instanced = self._is_instanced(slot4, self)
	slot5 = u
	t.unit_filename = u.unit_filename(slot4)
	slot5 = u
	t.model_filename = u.model_filename(slot4)
	slot5 = u
	t.diesel_filename = u.diesel_filename(slot4)
	slot5 = u
	slot5 = u.material_config(slot4)
	t.material_filename = u.material_config(slot4).s(slot4)
	slot5 = u
	t.last_exported_from = u.last_export_source(slot4)

	return t
end
function CoreEditor:_unit_only_in_editor(u)
	slot4 = u

	if u.unit_data(slot3) then
		slot4 = u
		slot2 = u.unit_data(slot3).only_exists_in_editor
	end

	return slot2
end
function CoreEditor:vertices_per_tris(u)
	local vertices = 0
	local tris = 0
	slot7 = u

	for i = 0, u.nr_models(slot6) - 1, 1 do
		slot11 = i
		vertices = vertices + u.vertex_count(slot9, u)
		slot11 = i
		tris = tris + u.triangle_count(slot9, u)
	end

	if tris == 0 then
		return 0
	end

	slot7 = vertices / tris

	return string.format(slot5, "%.4f")
end
function CoreEditor:model_vertices(u, prefix)
	local vertices = 0
	slot8 = u
	slot11 = "model"

	for i, model in ipairs(u.get_objects_by_type(slot7, Idstring(slot10))) do
		slot13 = model
		slot13 = model.name(prefix)

		if string.match(slot10, model.name(prefix).s(prefix)) then
			slot12 = i - 1
			vertices = vertices + u.vertex_count(slot10, u)
		end
	end

	slot7 = vertices

	return string.format(slot5, "%.4f")
end
function CoreEditor:_is_instanced(u)
	slot5 = u

	for i = 0, u.nr_models(slot4) - 1, 1 do
		slot9 = i

		if u.is_model_instance(slot7, u) then
			return true
		end
	end

	return false
end
function CoreEditor:load_level(dir, path)
	slot6 = "Open file " .. path

	self.output(slot4, self)

	slot10 = "PD_AUTO_HIDE,PD_SMOOTH,PD_ESTIMATED_TIME,PD_REMAINING_TIME"
	self._load_progress = EWS.ProgressDialog(slot4, EWS, Global.frame_panel, "Loading..", "Parsing world file", 100)
	slot6 = {
		file_type = "world",
		file_path = managers.database.entry_path("Parsing world file", managers.database)
	}
	slot10 = path
	self._world_holder = WorldHolder.new(slot4, WorldHolder)
	slot5 = self._world_holder
	local status = self._world_holder.status(slot4)

	if status == "ok" then
		slot8 = dir

		self.set_open_file_and_dir(slot5, self, path)

		slot6 = self

		self.do_load(slot5)

		slot8 = dir

		self.save_editor_settings(slot5, self, path)
	elseif status == "missing" then
		local msg = "Can't open world file:\n\n" .. path .. "\n\nPath is invalid."
		slot11 = "OK,ICON_ERROR"
		slot16 = 0

		EWS.message_box("\n\nPath is invalid.", EWS, Global.frame_panel, msg, self._editor_name, Vector3(slot13, -1, -1))

		slot8 = msg

		self.output("\n\nPath is invalid.", self)
	else
		slot7 = "Wrong file format!"

		self.output(slot5, self)
	end

	slot7 = 100

	self.update_load_progress(slot5, self)

	slot6 = self._load_progress

	self._load_progress.destroy(slot5)

	return 
end
function CoreEditor:do_load()
	self._loading = true
	slot3 = self

	self.clear_all(slot2)

	slot5 = 0
	local offset = Vector3(slot2, 0, 0)
	slot6 = offset

	self.load_markers(0, self, self._world_holder)

	slot6 = offset

	self.load_continents(0, self, self._world_holder)

	slot6 = offset

	self.load_values(0, self, self._world_holder)

	local progress_i = 50
	local layers_amount = table.size(self)
	slot6 = self._layer_load_order

	for _, name in ipairs(self._layers) do
		local layer = self._layers[name]
		progress_i = progress_i + 50 / layers_amount
		slot14 = "Create Layer: " .. name

		self.update_load_progress(slot11, self, progress_i)

		slot14 = offset

		layer.load(slot11, layer, self._world_holder)
	end

	slot6 = self._layers

	for name, layer in pairs(slot5) do
		slot11 = layer

		layer.post_load(slot10)
	end

	slot8 = offset

	self._groups.load(slot5, self._groups, self._world_holder)

	slot6 = self._continents

	for _, continent in pairs(slot5) do
		slot12 = false

		continent.set_need_saving(slot10, continent)
	end

	slot6 = self

	self._reset_dialogs(slot5)

	slot6 = self

	self._recreate_dialogs(slot5)

	slot6 = self._layer_replace_dialogs

	for name, dialog in pairs(slot5) do
		slot11 = dialog

		dialog.reset(slot10)
	end

	self._loading = false

	return 
end
function CoreEditor:loading()
	return self._loading
end
function CoreEditor:clear_all()
	if self._reset_camera_on_new and self._camera_controller then
		slot3 = self._camera_controller
		slot8 = 0

		self._camera_controller.set_camera_pos(slot2, Vector3(slot5, 0, 0))

		slot3 = self._camera_controller

		self._camera_controller.set_camera_rot(slot2, Rotation())
	end

	self._continents = {}
	slot3 = self._continents_panel

	self._continents_panel.destroy_all_continents(slot2)

	slot5 = {}

	self.create_continent(slot2, self, "world")

	slot4 = nil

	self.set_simulation_world_setting_path(slot2, self)

	slot3 = self._layers

	for _, layer in pairs(slot2) do
		slot8 = layer

		layer.clear(slot7)
	end

	slot3 = self

	self.clear_markers(slot2)

	slot3 = self

	self.has_editables(slot2)

	slot3 = self

	self._clear_values(slot2)

	slot3 = self

	self._recreate_dialogs(slot2)

	return 
end
function CoreEditor:load_markers(world_holder, offset)
	slot8 = offset
	local markers = world_holder.create_world(slot4, world_holder, "world", "markers")
	slot6 = markers

	for _, marker in pairs(world_holder) do
		local n = marker._name
		local p = marker._pos
		local r = marker._rot
		slot17 = r

		self.create_marker(slot13, self, n, p)

		slot15 = n

		self._ews_markers.append(slot13, self._ews_markers)
	end

	return 
end
function CoreEditor:load_values(world_holder, offset)
	slot8 = offset
	local values = world_holder.create_world(slot4, world_holder, "world", "values")

	if not values.world then
		return 
	end

	slot6 = values
	self._values = clone(slot5)

	return 
end
function CoreEditor:load_continents(world_holder, offset)
	slot8 = offset
	local continents = world_holder.create_world(slot4, world_holder, "world", "continents")
	slot6 = continents

	for name, data in pairs(world_holder) do
		slot13 = data
		slot9 = self.create_continent(slot10, self, name)
	end

	slot7 = "world"

	self.set_continent(slot5, self)

	return 
end
function CoreEditor:invert_move_shift()
	return self._invert_move_shift
end
function CoreEditor:always_global_select_unit()
	return self._always_global_select_unit
end
function CoreEditor:dialogs_stay_on_top()
	return self._dialogs_stay_on_top
end
function CoreEditor:add_unit_edit_page(name)
	if not self._dialogs.edit_unit then
		slot6 = "EditUnitDialog"

		self.show_dialog(slot3, self, "edit_unit")
	end

	slot5 = name

	return self._dialogs.edit_unit.add_page(slot3, self._dialogs.edit_unit)
end
function CoreEditor:toggle_edit_unit_dialog()
	if self._dialogs.edit_unit then
		slot3 = self._dialogs.edit_unit
	else
		slot5 = "EditUnitDialog"

		self.show_dialog(slot2, self, "edit_unit")
	end

	return 
end
function CoreEditor:has_editables(unit, units)
	if self._dialogs.edit_unit then
		slot7 = units

		self._dialogs.edit_unit.set_enabled(slot4, self._dialogs.edit_unit, unit)
	end

	slot7 = units
	local enable = self.check_has_editables(slot4, self, unit)
	slot6 = self
	local is_any_visible = self.is_any_editable_visible(self)

	if not enable or not is_any_visible then
		slot8 = false

		self._edit_panel.set_visible(slot6, self._edit_panel)

		slot8 = true

		self._info_frame.set_visible(slot6, self._info_frame)
	end

	slot7 = self._edit_panel

	self._edit_panel.layout(slot6)

	slot7 = self._lower_panel

	self._lower_panel.layout(slot6)

	return 
end
function CoreEditor:check_has_editables(unit, units)
	return false
end
function CoreEditor:is_any_editable_visible()
	return false
end
function CoreEditor:category_name(n)
	slot6 = " "
	n = string.gsub(slot3, n, "_")
	slot8 = 1
	n = string.upper(string.sub("_", n, 1)) .. string.sub(string.sub, n)
	local s = ""
	local toupper = false
	slot7 = n

	for i = 1, string.len(2), 1 do
		if toupper then
			toupper = false
			slot15 = i
			s = s .. string.upper(string.sub(slot12, n, i))
		else
			slot13 = i
			s = s .. string.sub(slot10, n, i)
		end

		slot12 = i

		if string.sub(slot9, n, i) == " " then
			toupper = true
		end
	end

	return s
end
function CoreEditor:selected_unit()
	if self._current_layer then
		slot3 = self._current_layer

		if self._current_layer.selected_unit(slot2) then
			slot3 = self._current_layer

			return self._current_layer.selected_unit(slot2)
		end
	end

	return 
end
function CoreEditor:current_selected_units()
	if self._current_layer then
		slot3 = self._current_layer

		if self._current_layer.selected_units(slot2) then
			slot3 = self._current_layer

			return self._current_layer.selected_units(slot2)
		end
	end

	return 
end
function CoreEditor:select_units(units)
	local id = Profiler.start(slot3, Profiler)
	local layers = {}
	slot6 = units

	for _, unit in ipairs("select_units") do
		slot12 = unit
		local layer = self.unit_in_layer(slot10, self)

		if layer then
			if layers[layer] then
				slot13 = unit

				table.insert(slot11, layers[layer])
			else
				layers[layer] = {
					unit
				}
			end
		end
	end

	slot6 = layers

	for layer, units in pairs(slot5) do
		slot12 = units

		layer.set_selected_units(slot10, layer)
	end

	slot7 = id

	Profiler.stop(slot5, Profiler)

	slot7 = "select_units"

	Profiler.counter_time(slot5, Profiler)

	return 
end
function CoreEditor:select_group(group)
	slot5 = group

	self._current_layer.select_group(slot3, self._current_layer)

	return 
end
function CoreEditor:center_view_on_unit(unit)
	slot4 = unit

	if alive(slot3) then
		slot11 = 1
		local rot = Rotation.look_at(slot3, Rotation, managers.editor.camera_position(unit.position(managers.editor)), Vector3(unit, 0, 0))
		slot7 = unit
		local pos = unit.position(Rotation) - rot.y(unit) * unit.bounding_sphere_radius(rot) * 2
		slot8 = rot

		managers.editor.set_camera(unit.bounding_sphere_radius(rot), managers.editor, pos)
	end

	return 
end
function CoreEditor:look_towards_unit(unit)
	slot4 = unit

	if alive(slot3) then
		slot11 = 1
		local rot = Rotation.look_at(slot3, Rotation, managers.editor.camera_position(unit.position(managers.editor)), Vector3(unit, 0, 0))
		slot6 = rot

		self._camera_controller.set_camera_rot(Rotation, self._camera_controller)
	end

	return 
end
function CoreEditor:change_layer_based_on_unit(unit)
	if not unit then
		return 
	end

	slot6 = unit
	slot6 = unit.name(slot5)
	local ud = CoreEngineAccess._editor_unit_data(unit.name(slot5).id(slot5))
	slot5 = self._layers

	for layer_name, layer in pairs(unit.name(slot5).id) do
		slot12 = layer

		for _, u_type in ipairs(layer.unit_types(slot11)) do
			slot15 = ud
			slot15 = ud.type(slot14)

			if ud.type(slot14).s(slot14) == u_type then
				slot16 = self._notebook

				for i = 0, self._notebook.get_page_count(slot15) - 1, 1 do
					slot20 = i

					if self._notebook.get_page_text(slot18, self._notebook) == layer_name then
						slot20 = i

						self._notebook.set_page(slot18, self._notebook)
					end
				end
			end
		end
	end

	return 
end
function CoreEditor:unit_in_layer(unit)
	slot4 = self._layers

	for _, layer in pairs(slot3) do
		slot9 = unit

		if not unit.unit_data(slot8) then
			slot11 = unit

			Application.error(slot8, Application, "[CoreEditor:unit_in_layer] Unit without unit data!")

			return 
		end

		slot10 = unit

		if layer.created_units_pairs(slot8)[unit.unit_data(layer).unit_id] then
			return layer
		end
	end

	return 
end
function CoreEditor:unit_in_layer_name(unit)
	slot4 = self._layers

	for name, layer in pairs(slot3) do
		slot11 = layer

		if table.contains(slot8, layer.created_units(unit)) then
			return name
		end
	end

	return nil
end
function CoreEditor:delete_unit(unit)
	slot5 = unit
	slot5 = unit

	self.unit_in_layer(slot3, self).delete_unit(slot3, self.unit_in_layer(slot3, self))

	return 
end
function CoreEditor:delete_selected_unit()
	if self._current_layer then
		slot3 = self._current_layer
		slot6 = self._current_layer

		self._current_layer.delete_unit(slot2, self._current_layer.selected_unit(slot5))
	end

	return 
end
function CoreEditor:unit_with_id(id)
	slot4 = self._layers

	for _, layer in pairs(slot3) do
		slot9 = layer

		if layer.created_units_pairs(slot8)[id] then
			slot9 = layer

			return layer.created_units_pairs(slot8)[id]
		end
	end

	return 
end
function CoreEditor:mission_element_panel()
	slot3 = self._layers[self._mission_layer_name]

	return self._layers[self._mission_layer_name].missionelement_panel(self._mission_layer_name)
end
function CoreEditor:hub_element_panel()
	slot4 = "CoreEditor:hub_element_panel is deprecated, use CoreEditor:mission_element_panel instead."

	Application.stack_dump_error(slot2, Application)

	slot3 = self

	return self.mission_element_panel(slot2)
end
function CoreEditor:mission_element_sizer()
	slot3 = self._layers[self._mission_layer_name]

	return self._layers[self._mission_layer_name].missionelement_sizer(self._mission_layer_name)
end
function CoreEditor:hub_element_sizer()
	slot4 = "CoreEditor:hub_element_sizer is deprecated, use CoreEditor:mission_element_sizer instead."

	Application.stack_dump_error(slot2, Application)

	slot3 = self

	return self.mission_element_sizer(slot2)
end
function CoreEditor:create_continent(name, values)
	if self._continents[name] then
		slot6 = values

		self._continents[name].load_values(slot4, self._continents[name])

		slot6 = self._continents[name]

		self._continents_panel.update_continent_panel(slot4, self._continents_panel)

		return self._continents[name]
	end

	if not values.base_id then
		slot5 = self
		slot3 = self._new_base_id(slot4)
	end

	values.base_id = slot3
	slot8 = values
	self._continents[name] = CoreEditorContinent.new(slot5, CoreEditorContinent, name)
	local continent = self._continents[name]
	slot7 = {
		visible = continent.value(slot9, continent),
		locked = continent.value(slot9, continent),
		enabled_in_simulation = continent.value(slot9, continent),
		editor_only = continent.value(slot9, continent),
		continent = continent
	}
	slot11 = "visible"
	slot11 = "locked"
	slot11 = "enabled_in_simulation"
	slot11 = "editor_only"

	self._continents_panel.add_continent(slot5, self._continents_panel)

	slot7 = name

	self.set_continent(slot5, self)

	self._values[name] = {
		workviews = {}
	}
	slot6 = self

	self._recreate_dialogs()

	return self._continents[name]
end
function CoreEditor:_new_base_id()
	local i = 100000
	slot5 = i

	while not self._base_id_availible(slot3, self) do
		i = i + 100000
	end

	return i
end
function CoreEditor:_base_id_availible(id)
	slot4 = self._continents

	for _, continent in pairs(slot3) do
		slot10 = "base_id"

		if continent.value(slot8, continent) == id then
			return false
		end
	end

	return true
end
function CoreEditor:delete_continent(name)
	local continent = (name and self._continents[name]) or self._current_continent

	if not continent then
		return 
	end

	if not name then
		slot5 = continent
		name = continent.name(slot4)
	end

	if name == "world" then
		slot9 = "OK,ICON_INFORMATION"
		slot14 = 0

		EWS.message_box(slot4, EWS, Global.frame_panel, "Continent " .. name .. " can currently not be deleted", "Continent", Vector3(slot11, -1, -1))

		return 
	end

	slot9 = "YES_NO,ICON_QUESTION"
	slot14 = 0
	local confirm = EWS.message_box(slot4, EWS, Global.frame_panel, "Delete continent " .. name .. "? This will delete all units in the continent.", "Continent", Vector3(slot11, -1, -1))

	if confirm == "NO" then
		return 
	end

	slot6 = continent

	continent.delete(slot5)

	slot7 = continent

	self._continents_panel.destroy_continent(slot5, self._continents_panel)

	if continent == self._current_continent then
		slot7 = "world"

		self.set_continent(slot5, self)
	end

	self._continents[name] = nil
	slot6 = self

	self._recreate_dialogs(nil)

	return 
end
function CoreEditor:set_continent(name)
	local changed = not self._current_continent or self._current_continent ~= self._continents[name]
	self._current_continent = self._continents[name]
	slot6 = self._current_continent

	self._continents_panel.set_continent(slot4, self._continents_panel)

	if not changed then
		return 
	end

	slot5 = self._layers

	for _, layer in pairs(slot4) do
		slot10 = layer

		if layer.uses_continents(slot9) then
			slot10 = layer

			layer.clear_selected_units(slot9)
		end

		slot10 = layer

		layer.on_continent_changed(slot9)
	end

	return 
end
function CoreEditor:current_continent()
	return self._current_continent
end
function CoreEditor:current_continent_name()
	slot3 = self

	if self.current_continent(slot2) then
		slot3 = self
		slot3 = self.current_continent(slot2)
		slot1 = self.current_continent(slot2).name(slot2)
	end

	return slot1
end
function CoreEditor:continents()
	return self._continents
end
function CoreEditor:continent(name)
	return self._continents[name]
end
function CoreEditor:add_unit_to_continent(name, unit)
	slot6 = unit

	self._continents[name].add_unit(slot4, self._continents[name])

	return 
end
function CoreEditor:change_continent_for_unit(unit, continent)
	slot5 = unit
	slot6 = unit

	unit.unit_data(slot4).continent.remove_unit(slot4, unit.unit_data(slot4).continent)

	slot6 = unit

	continent.add_unit(slot4, continent)

	return 
end
function CoreEditor:change_continent_by_unit()
	slot4 = {
		sample = true,
		ray_type = "body editor",
		mask = managers.slot.get_mask(slot6, managers.slot)
	}
	slot8 = "all"
	local ray = self.unit_by_raycast(slot2, self)

	if ray and ray.unit then
		slot4 = ray.unit

		if ray.unit.unit_data(slot3).continent then
			slot4 = self
			slot7 = ray.unit
			slot7 = ray.unit.unit_data(slot6).continent

			self.set_continent(slot3, ray.unit.unit_data(slot6).continent.name(slot6))
		end
	end

	return 
end
function CoreEditor:simulation_world_setting_path()
	return self._simulation_world_setting_path
end
function CoreEditor:set_simulation_world_setting_path(path)
	if path then
		slot6 = path

		if not DB.has(slot3, DB, "world_setting") then
			slot8 = "OK,ICON_ERROR"
			slot13 = 0
			local confirm = EWS.message_box(slot3, EWS, Global.frame_panel, "Can't set simulation world setting path to " .. path, "Continent", Vector3(slot10, -1, -1))

			return 
		end
	end

	self._simulation_world_setting_path = path
	slot5 = self._simulation_world_setting_path

	self._continents_panel.set_world_setting_path(slot3, self._continents_panel)

	return 
end
function CoreEditor:parse_simulation_world_setting_path(path)
	slot9 = path
	local settings = SystemFS.parse_xml(slot3, managers.database.entry_expanded_path(slot6, managers.database, "world_setting"))
	slot5 = settings

	if settings.name(SystemFS) == "settings" then
		local t = {}
		slot6 = settings

		for continent in settings.children(slot5) do
			slot11 = "name"
			slot14 = "exclude"
			t[continent.parameter(slot9, continent)] = toboolean(continent.parameter(slot12, continent))
		end

		return t
	else
		slot6 = "world_setting".id(slot7)
		slot9 = path

		return PackageManager.editor_load_script_data(slot4, PackageManager, path.id("world_setting"))
	end

	return 
end
function CoreEditor:values(continent)
	return (continent and self._values[continent]) or self._values
end
function CoreEditor:add_workview(name)
	slot4 = self
	local continent = self.current_continent_name(slot3)
	slot7 = self
	slot7 = self.camera(slot6)
	slot7 = self
	slot7 = self.camera(slot6)
	self._values[continent].workviews[name] = {
		text = "",
		position = self.camera(slot6).position(slot6),
		rotation = self.camera(slot6).rotation(slot6)
	}

	if self._dialogs.workview_by_name then
		slot5 = self._dialogs.workview_by_name

		self._dialogs.workview_by_name.workview_added(slot4)
	end

	return 
end
function CoreEditor:goto_workview(view)
	slot6 = view.rotation

	self.set_camera(slot3, self, view.position)

	return 
end
function CoreEditor:delete_workview(continent, view_name)
	self._values[continent].workviews[view_name] = nil

	return 
end
function CoreEditor:set_ruler_points()
	if not shift() then
		return 
	end

	if not self._ruler_points then
		self._ruler_points = {}
	end

	slot4 = {
		sample = true,
		ray_type = "body editor",
		mask = managers.slot.get_mask(slot6, managers.slot)
	}
	slot8 = "all"
	local ray = self.unit_by_raycast(slot2, self)

	if not ray or not ray.position then
		return 
	end

	if #self._ruler_points == 0 then
		slot5 = ray.position

		table.insert(slot3, self._ruler_points)

		slot5 = true

		self.set_value_info_visibility(slot3, self)
	else
		slot5 = false

		self.set_value_info_visibility(slot3, self)

		self._ruler_points = {}
	end

	return 
end
function CoreEditor:add_special_unit(unit, for_layer)
	slot6 = unit
	self._special_units[unit.key(slot5)] = for_layer

	return 
end
function CoreEditor:dump_mesh(...)
	CoreEditorUtils.dump_mesh(...)

	return 
end
function CoreEditor:dump_all(...)
	CoreEditorUtils.dump_all(...)

	return 
end
function CoreEditor:destroy()
	if self._editor_data.virtual_controller then
		slot4 = self._editor_data.virtual_controller

		Input.destroy_virtual_controller(slot2, Input)
	end

	if self._ctrl then
		slot4 = self._ctrl

		Input.destroy_virtual_controller(slot2, Input)
	end

	if self._listener_id then
		slot4 = self._listener_id

		managers.listener.remove_listener(slot2, managers.listener)

		slot4 = "editor"

		managers.listener.remove_set(slot2, managers.listener)

		self._listener_id = nil
	end

	if self._vp then
		slot3 = self._vp

		self._vp.destroy(slot2)

		self._vp = nil
	end

	return 
end
function CoreEditor:use_beta_undo()
	return self._use_beta_undo
end
CoreEditorContinent = CoreEditorContinent or class()
function CoreEditorContinent:init(name, values)
	self._unit_ids = {}
	self._name = name
	self._need_saving = true
	self._units = {}
	self._values = {
		name = name
	}
	slot6 = values

	self.load_values(slot4, self)

	return 
end
function CoreEditorContinent:load_values(values)
	self._values.base_id = values.base_id
	self._values.visible = values.visible or (values.visible == nil and true)
	self._values.enabled = values.enabled or (values.enabled == nil and true)
	self._values.locked = values.locked or (values.locked == nil and false)
	self._values.enabled_in_simulation = values.enabled_in_simulation or (values.enabled_in_simulation == nil and true)
	self._values.editor_only = values.editor_only or (values.editor_only == nil and false)

	return 
end
function CoreEditorContinent:values()
	return self._values
end
function CoreEditorContinent:base_id()
	return self._values.base_id
end
function CoreEditorContinent:get_unit_id(unit)
	local i = self._values.base_id

	while self._unit_ids[i] do
		i = i + 1
	end

	slot5 = unit
	unit.unit_data(slot4).unit_id = i
	slot6 = unit

	self.register_unit_id(slot4, self)

	return i
end
function CoreEditorContinent:register_unit_id(unit)
	slot5 = unit
	self._unit_ids[unit.unit_data(slot4).unit_id] = unit

	return 
end
function CoreEditorContinent:remove_unit_id(unit)
	slot5 = unit
	self._unit_ids[unit.unit_data(slot4).unit_id] = nil

	return 
end
function CoreEditorContinent:name()
	return self._name
end
function CoreEditorContinent:set_name(name)
	self._name = name

	return 
end
function CoreEditorContinent:set_need_saving(need_saving)
	self._need_saving = need_saving

	return 
end
function CoreEditorContinent:add_unit(unit)
	slot4 = unit
	unit.unit_data(slot3).continent = self
	slot5 = unit

	table.insert(slot3, self._units)

	slot5 = not self._values.locked

	unit.set_enabled(slot3, unit)

	slot5 = true

	self.set_need_saving(slot3, self)

	return 
end
function CoreEditorContinent:remove_unit(unit)
	slot5 = unit

	table.delete(slot3, self._units)

	slot5 = true

	self.set_need_saving(slot3, self)

	return 
end
function CoreEditorContinent:set_visible(visible)
	self._values.visible = visible
	slot4 = self._units

	for _, unit in ipairs(slot3) do
		slot11 = self._values.visible

		managers.editor.set_unit_visible(slot8, managers.editor, unit)
	end

	return 
end
function CoreEditorContinent:set_simulation_state(exclude)
	local enabled = self._values.enabled_in_simulation and not exclude

	if (not self._values.locked and enabled) or (self._values.locked and not enabled) then
		return 
	end

	slot5 = self._units

	for _, unit in ipairs(slot4) do
		slot11 = enabled

		unit.set_enabled(slot9, unit)
	end

	return 
end
function CoreEditorContinent:set_locked(locked)
	self._values.locked = locked
	slot4 = self._units

	for _, unit in ipairs(slot3) do
		slot10 = not locked

		unit.set_enabled(slot8, unit)

		if locked then
			slot10 = unit

			managers.editor.unselect_unit(slot8, managers.editor)
		end
	end

	slot5 = "select_by_name"

	managers.editor.reset_dialog(slot3, managers.editor)

	return 
end
function CoreEditorContinent:set_enabled(enabled)
	self._values.enabled = enabled
	slot4 = self._units

	for _, unit in ipairs(slot3) do
		slot10 = enabled

		unit.set_enabled(slot8, unit)
	end

	return 
end
function CoreEditorContinent:set_enabled_in_simulation(enabled_in_simulation)
	slot6 = enabled_in_simulation

	self.set_value(slot3, self, "enabled_in_simulation")

	return 
end
function CoreEditorContinent:set_editor_only(editor_only)
	slot6 = editor_only

	self.set_value(slot3, self, "editor_only")

	return 
end
function CoreEditorContinent:set_value(value, new_value)
	self._values[value] = new_value

	return 
end
function CoreEditorContinent:value(value)
	return self._values[value]
end
function CoreEditorContinent:delete()
	slot5 = self._units

	for _, unit in ipairs(clone(slot4)) do
		slot9 = unit

		managers.editor.delete_unit(slot7, managers.editor)
	end

	return 
end

return 
